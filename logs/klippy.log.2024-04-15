===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	RESPOND COLOR=error MSG="Top button pressed"

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	RESPOND COLOR=error MSG="Bttm button pressed"

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/printer_data/config/printer.cfg', '-l', '/home/pi/printer_data/logs/klippy.log', '-I', '/home/pi/printer_data/comms/klippy.serial', '-a', '/home/pi/printer_data/comms/klippy.sock']
Git version: 'v0.12.0-142-gb029d046-dirty'
Untracked files: klippy/extras/autotune_tmc.py, klippy/extras/beacon.py, klippy/extras/gcode_shell_command.py, klippy/extras/linear_movement_vibrations.py, klippy/extras/motor_constants.py, klippy/extras/ratos_homing.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper.git
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
webhooks client 4123602896: {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
=============== Log rollover at Mon Apr 15 05:27:46 2024 ===============
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
MCU error during connect
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/mcu.py", line 769, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/pi/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/pi/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/pi/klipper/klippy/mcu.py", line 774, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
Build file /home/pi/klipper/klippy/../.config(892): Thu Apr  4 23:50:14 2024
========= Last MCU build config =========
# CONFIG_LOW_LEVEL_OPTIONS is not set
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
# CONFIG_MACH_STM32 is not set
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
CONFIG_MACH_LINUX=y
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="linux"
CONFIG_CLOCK_FREQ=50000000
CONFIG_LINUX_SELECT=y
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_LIS2DW=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_NEED_SENSOR_BULK=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(9238): Thu Apr  4 23:50:31 2024
Last MCU build version: v0.12.0-142-gb029d046
Last MCU build tools: gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2
Last MCU build config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
Build file /home/pi/klipper/klippy/../out/klipper.elf(698068): Thu Apr  4 23:50:36 2024
Attempting MCU 'mcu' reset
Unable to issue reset command on MCU 'rpi'
webhooks client 4123602896: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:30:25 2024 (1713155425.1 198.6)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	RESPOND COLOR=error MSG="Top button pressed"

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	RESPOND COLOR=error MSG="Bttm button pressed"

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4123352728: New connection
webhooks client 4123352728: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 206.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9994 bytes_read=14054 bytes_retransmit=9 bytes_invalid=0 send_seq=714 receive_seq=714 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400024355 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=841 bytes_read=5094 bytes_retransmit=0 bytes_invalid=0 send_seq=115 receive_seq=115 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999074 adj=49996175 Octopus_Max: temp=31.3 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.11 cputime=3.854 memavail=7507132 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4123352728
webhooks: registering remote method 'reboot_machine' for connection id: 4123352728
webhooks: registering remote method 'pause_job_queue' for connection id: 4123352728
webhooks: registering remote method 'start_job_queue' for connection id: 4123352728
webhooks: registering remote method 'set_device_power' for connection id: 4123352728
Stats 207.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10000 bytes_read=14271 bytes_retransmit=9 bytes_invalid=0 send_seq=715 receive_seq=715 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400024594 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=847 bytes_read=5110 bytes_retransmit=0 bytes_invalid=0 send_seq=116 receive_seq=116 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999178 adj=49994711 Octopus_Max: temp=31.3 Pi: temp=32.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.11 cputime=3.892 memavail=7506180 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 208.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10006 bytes_read=14515 bytes_retransmit=9 bytes_invalid=0 send_seq=716 receive_seq=716 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400024907 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=853 bytes_read=5126 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999214 adj=49995243 Octopus_Max: temp=31.5 Pi: temp=33.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.11 cputime=3.902 memavail=7506180 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 209.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10012 bytes_read=14788 bytes_retransmit=9 bytes_invalid=0 send_seq=717 receive_seq=717 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400025175 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=865 bytes_read=5158 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999446 adj=49995446 Octopus_Max: temp=31.6 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.11 cputime=3.920 memavail=7506180 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 210.5: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10018 bytes_read=15017 bytes_retransmit=9 bytes_invalid=0 send_seq=718 receive_seq=718 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400025829 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=871 bytes_read=5174 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999552 adj=49996238 Octopus_Max: temp=31.6 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.10 cputime=3.945 memavail=7506180 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 211.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10024 bytes_read=15275 bytes_retransmit=9 bytes_invalid=0 send_seq=719 receive_seq=719 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400026058 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=877 bytes_read=5203 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999670 adj=49996327 Octopus_Max: temp=31.7 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.10 cputime=3.970 memavail=7506328 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 212.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10030 bytes_read=15548 bytes_retransmit=9 bytes_invalid=0 send_seq=720 receive_seq=720 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400026427 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=883 bytes_read=5219 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999763 adj=49996647 Octopus_Max: temp=31.7 Pi: temp=31.2  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.10 cputime=3.995 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 213.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10036 bytes_read=15777 bytes_retransmit=9 bytes_invalid=0 send_seq=721 receive_seq=721 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400026749 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=889 bytes_read=5235 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999836 adj=49996765 Octopus_Max: temp=31.8 Pi: temp=31.2  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.10 cputime=4.021 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 214.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10042 bytes_read=16021 bytes_retransmit=9 bytes_invalid=0 send_seq=722 receive_seq=722 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400026868 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=895 bytes_read=5251 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999872 adj=49996818 Octopus_Max: temp=32.0 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.10 cputime=4.045 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 215.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10048 bytes_read=16294 bytes_retransmit=9 bytes_invalid=0 send_seq=723 receive_seq=723 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027475 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000015 bytes_write=901 bytes_read=5267 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999900 adj=49996822 Octopus_Max: temp=31.9 Pi: temp=30.7  heater_bed: target=0 temp=25.4 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=4.071 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 216.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10054 bytes_read=16537 bytes_retransmit=9 bytes_invalid=0 send_seq=724 receive_seq=724 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027559 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=907 bytes_read=5296 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999862 adj=49996525 Octopus_Max: temp=32.0 Pi: temp=31.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=25.1 sysload=0.09 cputime=4.096 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 217.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10060 bytes_read=16780 bytes_retransmit=9 bytes_invalid=0 send_seq=725 receive_seq=725 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027710 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=913 bytes_read=5312 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999830 adj=49996282 Octopus_Max: temp=32.0 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.09 cputime=4.122 memavail=7506436 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 218.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10066 bytes_read=17044 bytes_retransmit=9 bytes_invalid=0 send_seq=726 receive_seq=726 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027752 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=919 bytes_read=5328 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999803 adj=49996063 Octopus_Max: temp=32.1 Pi: temp=30.7  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=4.148 memavail=7506444 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 219.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10072 bytes_read=17273 bytes_retransmit=9 bytes_invalid=0 send_seq=727 receive_seq=727 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027722 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=925 bytes_read=5344 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999792 adj=49995977 Octopus_Max: temp=32.2 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=4.172 memavail=7506444 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 220.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10078 bytes_read=17517 bytes_retransmit=9 bytes_invalid=0 send_seq=728 receive_seq=728 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027626 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=931 bytes_read=5360 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999747 adj=49996024 Octopus_Max: temp=32.2 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.08 cputime=4.189 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 221.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10084 bytes_read=17804 bytes_retransmit=9 bytes_invalid=0 send_seq=729 receive_seq=729 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027504 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=937 bytes_read=5389 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999708 adj=49995925 Octopus_Max: temp=32.3 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.08 cputime=4.200 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 222.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10090 bytes_read=18048 bytes_retransmit=9 bytes_invalid=0 send_seq=730 receive_seq=730 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027412 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=943 bytes_read=5405 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999669 adj=49995883 Octopus_Max: temp=32.2 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.210 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 223.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10096 bytes_read=18277 bytes_retransmit=9 bytes_invalid=0 send_seq=731 receive_seq=731 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027359 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=949 bytes_read=5421 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999637 adj=49995817 Octopus_Max: temp=32.4 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.221 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 224.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10102 bytes_read=18550 bytes_retransmit=9 bytes_invalid=0 send_seq=732 receive_seq=732 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027305 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=955 bytes_read=5437 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999620 adj=49995772 Octopus_Max: temp=32.4 Pi: temp=31.2  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.08 cputime=4.232 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 225.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10108 bytes_read=18794 bytes_retransmit=9 bytes_invalid=0 send_seq=733 receive_seq=733 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027355 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=961 bytes_read=5453 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999636 adj=49995823 Octopus_Max: temp=32.6 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.252 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 226.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10114 bytes_read=19037 bytes_retransmit=9 bytes_invalid=0 send_seq=734 receive_seq=734 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027429 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=967 bytes_read=5482 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999657 adj=49995979 Octopus_Max: temp=32.5 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.277 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 227.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10120 bytes_read=19310 bytes_retransmit=9 bytes_invalid=0 send_seq=735 receive_seq=735 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027505 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=973 bytes_read=5498 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999666 adj=49996115 Octopus_Max: temp=32.7 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.302 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 228.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10126 bytes_read=19549 bytes_retransmit=9 bytes_invalid=0 send_seq=736 receive_seq=736 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027636 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=979 bytes_read=5514 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999679 adj=49996138 Octopus_Max: temp=32.6 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.08 cputime=4.327 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 229.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10132 bytes_read=19773 bytes_retransmit=9 bytes_invalid=0 send_seq=737 receive_seq=737 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027641 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=985 bytes_read=5530 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999690 adj=49996137 Octopus_Max: temp=32.6 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=4.352 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 230.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10138 bytes_read=20046 bytes_retransmit=9 bytes_invalid=0 send_seq=738 receive_seq=738 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027639 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=991 bytes_read=5546 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999693 adj=49996233 Octopus_Max: temp=32.7 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.07 cputime=4.376 memavail=7506816 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 231.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10144 bytes_read=20304 bytes_retransmit=9 bytes_invalid=0 send_seq=739 receive_seq=739 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027664 rpi: mcu_awake=0.001 mcu_task_avg=0.000021 mcu_task_stddev=0.000029 bytes_write=997 bytes_read=5575 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999697 adj=49996259 Octopus_Max: temp=32.6 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.07 cputime=4.401 memavail=7506972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 232.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10150 bytes_read=20533 bytes_retransmit=9 bytes_invalid=0 send_seq=740 receive_seq=740 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027680 rpi: mcu_awake=0.001 mcu_task_avg=0.000021 mcu_task_stddev=0.000029 bytes_write=1003 bytes_read=5591 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999696 adj=49996256 Octopus_Max: temp=32.7 Pi: temp=29.7  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.07 cputime=4.425 memavail=7507068 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 233.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10156 bytes_read=20806 bytes_retransmit=9 bytes_invalid=0 send_seq=741 receive_seq=741 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027674 rpi: mcu_awake=0.001 mcu_task_avg=0.000021 mcu_task_stddev=0.000029 bytes_write=1009 bytes_read=5607 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999695 adj=49996231 Octopus_Max: temp=32.8 Pi: temp=32.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.07 cputime=4.451 memavail=7507068 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 234.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10162 bytes_read=21050 bytes_retransmit=9 bytes_invalid=0 send_seq=742 receive_seq=742 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027666 rpi: mcu_awake=0.001 mcu_task_avg=0.000021 mcu_task_stddev=0.000029 bytes_write=1015 bytes_read=5623 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999696 adj=49996234 Octopus_Max: temp=32.8 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.07 cputime=4.476 memavail=7507068 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 235.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10168 bytes_read=21279 bytes_retransmit=9 bytes_invalid=0 send_seq=743 receive_seq=743 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027661 rpi: mcu_awake=0.001 mcu_task_avg=0.000021 mcu_task_stddev=0.000029 bytes_write=1021 bytes_read=5639 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999691 adj=49996245 Octopus_Max: temp=32.8 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.500 memavail=7507576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 236.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10174 bytes_read=21566 bytes_retransmit=9 bytes_invalid=0 send_seq=744 receive_seq=744 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027665 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1027 bytes_read=5668 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999678 adj=49996214 Octopus_Max: temp=32.9 Pi: temp=30.7  heater_bed: target=0 temp=25.4 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.519 memavail=7500016 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 237.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10180 bytes_read=21810 bytes_retransmit=9 bytes_invalid=0 send_seq=745 receive_seq=745 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027611 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1033 bytes_read=5684 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999659 adj=49996108 Octopus_Max: temp=32.8 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.530 memavail=7506676 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 238.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10186 bytes_read=22039 bytes_retransmit=9 bytes_invalid=0 send_seq=746 receive_seq=746 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027580 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1039 bytes_read=5700 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999646 adj=49996034 Octopus_Max: temp=32.9 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.540 memavail=7506676 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 239.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10192 bytes_read=22302 bytes_retransmit=9 bytes_invalid=0 send_seq=747 receive_seq=747 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027538 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1045 bytes_read=5716 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999634 adj=49995992 Octopus_Max: temp=33.1 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.550 memavail=7506676 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 240.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10198 bytes_read=22545 bytes_retransmit=9 bytes_invalid=0 send_seq=748 receive_seq=748 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027514 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1051 bytes_read=5732 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999625 adj=49995990 Octopus_Max: temp=33.1 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.561 memavail=7506676 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 241.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10204 bytes_read=22788 bytes_retransmit=9 bytes_invalid=0 send_seq=749 receive_seq=749 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027490 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000009 bytes_write=1057 bytes_read=5761 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999617 adj=49995991 Octopus_Max: temp=32.9 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.578 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 242.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10216 bytes_read=23077 bytes_retransmit=9 bytes_invalid=0 send_seq=751 receive_seq=751 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027537 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000009 bytes_write=1063 bytes_read=5777 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999629 adj=49995993 Octopus_Max: temp=33.0 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.06 cputime=4.605 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 243.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10222 bytes_read=23321 bytes_retransmit=9 bytes_invalid=0 send_seq=752 receive_seq=752 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027563 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000009 bytes_write=1069 bytes_read=5793 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999640 adj=49996092 Octopus_Max: temp=33.2 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.629 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 244.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10228 bytes_read=23550 bytes_retransmit=9 bytes_invalid=0 send_seq=753 receive_seq=753 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027582 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000009 bytes_write=1075 bytes_read=5809 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999650 adj=49996187 Octopus_Max: temp=33.3 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.06 cputime=4.654 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 245.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10234 bytes_read=23823 bytes_retransmit=9 bytes_invalid=0 send_seq=754 receive_seq=754 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027584 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000009 bytes_write=1081 bytes_read=5825 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999654 adj=49996260 Octopus_Max: temp=33.4 Pi: temp=31.2  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.679 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 246.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10240 bytes_read=24081 bytes_retransmit=9 bytes_invalid=0 send_seq=755 receive_seq=755 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027592 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1087 bytes_read=5854 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999659 adj=49996287 Octopus_Max: temp=33.1 Pi: temp=31.2  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.704 memavail=7506204 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 247.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10246 bytes_read=24310 bytes_retransmit=9 bytes_invalid=0 send_seq=756 receive_seq=756 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027599 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1093 bytes_read=5870 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999668 adj=49996306 Octopus_Max: temp=33.2 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.05 cputime=4.728 memavail=7506208 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 248.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10252 bytes_read=24583 bytes_retransmit=9 bytes_invalid=0 send_seq=757 receive_seq=757 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027602 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1099 bytes_read=5886 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999677 adj=49996364 Octopus_Max: temp=33.3 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.05 cputime=4.753 memavail=7506208 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 249.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10258 bytes_read=24827 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027600 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1105 bytes_read=5902 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999681 adj=49996409 Octopus_Max: temp=33.4 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.777 memavail=7506208 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 250.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10264 bytes_read=25042 bytes_retransmit=9 bytes_invalid=0 send_seq=759 receive_seq=759 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027599 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1111 bytes_read=5918 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999687 adj=49996404 Octopus_Max: temp=33.3 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.800 memavail=7506208 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 251.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10270 bytes_read=25329 bytes_retransmit=9 bytes_invalid=0 send_seq=760 receive_seq=760 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027605 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1117 bytes_read=5947 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999685 adj=49996426 Octopus_Max: temp=33.4 Pi: temp=32.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.826 memavail=7506356 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 252.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10276 bytes_read=25573 bytes_retransmit=9 bytes_invalid=0 send_seq=761 receive_seq=761 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027598 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1123 bytes_read=5963 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999687 adj=49996354 Octopus_Max: temp=33.4 Pi: temp=31.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.1 sysload=0.05 cputime=4.848 memavail=7501184 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 253.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10282 bytes_read=25802 bytes_retransmit=9 bytes_invalid=0 send_seq=762 receive_seq=762 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027574 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1129 bytes_read=5979 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999678 adj=49996355 Octopus_Max: temp=33.3 Pi: temp=32.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.859 memavail=7507328 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 254.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10288 bytes_read=26075 bytes_retransmit=9 bytes_invalid=0 send_seq=763 receive_seq=763 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027553 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1135 bytes_read=5995 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999669 adj=49996259 Octopus_Max: temp=33.4 Pi: temp=33.1  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.870 memavail=7507328 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 255.6: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10294 bytes_read=26319 bytes_retransmit=9 bytes_invalid=0 send_seq=764 receive_seq=764 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027545 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1141 bytes_read=6011 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999661 adj=49996183 Octopus_Max: temp=33.8 Pi: temp=32.1  heater_bed: target=0 temp=25.4 pwm=0.000 bed_core: temp=25.0 sysload=0.05 cputime=4.880 memavail=7507328 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 399.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=11170 bytes_read=62439 bytes_retransmit=9 bytes_invalid=0 send_seq=910 receive_seq=910 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027682 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=2023 bytes_read=8728 bytes_retransmit=0 bytes_invalid=0 send_seq=312 receive_seq=312 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999202 adj=49996014 Octopus_Max: temp=36.4 Pi: temp=32.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.03 cputime=7.710 memavail=7506720 print_time=203.831 buffer_time=0.580 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4123352728: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:33:47 2024 (1713155627.9 401.4)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% set extruder_temp = printer.extruder.temperature %}
	{% set printer_state = printer.state %}
	
	{% if extruder_temp < 49.0 %}
	RESPOND COLOR=warning MSG="Extruder temperature is below 49.0C"
	{% else %}
	RESPOND COLOR=error MSG="Extruder temperature is too high: {{ extruder_temp }}C"
	{% endif %}
	
	{% if printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby" %}
	RESPOND COLOR=warning MSG="Printer is in an acceptable state: {{ printer_state }}"
	{% else %}
	RESPOND COLOR=error MSG="Printer is in an unacceptable state: {{ printer_state }}"
	{% endif %}
	
	{% if extruder_temp < 49.0 and (printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby") %}
	RESPOND COLOR=warning MSG="Printer shutting down"
	_SHUTDOWN_HOST
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 51, in load_config_prefix
    return GCodeButton(config)
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 24, in __init__
    self.release_template = gcode_macro.load_template(config,
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 81, in load_template
    return TemplateWrapper(self.printer, self.env, name, script)
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 56, in __init__
    raise printer.config_error(msg)
configparser.Error: Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

webhooks client 4124250200: New connection
webhooks client 4124250200: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Attempting MCU 'mcu' reset
Unable to issue reset command on MCU 'rpi'
webhooks client 4124250200: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:34:16 2024 (1713155656.2 429.7)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% set extruder_temp = printer.extruder.temperature %}
	{% set printer_state = printer.state %}
	
	{% if extruder_temp < 49.0 %}
	RESPOND COLOR=warning MSG="Extruder temperature is below 49.0C"
	{% else %}
	RESPOND COLOR=error MSG="Extruder temperature is too high: {{ extruder_temp }}C"
	{% endif %}
	
	{% if printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby" %}
	RESPOND COLOR=warning MSG="Printer is in an acceptable state: {{ printer_state }}"
	{% else %}
	RESPOND COLOR=error MSG="Printer is in an unacceptable state: {{ printer_state }}"
	{% endif %}
	
	{% if extruder_temp < 49.0 and (printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby") %}
	RESPOND COLOR=warning MSG="Printer shutting down"
	_SHUTDOWN_HOST
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 51, in load_config_prefix
    return GCodeButton(config)
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 24, in __init__
    self.release_template = gcode_macro.load_template(config,
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 81, in load_template
    return TemplateWrapper(self.printer, self.env, name, script)
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 56, in __init__
    raise printer.config_error(msg)
configparser.Error: Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

webhooks client 4130766104: New connection
webhooks client 4130766104: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Attempting MCU 'mcu' reset
Unable to issue reset command on MCU 'rpi'
webhooks client 4130766104: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:34:34 2024 (1713155674.7 448.2)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4123505472: New connection
webhooks client 4123505472: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)
Failed to verify BLTouch probe is raised; retrying.

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 456.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9779 bytes_read=13690 bytes_retransmit=9 bytes_invalid=0 send_seq=671 receive_seq=671 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400031242 rpi: mcu_awake=0.003 mcu_task_avg=0.000020 mcu_task_stddev=0.000010 bytes_write=852 bytes_read=4738 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999625 adj=49991281 Octopus_Max: temp=36.9 Pi: temp=33.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=11.325 memavail=7506072 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4123505472
webhooks: registering remote method 'reboot_machine' for connection id: 4123505472
webhooks: registering remote method 'pause_job_queue' for connection id: 4123505472
webhooks: registering remote method 'start_job_queue' for connection id: 4123505472
webhooks: registering remote method 'set_device_power' for connection id: 4123505472
Stats 457.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9785 bytes_read=13948 bytes_retransmit=9 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400030824 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000023 bytes_write=858 bytes_read=4767 bytes_retransmit=0 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999482 adj=50002449 Octopus_Max: temp=36.8 Pi: temp=34.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=11.361 memavail=7505620 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 458.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9791 bytes_read=14192 bytes_retransmit=9 bytes_invalid=0 send_seq=673 receive_seq=673 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029779 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000023 bytes_write=864 bytes_read=4783 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999393 adj=50000522 Octopus_Max: temp=36.9 Pi: temp=34.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=11.372 memavail=7505620 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 459.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9797 bytes_read=14436 bytes_retransmit=9 bytes_invalid=0 send_seq=674 receive_seq=674 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029084 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000023 bytes_write=870 bytes_read=4799 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999361 adj=49999436 Octopus_Max: temp=36.9 Pi: temp=33.6  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=11.382 memavail=7505620 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 460.2: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9803 bytes_read=14694 bytes_retransmit=9 bytes_invalid=0 send_seq=675 receive_seq=675 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028652 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000023 bytes_write=876 bytes_read=4815 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999349 adj=49998678 Octopus_Max: temp=37.0 Pi: temp=34.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=25.0 sysload=0.09 cputime=11.392 memavail=7505620 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 462.2: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9815 bytes_read=15196 bytes_retransmit=9 bytes_invalid=0 send_seq=677 receive_seq=677 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028596 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=888 bytes_read=4860 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999543 adj=49998018 Octopus_Max: temp=37.0 Pi: temp=34.1  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=11.436 memavail=7505644 print_time=62.493 buffer_time=0.817 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4123505472: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:34:50 2024 (1713155690.6 464.1)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% set extruder_temp = printer.extruder.temperature %}
	{% set printer_state = printer.state %}
	
	{% if extruder_temp < 49.0 %}
	RESPOND COLOR=warning MSG="Extruder temperature is below 49.0C"
	{% else %}
	RESPOND COLOR=error MSG="Extruder temperature is too high: {{ extruder_temp }}C"
	{% endif %}
	
	{% if printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby" %}
	RESPOND COLOR=warning MSG="Printer is in an acceptable state: {{ printer_state }}"
	{% else %}
	RESPOND COLOR=error MSG="Printer is in an unacceptable state: {{ printer_state }}"
	{% endif %}
	
	{% if extruder_temp < 49.0 and (printer_state == "Idle" or printer_state == "Ready" or printer_state == "Standby") %}
	RESPOND COLOR=warning MSG="Printer shutting down"
	_SHUTDOWN_HOST
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 51, in __init__
    self.template = env.from_string(script)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/home/pi/klippy-env/lib/python3.9/site-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 51, in load_config_prefix
    return GCodeButton(config)
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 24, in __init__
    self.release_template = gcode_macro.load_template(config,
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 81, in load_template
    return TemplateWrapper(self.printer, self.env, name, script)
  File "/home/pi/klipper/klippy/extras/gcode_macro.py", line 56, in __init__
    raise printer.config_error(msg)
configparser.Error: Error loading template 'gcode_button bottom:release_gcode': jinja2.exceptions.TemplateSyntaxError: expected token ':', got '}'

webhooks client 4124699568: New connection
webhooks client 4124699568: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Attempting MCU 'mcu' reset
Unable to issue reset command on MCU 'rpi'
webhooks client 4124699568: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:37:26 2024 (1713155846.9 620.4)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancel"

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESPOND COLOR=success MSG="Print done"
	RESTORE_GCODE_STATE NAME=end_print_state
	Song_Futurama1

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% if printer.extruder.temperature < 49.0 and (printer.state == "Idle" or printer.state == "Ready" or printer.state == "Standby") %}
	RESPOND COLOR=warning MSG="Printer shutting down"
	_SHUTDOWN_HOST
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4123453256: New connection
webhooks client 4123453256: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
webhooks: registering remote method 'shutdown_machine' for connection id: 4123453256
webhooks: registering remote method 'reboot_machine' for connection id: 4123453256
webhooks: registering remote method 'pause_job_queue' for connection id: 4123453256
webhooks: registering remote method 'start_job_queue' for connection id: 4123453256
webhooks: registering remote method 'set_device_power' for connection id: 4123453256
Stats 887.5: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=11367 bytes_read=78795 bytes_retransmit=9 bytes_invalid=0 send_seq=936 receive_seq=936 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027756 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=2430 bytes_read=9877 bytes_retransmit=0 bytes_invalid=0 send_seq=380 receive_seq=380 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999673 adj=49996122 Octopus_Max: temp=39.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.10 cputime=19.314 memavail=7505744 print_time=424.661 buffer_time=0.361 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4123453256: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:41:55 2024 (1713156115.5 889.0)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND TYPE=command MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND TYPE=command MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND TYPE=command MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% if printer.extruder.temperature < 49.0 and (printer.state == "Idle" or printer.state == "Ready" or printer.state == "Standby") %}
	RESPOND COLOR=warning MSG="Printer shutting down"
	_POWER_OFF_PRINTER
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND TYPE=command MSG="Powering printer off"
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4124390808: New connection
webhooks client 4124390808: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 897.1: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9289 bytes_read=13253 bytes_retransmit=9 bytes_invalid=0 send_seq=573 receive_seq=573 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029012 rpi: mcu_awake=0.003 mcu_task_avg=0.000018 mcu_task_stddev=0.000011 bytes_write=852 bytes_read=4611 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999551 adj=49991008 Octopus_Max: temp=40.4 Pi: temp=35.5  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=20.903 memavail=7504132 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4124390808
webhooks: registering remote method 'reboot_machine' for connection id: 4124390808
webhooks: registering remote method 'pause_job_queue' for connection id: 4124390808
webhooks: registering remote method 'start_job_queue' for connection id: 4124390808
webhooks: registering remote method 'set_device_power' for connection id: 4124390808
Stats 898.1: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9295 bytes_read=13482 bytes_retransmit=9 bytes_invalid=0 send_seq=574 receive_seq=574 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028437 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=858 bytes_read=4640 bytes_retransmit=0 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999587 adj=50003737 Octopus_Max: temp=40.3 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=20.940 memavail=7503472 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 899.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9301 bytes_read=13762 bytes_retransmit=9 bytes_invalid=0 send_seq=575 receive_seq=575 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028099 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=864 bytes_read=4656 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999603 adj=50002089 Octopus_Max: temp=40.4 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=25.0 sysload=0.08 cputime=20.951 memavail=7503472 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 900.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9307 bytes_read=14004 bytes_retransmit=9 bytes_invalid=0 send_seq=576 receive_seq=576 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027977 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=870 bytes_read=4672 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999601 adj=50000753 Octopus_Max: temp=40.3 Pi: temp=35.5  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=20.961 memavail=7503472 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 901.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9313 bytes_read=14233 bytes_retransmit=9 bytes_invalid=0 send_seq=577 receive_seq=577 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027936 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=876 bytes_read=4688 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999610 adj=49999630 Octopus_Max: temp=40.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=20.972 memavail=7503496 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 902.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9319 bytes_read=14506 bytes_retransmit=9 bytes_invalid=0 send_seq=578 receive_seq=578 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027858 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=882 bytes_read=4704 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999803 adj=49998797 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=20.986 memavail=7503756 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 903.1: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9325 bytes_read=14750 bytes_retransmit=9 bytes_invalid=0 send_seq=579 receive_seq=579 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027893 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=888 bytes_read=4733 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999774 adj=49998870 Octopus_Max: temp=40.4 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=21.003 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 904.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9331 bytes_read=14993 bytes_retransmit=9 bytes_invalid=0 send_seq=580 receive_seq=580 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027881 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=894 bytes_read=4749 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999757 adj=49998100 Octopus_Max: temp=40.4 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=21.013 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 905.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9353 bytes_read=15296 bytes_retransmit=9 bytes_invalid=0 send_seq=583 receive_seq=583 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027848 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=900 bytes_read=4765 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999740 adj=49997587 Octopus_Max: temp=40.4 Pi: temp=36.0  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=21.026 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 906.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9375 bytes_read=15570 bytes_retransmit=9 bytes_invalid=0 send_seq=586 receive_seq=586 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027739 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=906 bytes_read=4781 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999741 adj=49997202 Octopus_Max: temp=40.7 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=21.040 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 907.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9381 bytes_read=15799 bytes_retransmit=9 bytes_invalid=0 send_seq=587 receive_seq=587 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027738 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000013 bytes_write=912 bytes_read=4797 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999717 adj=49997032 Octopus_Max: temp=40.5 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=21.050 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 908.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9387 bytes_read=16072 bytes_retransmit=9 bytes_invalid=0 send_seq=588 receive_seq=588 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027967 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=918 bytes_read=4826 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999753 adj=49996732 Octopus_Max: temp=40.4 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.07 cputime=21.069 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 909.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9393 bytes_read=16330 bytes_retransmit=9 bytes_invalid=0 send_seq=589 receive_seq=589 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028071 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=924 bytes_read=4842 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999792 adj=49996646 Octopus_Max: temp=40.3 Pi: temp=34.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=21.094 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 910.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9399 bytes_read=16548 bytes_retransmit=9 bytes_invalid=0 send_seq=590 receive_seq=590 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028156 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=930 bytes_read=4858 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999814 adj=49996681 Octopus_Max: temp=40.4 Pi: temp=34.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=21.118 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 911.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9405 bytes_read=16821 bytes_retransmit=9 bytes_invalid=0 send_seq=591 receive_seq=591 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028219 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=936 bytes_read=4874 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999843 adj=49996641 Octopus_Max: temp=40.4 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.144 memavail=7505872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 912.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9411 bytes_read=17065 bytes_retransmit=9 bytes_invalid=0 send_seq=592 receive_seq=592 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028238 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=942 bytes_read=4890 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999842 adj=49996670 Octopus_Max: temp=40.6 Pi: temp=35.5  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.168 memavail=7505888 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 913.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9417 bytes_read=17294 bytes_retransmit=9 bytes_invalid=0 send_seq=593 receive_seq=593 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028253 rpi: mcu_awake=0.001 mcu_task_avg=0.000010 mcu_task_stddev=0.000012 bytes_write=948 bytes_read=4906 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999839 adj=49996559 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=21.192 memavail=7505664 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 914.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9423 bytes_read=17581 bytes_retransmit=9 bytes_invalid=0 send_seq=594 receive_seq=594 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028247 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=954 bytes_read=4935 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999856 adj=49996471 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.217 memavail=7505664 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 915.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9429 bytes_read=17825 bytes_retransmit=9 bytes_invalid=0 send_seq=595 receive_seq=595 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028260 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=960 bytes_read=4951 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999861 adj=49996534 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.241 memavail=7505664 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-75.6 pwm=0.000
Stats 916.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9435 bytes_read=18054 bytes_retransmit=9 bytes_invalid=0 send_seq=596 receive_seq=596 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028249 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=966 bytes_read=4967 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999860 adj=49996507 Octopus_Max: temp=40.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=21.265 memavail=7505664 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 917.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9441 bytes_read=18327 bytes_retransmit=9 bytes_invalid=0 send_seq=597 receive_seq=597 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028309 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=972 bytes_read=4983 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999876 adj=49996463 Octopus_Max: temp=40.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.291 memavail=7505412 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 918.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9447 bytes_read=18571 bytes_retransmit=9 bytes_invalid=0 send_seq=598 receive_seq=598 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028303 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=978 bytes_read=4999 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999911 adj=49996486 Octopus_Max: temp=40.4 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.315 memavail=7505420 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 919.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9453 bytes_read=18814 bytes_retransmit=9 bytes_invalid=0 send_seq=599 receive_seq=599 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028278 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=984 bytes_read=5028 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999883 adj=49996690 Octopus_Max: temp=40.4 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.335 memavail=7505644 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 920.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9459 bytes_read=19084 bytes_retransmit=9 bytes_invalid=0 send_seq=600 receive_seq=600 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028199 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=990 bytes_read=5044 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999847 adj=49996440 Octopus_Max: temp=40.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=21.346 memavail=7505812 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 921.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9465 bytes_read=19323 bytes_retransmit=9 bytes_invalid=0 send_seq=601 receive_seq=601 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028133 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=996 bytes_read=5060 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999816 adj=49996235 Octopus_Max: temp=40.4 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.357 memavail=7505812 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 922.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9471 bytes_read=19552 bytes_retransmit=9 bytes_invalid=0 send_seq=602 receive_seq=602 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028095 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1002 bytes_read=5076 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999789 adj=49996087 Octopus_Max: temp=40.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.367 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 923.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9477 bytes_read=19825 bytes_retransmit=9 bytes_invalid=0 send_seq=603 receive_seq=603 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028043 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1008 bytes_read=5092 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999768 adj=49995973 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.3 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=21.378 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 924.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9483 bytes_read=20083 bytes_retransmit=9 bytes_invalid=0 send_seq=604 receive_seq=604 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028012 rpi: mcu_awake=0.000 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1014 bytes_read=5121 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999748 adj=49995938 Octopus_Max: temp=40.6 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.395 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 925.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9489 bytes_read=20312 bytes_retransmit=9 bytes_invalid=0 send_seq=605 receive_seq=605 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028079 rpi: mcu_awake=0.000 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1020 bytes_read=5137 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999753 adj=49995894 Octopus_Max: temp=40.6 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.419 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 926.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9501 bytes_read=20601 bytes_retransmit=9 bytes_invalid=0 send_seq=607 receive_seq=607 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028093 rpi: mcu_awake=0.000 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1026 bytes_read=5153 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999757 adj=49995956 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.445 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 927.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9507 bytes_read=20845 bytes_retransmit=9 bytes_invalid=0 send_seq=608 receive_seq=608 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028091 rpi: mcu_awake=0.000 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1032 bytes_read=5169 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999760 adj=49996045 Octopus_Max: temp=40.6 Pi: temp=34.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.471 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 928.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9513 bytes_read=21088 bytes_retransmit=9 bytes_invalid=0 send_seq=609 receive_seq=609 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028101 rpi: mcu_awake=0.000 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1038 bytes_read=5185 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999761 adj=49996125 Octopus_Max: temp=40.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.496 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 929.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9519 bytes_read=21361 bytes_retransmit=9 bytes_invalid=0 send_seq=610 receive_seq=610 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028096 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=1044 bytes_read=5214 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999764 adj=49996152 Octopus_Max: temp=40.4 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.522 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 930.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9525 bytes_read=21605 bytes_retransmit=9 bytes_invalid=0 send_seq=611 receive_seq=611 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028112 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=1050 bytes_read=5230 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999768 adj=49996207 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=21.545 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 931.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9531 bytes_read=21840 bytes_retransmit=9 bytes_invalid=0 send_seq=612 receive_seq=612 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028117 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=1056 bytes_read=5246 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999774 adj=49996242 Octopus_Max: temp=40.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.570 memavail=7505312 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 932.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9537 bytes_read=22094 bytes_retransmit=9 bytes_invalid=0 send_seq=613 receive_seq=613 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028110 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=1062 bytes_read=5262 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999786 adj=49996291 Octopus_Max: temp=40.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.594 memavail=7505584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 933.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9543 bytes_read=22338 bytes_retransmit=9 bytes_invalid=0 send_seq=614 receive_seq=614 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028123 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=1068 bytes_read=5278 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999788 adj=49996395 Octopus_Max: temp=40.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.619 memavail=7505584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 934.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9549 bytes_read=22595 bytes_retransmit=9 bytes_invalid=0 send_seq=615 receive_seq=615 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028121 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1074 bytes_read=5307 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999784 adj=49996370 Octopus_Max: temp=40.4 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.644 memavail=7505584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 935.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9555 bytes_read=22854 bytes_retransmit=9 bytes_invalid=0 send_seq=616 receive_seq=616 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028090 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1080 bytes_read=5323 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999781 adj=49996312 Octopus_Max: temp=40.6 Pi: temp=34.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.666 memavail=7500064 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 936.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9561 bytes_read=23098 bytes_retransmit=9 bytes_invalid=0 send_seq=617 receive_seq=617 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028044 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1086 bytes_read=5339 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999763 adj=49996310 Octopus_Max: temp=40.3 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.677 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 937.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9567 bytes_read=23341 bytes_retransmit=9 bytes_invalid=0 send_seq=618 receive_seq=618 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028005 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1092 bytes_read=5355 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999746 adj=49996181 Octopus_Max: temp=40.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.687 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 938.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9573 bytes_read=23600 bytes_retransmit=9 bytes_invalid=0 send_seq=619 receive_seq=619 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027969 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1098 bytes_read=5371 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999731 adj=49996084 Octopus_Max: temp=40.7 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.698 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 939.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9579 bytes_read=23858 bytes_retransmit=9 bytes_invalid=0 send_seq=620 receive_seq=620 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027945 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=1104 bytes_read=5400 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999717 adj=49996021 Octopus_Max: temp=40.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.709 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 940.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9585 bytes_read=24116 bytes_retransmit=9 bytes_invalid=0 send_seq=621 receive_seq=621 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027947 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=1110 bytes_read=5416 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999705 adj=49995966 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.723 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 941.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9591 bytes_read=24360 bytes_retransmit=9 bytes_invalid=0 send_seq=622 receive_seq=622 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027957 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=1116 bytes_read=5432 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999707 adj=49995906 Octopus_Max: temp=40.5 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.749 memavail=7505952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 942.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9597 bytes_read=24595 bytes_retransmit=9 bytes_invalid=0 send_seq=623 receive_seq=623 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028005 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=1122 bytes_read=5448 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999709 adj=49995993 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.774 memavail=7505956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 943.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9603 bytes_read=24851 bytes_retransmit=9 bytes_invalid=0 send_seq=624 receive_seq=624 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028006 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=1128 bytes_read=5464 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999711 adj=49996005 Octopus_Max: temp=40.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.800 memavail=7505972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 944.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9609 bytes_read=25109 bytes_retransmit=9 bytes_invalid=0 send_seq=625 receive_seq=625 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028006 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1134 bytes_read=5493 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999716 adj=49996078 Octopus_Max: temp=40.5 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.825 memavail=7505972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 945.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9615 bytes_read=25353 bytes_retransmit=9 bytes_invalid=0 send_seq=626 receive_seq=626 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028009 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1140 bytes_read=5509 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999719 adj=49996159 Octopus_Max: temp=40.8 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=21.850 memavail=7505972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 946.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9621 bytes_read=25611 bytes_retransmit=9 bytes_invalid=0 send_seq=627 receive_seq=627 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028015 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1146 bytes_read=5525 bytes_retransmit=0 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999726 adj=49996201 Octopus_Max: temp=40.6 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.03 cputime=21.875 memavail=7505972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 947.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9627 bytes_read=25855 bytes_retransmit=9 bytes_invalid=0 send_seq=628 receive_seq=628 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028021 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1152 bytes_read=5541 bytes_retransmit=0 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999730 adj=49996278 Octopus_Max: temp=40.7 Pi: temp=34.6  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.03 cputime=21.899 memavail=7505984 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 948.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9633 bytes_read=26099 bytes_retransmit=9 bytes_invalid=0 send_seq=629 receive_seq=629 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028029 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1158 bytes_read=5557 bytes_retransmit=0 bytes_invalid=0 send_seq=168 receive_seq=168 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999729 adj=49996303 Octopus_Max: temp=40.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=21.924 memavail=7505984 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1167.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10965 bytes_read=81039 bytes_retransmit=9 bytes_invalid=0 send_seq=851 receive_seq=851 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027728 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000017 bytes_write=2496 bytes_read=9680 bytes_retransmit=0 bytes_invalid=0 send_seq=391 receive_seq=391 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999494 adj=49995936 Octopus_Max: temp=41.8 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.09 cputime=26.212 memavail=7506084 print_time=279.104 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4124390808: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:46:34 2024 (1713156394.9 1168.4)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND COLOR=info MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND COLOR=info MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND COLOR=error MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND COLOR=info MSG="Powering printer off"
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4123808744: New connection
webhooks client 4123808744: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)
Failed to verify BLTouch probe is raised; retrying.

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 1176.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000011 mcu_task_stddev=0.000086 bytes_write=10024 bytes_read=13973 bytes_retransmit=9 bytes_invalid=0 send_seq=720 receive_seq=720 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029866 rpi: mcu_awake=0.003 mcu_task_avg=0.000018 mcu_task_stddev=0.000010 bytes_write=852 bytes_read=4610 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999813 adj=49989404 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=27.799 memavail=7504684 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4123808744
webhooks: registering remote method 'reboot_machine' for connection id: 4123808744
webhooks: registering remote method 'pause_job_queue' for connection id: 4123808744
webhooks: registering remote method 'start_job_queue' for connection id: 4123808744
webhooks: registering remote method 'set_device_power' for connection id: 4123808744
Stats 1177.4: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000011 mcu_task_stddev=0.000086 bytes_write=10030 bytes_read=14217 bytes_retransmit=9 bytes_invalid=0 send_seq=721 receive_seq=721 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029797 rpi: mcu_awake=0.003 mcu_task_avg=0.000018 mcu_task_stddev=0.000010 bytes_write=858 bytes_read=4626 bytes_retransmit=0 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999633 adj=50006410 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=27.836 memavail=7504504 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1178.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10036 bytes_read=14483 bytes_retransmit=9 bytes_invalid=0 send_seq=722 receive_seq=722 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029179 rpi: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=864 bytes_read=4655 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999533 adj=50003355 Octopus_Max: temp=41.8 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=27.847 memavail=7504504 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1179.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10042 bytes_read=14724 bytes_retransmit=9 bytes_invalid=0 send_seq=723 receive_seq=723 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028768 rpi: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=870 bytes_read=4671 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999515 adj=50001431 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=27.859 memavail=7505444 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1180.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10048 bytes_read=14968 bytes_retransmit=9 bytes_invalid=0 send_seq=724 receive_seq=724 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028459 rpi: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=876 bytes_read=4687 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999496 adj=50000157 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=27.869 memavail=7505444 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1181.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10062 bytes_read=15241 bytes_retransmit=9 bytes_invalid=0 send_seq=726 receive_seq=726 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028248 rpi: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=882 bytes_read=4703 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999604 adj=49999170 Octopus_Max: temp=41.7 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=27.886 memavail=7505444 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1182.4: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=10076 bytes_read=15500 bytes_retransmit=9 bytes_invalid=0 send_seq=728 receive_seq=728 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028439 rpi: mcu_awake=0.001 mcu_task_avg=0.000014 mcu_task_stddev=0.000017 bytes_write=888 bytes_read=4719 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999673 adj=49998853 Octopus_Max: temp=41.7 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=27.912 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1183.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10082 bytes_read=15758 bytes_retransmit=9 bytes_invalid=0 send_seq=729 receive_seq=729 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028527 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000014 bytes_write=894 bytes_read=4748 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999748 adj=49998332 Octopus_Max: temp=41.7 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.07 cputime=27.938 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1184.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10088 bytes_read=16016 bytes_retransmit=9 bytes_invalid=0 send_seq=730 receive_seq=730 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028495 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000014 bytes_write=900 bytes_read=4764 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999803 adj=49998035 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=27.963 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1185.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10094 bytes_read=16260 bytes_retransmit=9 bytes_invalid=0 send_seq=731 receive_seq=731 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028612 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000014 bytes_write=906 bytes_read=4780 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999787 adj=49997826 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.07 cputime=27.987 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1186.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10100 bytes_read=16504 bytes_retransmit=9 bytes_invalid=0 send_seq=732 receive_seq=732 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028635 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000014 bytes_write=912 bytes_read=4796 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999755 adj=49997290 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=28.011 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1187.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10106 bytes_read=16762 bytes_retransmit=9 bytes_invalid=0 send_seq=733 receive_seq=733 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028640 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000014 bytes_write=918 bytes_read=4812 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999736 adj=49996857 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=28.036 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1188.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10112 bytes_read=17020 bytes_retransmit=9 bytes_invalid=0 send_seq=734 receive_seq=734 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028587 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=924 bytes_read=4841 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999716 adj=49996588 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=28.061 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1189.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10118 bytes_read=17253 bytes_retransmit=9 bytes_invalid=0 send_seq=735 receive_seq=735 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028541 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=930 bytes_read=4857 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999734 adj=49996411 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=28.085 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1190.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10124 bytes_read=17526 bytes_retransmit=9 bytes_invalid=0 send_seq=736 receive_seq=736 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028505 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=936 bytes_read=4873 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999730 adj=49996475 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=28.111 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1191.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10130 bytes_read=17755 bytes_retransmit=9 bytes_invalid=0 send_seq=737 receive_seq=737 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028488 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=942 bytes_read=4889 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999726 adj=49996397 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=28.134 memavail=7504940 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1192.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10136 bytes_read=17999 bytes_retransmit=9 bytes_invalid=0 send_seq=738 receive_seq=738 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028466 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=948 bytes_read=4905 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999739 adj=49996333 Octopus_Max: temp=41.8 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=28.158 memavail=7504688 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1193.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10142 bytes_read=18286 bytes_retransmit=9 bytes_invalid=0 send_seq=739 receive_seq=739 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028397 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=954 bytes_read=4934 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999719 adj=49996380 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=28.184 memavail=7504700 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1194.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10148 bytes_read=18515 bytes_retransmit=9 bytes_invalid=0 send_seq=740 receive_seq=740 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028392 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=960 bytes_read=4950 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999711 adj=49996266 Octopus_Max: temp=41.8 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=28.207 memavail=7504720 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1195.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10154 bytes_read=18759 bytes_retransmit=9 bytes_invalid=0 send_seq=741 receive_seq=741 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028373 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=966 bytes_read=4966 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999678 adj=49996197 Octopus_Max: temp=41.7 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.06 cputime=28.227 memavail=7503708 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1196.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10160 bytes_read=19032 bytes_retransmit=9 bytes_invalid=0 send_seq=742 receive_seq=742 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028272 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=972 bytes_read=4982 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999642 adj=49995990 Octopus_Max: temp=42.0 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.238 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1197.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10166 bytes_read=19261 bytes_retransmit=9 bytes_invalid=0 send_seq=743 receive_seq=743 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028189 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=978 bytes_read=4998 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999613 adj=49995874 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=28.248 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1198.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10172 bytes_read=19519 bytes_retransmit=9 bytes_invalid=0 send_seq=744 receive_seq=744 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028153 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000020 bytes_write=984 bytes_read=5027 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999595 adj=49995804 Octopus_Max: temp=41.8 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.259 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1199.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10178 bytes_read=19789 bytes_retransmit=9 bytes_invalid=0 send_seq=745 receive_seq=745 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028090 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000020 bytes_write=990 bytes_read=5043 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999572 adj=49995786 Octopus_Max: temp=41.8 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.269 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1200.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10184 bytes_read=20013 bytes_retransmit=9 bytes_invalid=0 send_seq=746 receive_seq=746 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028032 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000020 bytes_write=996 bytes_read=5059 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999578 adj=49995751 Octopus_Max: temp=41.8 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.287 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1201.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10190 bytes_read=20257 bytes_retransmit=9 bytes_invalid=0 send_seq=747 receive_seq=747 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028048 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000020 bytes_write=1002 bytes_read=5075 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999581 adj=49995921 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.312 memavail=7503824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1202.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10196 bytes_read=20530 bytes_retransmit=9 bytes_invalid=0 send_seq=748 receive_seq=748 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028187 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000020 bytes_write=1008 bytes_read=5091 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999584 adj=49995971 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=28.337 memavail=7503972 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1203.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10202 bytes_read=20773 bytes_retransmit=9 bytes_invalid=0 send_seq=749 receive_seq=749 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028185 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1014 bytes_read=5120 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999606 adj=49995884 Octopus_Max: temp=41.6 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=28.362 memavail=7504080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1204.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10208 bytes_read=21017 bytes_retransmit=9 bytes_invalid=0 send_seq=750 receive_seq=750 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028178 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1020 bytes_read=5136 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999606 adj=49996102 Octopus_Max: temp=41.9 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.05 cputime=28.387 memavail=7504080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1205.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10214 bytes_read=21290 bytes_retransmit=9 bytes_invalid=0 send_seq=751 receive_seq=751 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028188 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1026 bytes_read=5152 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999606 adj=49996108 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=28.412 memavail=7503828 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1206.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10220 bytes_read=21519 bytes_retransmit=9 bytes_invalid=0 send_seq=752 receive_seq=752 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028189 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1032 bytes_read=5168 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999605 adj=49996089 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=28.437 memavail=7503828 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1207.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10226 bytes_read=21763 bytes_retransmit=9 bytes_invalid=0 send_seq=753 receive_seq=753 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028193 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1038 bytes_read=5184 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999605 adj=49996077 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=28.464 memavail=7503828 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1208.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10238 bytes_read=22066 bytes_retransmit=9 bytes_invalid=0 send_seq=755 receive_seq=755 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028168 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1044 bytes_read=5213 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999607 adj=49996075 Octopus_Max: temp=41.7 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=28.491 memavail=7503828 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1209.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10244 bytes_read=22295 bytes_retransmit=9 bytes_invalid=0 send_seq=756 receive_seq=756 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028171 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1050 bytes_read=5229 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999606 adj=49996117 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=28.515 memavail=7503828 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1210.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10250 bytes_read=22532 bytes_retransmit=9 bytes_invalid=0 send_seq=757 receive_seq=757 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028204 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1056 bytes_read=5245 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999609 adj=49996097 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.04 cputime=28.541 memavail=7504084 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1211.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1062 bytes_read=5261 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999615 adj=49996091 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.566 memavail=7499068 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
b'Got EOF when reading from device'
Stats 1212.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=1 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1068 bytes_read=5277 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999599 adj=49996201 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.576 memavail=7506788 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1213.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=2 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000022 bytes_write=1074 bytes_read=5306 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999583 adj=49996024 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.584 memavail=7506656 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1214.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=3 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000022 bytes_write=1080 bytes_read=5322 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999569 adj=49995891 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.592 memavail=7506656 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1215.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=4 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000022 bytes_write=1086 bytes_read=5338 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999558 adj=49995807 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.600 memavail=7506656 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Timeout with MCU 'mcu' (eventtime=1216.388948)
Transition to shutdown state: Lost communication with MCU 'mcu'
Dumping gcode input 0 blocks
Dumping 20 requests for client 4123808744
Received 1175.915815: b'{"id": 3859443232, "method": "objects/subscribe", "params": {"objects": {"webhooks": null}, "response_template": {"method": "process_status_update"}}}'
Received 1175.919035: b'{"id": 3859443232, "method": "gcode/subscribe_output", "params": {"response_template": {"method": "process_gcode_response"}}}'
Received 1175.921252: b'{"id": 3859443136, "method": "list_endpoints", "params": {}}'
Received 1175.923854: b'{"id": 3859334576, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null}, "response_template": {"method": "process_status_update"}}}'
Received 1176.168380: b'{"id": 3859800560, "method": "objects/list", "params": {}}'
Received 1176.170173: b'{"id": 3859800560, "method": "objects/query", "params": {"objects": {"configfile": null}}}'
Received 1176.425884: b'{"id": 3859443112, "method": "register_remote_method", "params": {"response_template": {"method": "shutdown_machine"}, "remote_method": "shutdown_machine"}}'
Received 1176.427360: b'{"id": 3859800560, "method": "register_remote_method", "params": {"response_template": {"method": "reboot_machine"}, "remote_method": "reboot_machine"}}'
Received 1176.428476: b'{"id": 3859800560, "method": "register_remote_method", "params": {"response_template": {"method": "pause_job_queue"}, "remote_method": "pause_job_queue"}}'
Received 1176.429475: b'{"id": 3859800560, "method": "register_remote_method", "params": {"response_template": {"method": "start_job_queue"}, "remote_method": "start_job_queue"}}'
Received 1176.430505: b'{"id": 3859800560, "method": "register_remote_method", "params": {"response_template": {"method": "set_device_power"}, "remote_method": "set_device_power"}}'
Received 1176.432934: b'{"id": 3861494968, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 1176.432934: b'{"id": 3859442968, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 1176.448663: b'{"id": 3859336064, "method": "info", "params": {}}'
Received 1176.448663: b'{"id": 3859621296, "method": "objects/list", "params": {}}'
Received 1176.449793: b'{"id": 3859534344, "method": "gcode/help", "params": {}}'
Received 1176.473262: b'{"id": 3859621008, "method": "objects/subscribe", "params": {"objects": {"gcode": null, "webhooks": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_sensor Octopus_Max": null, "temperature_host Pi": null, "temperature_sensor Pi": null, "idle_timeout": null, "gcode_move": null, "print_stats": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "heater_bed": null, "temperature_sensor bed_core": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null, "extruder": null}, "response_template": {"method": "process_status_update"}}}'
Received 1176.684479: b'{"id": 3859336376, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "temperature_sensor Octopus_Max": null, "temperature_sensor Pi": null, "heater_bed": null, "temperature_sensor bed_core": null, "extruder": null, "gcode": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_host Pi": null, "idle_timeout": null, "gcode_move": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
Received 1176.932018: b'{"id": 3859623840, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "temperature_sensor Octopus_Max": null, "temperature_sensor Pi": null, "heater_bed": null, "temperature_sensor bed_core": null, "extruder": null, "gcode": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_host Pi": null, "idle_timeout": null, "gcode_move": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
Received 1177.216962: b'{"id": 3859443088, "method": "objects/query", "params": {"objects": {"extruder": ["can_extrude"]}}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (1176.674518428, 0.0, 0.0)
Stats 1216.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=5 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000022 bytes_write=1092 bytes_read=5354 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999547 adj=49995756 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.611 memavail=7506412 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
MCU 'rpi' shutdown: Command request
clocksync state: mcu_freq=50000000 last_clock=2385604839 clock_est=(1193.088 1254536532 49999547.611) min_half_rtt=0.000047 min_rtt_time=1170.265 time_avg=1193.088(260.932) clock_avg=1254536532.903(13046491907.291) pred_variance=395254135.125 clock_adj=(0.505 49995724.000)
Dumping serial stats: bytes_write=1098 bytes_read=5366 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0
Dumping send queue 100 messages
Sent 0 1169.978260 1169.978260 9: seq: 1a, identify offset=1680 count=40
Sent 1 1169.978538 1169.978538 9: seq: 1b, identify offset=1720 count=40
Sent 2 1169.978821 1169.978821 9: seq: 1c, identify offset=1760 count=40
Sent 3 1169.979102 1169.979102 9: seq: 1d, identify offset=1800 count=40
Sent 4 1169.979382 1169.979382 9: seq: 1e, identify offset=1840 count=40
Sent 5 1169.979659 1169.979659 9: seq: 1f, identify offset=1880 count=40
Sent 6 1169.979939 1169.979939 9: seq: 10, identify offset=1920 count=40
Sent 7 1169.980217 1169.980217 9: seq: 11, identify offset=1960 count=40
Sent 8 1169.980496 1169.980496 9: seq: 12, identify offset=2000 count=40
Sent 9 1169.980774 1169.980774 9: seq: 13, identify offset=2040 count=40
Sent 10 1169.981054 1169.981054 9: seq: 14, identify offset=2080 count=40
Sent 11 1169.981334 1169.981334 9: seq: 15, identify offset=2120 count=40
Sent 12 1169.981630 1169.981630 9: seq: 16, identify offset=2160 count=40
Sent 13 1169.981914 1169.981914 9: seq: 17, identify offset=2200 count=40
Sent 14 1169.982193 1169.982193 9: seq: 18, identify offset=2240 count=40
Sent 15 1169.982474 1169.982474 9: seq: 19, identify offset=2280 count=40
Sent 16 1169.982753 1169.982753 9: seq: 1a, identify offset=2320 count=40
Sent 17 1169.983033 1169.983033 9: seq: 1b, identify offset=2360 count=40
Sent 18 1169.983312 1169.983312 9: seq: 1c, identify offset=2400 count=40
Sent 19 1169.983591 1169.983591 9: seq: 1d, identify offset=2440 count=40
Sent 20 1169.983868 1169.983868 9: seq: 1e, identify offset=2480 count=40
Sent 21 1169.984149 1169.984149 9: seq: 1f, identify offset=2520 count=40
Sent 22 1169.984428 1169.984428 9: seq: 10, identify offset=2560 count=40
Sent 23 1169.984705 1169.984705 9: seq: 11, identify offset=2600 count=40
Sent 24 1169.984983 1169.984983 9: seq: 12, identify offset=2640 count=40
Sent 25 1169.985260 1169.985260 9: seq: 13, identify offset=2680 count=40
Sent 26 1169.985559 1169.985559 9: seq: 14, identify offset=2720 count=40
Sent 27 1169.985841 1169.985841 9: seq: 15, identify offset=2760 count=40
Sent 28 1169.986120 1169.986120 9: seq: 16, identify offset=2800 count=40
Sent 29 1169.986398 1169.986398 9: seq: 17, identify offset=2840 count=40
Sent 30 1169.986678 1169.986678 9: seq: 18, identify offset=2880 count=40
Sent 31 1169.986957 1169.986957 9: seq: 19, identify offset=2920 count=40
Sent 32 1169.987237 1169.987237 9: seq: 1a, identify offset=2960 count=40
Sent 33 1169.987515 1169.987515 9: seq: 1b, identify offset=3000 count=40
Sent 34 1169.987793 1169.987793 9: seq: 1c, identify offset=3040 count=40
Sent 35 1169.988070 1169.988070 9: seq: 1d, identify offset=3080 count=40
Sent 36 1169.988349 1169.988349 9: seq: 1e, identify offset=3120 count=40
Sent 37 1169.988628 1169.988628 9: seq: 1f, identify offset=3160 count=40
Sent 38 1169.988902 1169.988902 9: seq: 10, identify offset=3168 count=40
Sent 39 1170.010034 1170.010034 6: seq: 11, get_uptime
Sent 40 1170.061385 1170.061385 6: seq: 12, get_clock
Sent 41 1170.113007 1170.113007 6: seq: 13, get_clock
Sent 42 1170.163619 1170.163619 6: seq: 14, get_clock
Sent 43 1170.214079 1170.214079 6: seq: 15, get_clock
Sent 44 1170.264511 1170.264511 6: seq: 16, get_clock
Sent 45 1170.314973 1170.314973 6: seq: 17, get_clock
Sent 46 1170.365922 1170.365922 6: seq: 18, get_clock
Sent 47 1170.416472 1170.416472 6: seq: 19, get_clock
Sent 48 1170.417420 1170.417420 6: seq: 1a, get_clock
Sent 49 1170.430649 1170.430649 6: seq: 1b, get_config
Sent 50 1170.431258 1170.431258 7: seq: 1c, allocate_oids count=0
Sent 51 1170.431385 1170.431385 11: seq: 1d, finalize_config crc=3912464276
Sent 52 1170.431465 1170.431465 6: seq: 1e, get_config
Sent 53 1171.401561 1171.401561 6: seq: 1f, get_clock
Sent 54 1172.386162 1172.386162 6: seq: 10, get_clock
Sent 55 1173.370973 1173.370973 6: seq: 11, get_clock
Sent 56 1174.356203 1174.356203 6: seq: 12, get_clock
Sent 57 1175.341155 1175.341155 6: seq: 13, get_clock
Sent 58 1176.325708 1176.325708 6: seq: 14, get_clock
Sent 59 1177.310455 1177.310455 6: seq: 15, get_clock
Sent 60 1178.295281 1178.295281 6: seq: 16, get_clock
Sent 61 1179.280009 1179.280009 6: seq: 17, get_clock
Sent 62 1180.264632 1180.264632 6: seq: 18, get_clock
Sent 63 1181.248970 1181.248970 6: seq: 19, get_clock
Sent 64 1182.233134 1182.233134 6: seq: 1a, get_clock
Sent 65 1183.218054 1183.218054 6: seq: 1b, get_clock
Sent 66 1184.202244 1184.202244 6: seq: 1c, get_clock
Sent 67 1185.187448 1185.187448 6: seq: 1d, get_clock
Sent 68 1186.172294 1186.172294 6: seq: 1e, get_clock
Sent 69 1187.157089 1187.157089 6: seq: 1f, get_clock
Sent 70 1188.141776 1188.141776 6: seq: 10, get_clock
Sent 71 1189.126800 1189.126800 6: seq: 11, get_clock
Sent 72 1190.111542 1190.111542 6: seq: 12, get_clock
Sent 73 1191.096089 1191.096089 6: seq: 13, get_clock
Sent 74 1192.081528 1192.081528 6: seq: 14, get_clock
Sent 75 1193.065587 1193.065587 6: seq: 15, get_clock
Sent 76 1194.050689 1194.050689 6: seq: 16, get_clock
Sent 77 1195.034729 1195.034729 6: seq: 17, get_clock
Sent 78 1196.018740 1196.018740 6: seq: 18, get_clock
Sent 79 1197.003646 1197.003646 6: seq: 19, get_clock
Sent 80 1197.987618 1197.987618 6: seq: 1a, get_clock
Sent 81 1198.971920 1198.971920 6: seq: 1b, get_clock
Sent 82 1199.956135 1199.956135 6: seq: 1c, get_clock
Sent 83 1200.941067 1200.941067 6: seq: 1d, get_clock
Sent 84 1201.925176 1201.925176 6: seq: 1e, get_clock
Sent 85 1202.909719 1202.909719 6: seq: 1f, get_clock
Sent 86 1203.893860 1203.893860 6: seq: 10, get_clock
Sent 87 1204.878671 1204.878671 6: seq: 11, get_clock
Sent 88 1205.863415 1205.863415 6: seq: 12, get_clock
Sent 89 1206.847820 1206.847820 6: seq: 13, get_clock
Sent 90 1207.832673 1207.832673 6: seq: 14, get_clock
Sent 91 1208.816936 1208.816936 6: seq: 15, get_clock
Sent 92 1209.801592 1209.801592 6: seq: 16, get_clock
Sent 93 1210.785873 1210.785873 6: seq: 17, get_clock
Sent 94 1211.770357 1211.770357 6: seq: 18, get_clock
Sent 95 1212.755378 1212.755378 6: seq: 19, get_clock
Sent 96 1213.740174 1213.740174 6: seq: 1a, get_clock
Sent 97 1214.724939 1214.724939 6: seq: 1b, get_clock
Sent 98 1215.709879 1215.709879 6: seq: 1c, get_clock
Sent 99 1216.395301 1216.395301 6: seq: 1d, emergency_stop
Dumping receive queue 100 messages
Receive: 0 1169.980308 1169.980217 49: seq: 12, identify_response offset=1960 data=b'kp\x99\x15\xa4<b\xfc\x86\xd2\xc8\xbfH\xd6L#\x7f\xb2t \x06\x837\xbfY\xect\x1a\x08\xc4\x1f\xd9\r\x90\xa2TZ4=m'
Receive: 1 1169.980587 1169.980496 49: seq: 13, identify_response offset=2000 data=b'\xcd\xa8\xbe\xc4"\xe4\x07<<\x83\xd87b\xf5\xdet\xc0F\xd7\n\x1d}4\x1e\xa6\xaa\x84\x07\x91\x91\xdc(\xa3S\xa7v\x05\x1c\xe3\n'
Receive: 2 1169.980866 1169.980774 49: seq: 14, identify_response offset=2040 data=b'\xf3\xad)\xeb\xf8\xb1\x1bJn;8L7\xa2\xa9\xcd\xf7\xfa\xdd\x9b_\x18\x1a.\x03e\x16\x80\x86r\xd8A\x0eXQ\r\xf4\x86rZ'
Receive: 3 1169.981145 1169.981054 49: seq: 15, identify_response offset=2080 data=b'o]lq2Q\x9da\xa6\xa8\xe5\xd6\x81.\xa9\xb6\xb7\xe6\x82\xda~_ UZ\x8e\x94p\x17c\x01\x02\xf9\xea\xbb\xaf\xa880D'
Receive: 4 1169.981439 1169.981334 49: seq: 16, identify_response offset=2120 data=b'\xa6\x03\xec\x1a\xd2\x94\x99RUd\xb0\xecQR\x7f\x0e\xd0P\xb7\xc0v \xad\xa5~\x8e\x016\x1dX\x96V/\x86MG\x0c\xa3\x0el'
Receive: 5 1169.981722 1169.981630 49: seq: 17, identify_response offset=2160 data=b'[\x94\xb6)Ii\xd6\x11\\\xd7\xa1v\xff\xd8c\x00,\x82\x91\x9f\xc3\x0e\x8b\x995\x8dJm\xe9\x0c\xa4\xa5B9%\x90K,\x03\xf2'
Receive: 6 1169.982004 1169.981914 49: seq: 18, identify_response offset=2200 data=b'\xf6\xc6V\xa0\x89\xf6\xd1z6\xaf\xeb\x1fu\x8d\xb4s\xe2\tiV\xdfx8\xd8Z\xb8)\x9ePw7F\xde\xd4\xd6\xbb\x81\xa2\xbe\xd8'
Receive: 7 1169.982284 1169.982193 49: seq: 19, identify_response offset=2240 data=b's\xc6\xdb\x12\xf2Cc\xa0\xc0\xcb\x8d\x90\x92\xc3\x96P\xa9VS\x8d\xfa\x06\xc4\x98\x963\x9d\xa9(c\xe0\x0f\x1c/\n3\xf2\xcf\x13\x1c'
Receive: 8 1169.982566 1169.982474 49: seq: 1a, identify_response offset=2280 data=b'\x8a\xa1R\x1eJccW\xeb\xf3\xd8F.\x1a\x19\xdfAn\xf0*U-\xc3\xe0k\xd8\xd5\xdd#UO\xef\xb9^\x00\x96B\x03\x1a\x94'
Receive: 9 1169.982844 1169.982753 49: seq: 1b, identify_response offset=2320 data=b'\xc5\x817\xed\x0b\xf4)\xd8\xf2\xb8\xb5\x08G|\xb3G\x01~\x99?\x95\x1c\xa0~\xb3\x96\x92QG9c\xe9\x0bTXryT\xe6\xc4'
Receive: 10 1169.983124 1169.983033 49: seq: 1c, identify_response offset=2360 data=b'_\xa0\xc0,\xf1\x96\x8f\xfaN\x14\xdb\x88!\x9a\xa91s\xc6\x16\xf0,\xd6\xae\xb1}\x04\x8b)\xbf\xab\xdc\x99\xffFs\xab\x1d\xf1\xd8u'
Receive: 11 1169.983402 1169.983312 49: seq: 1d, identify_response offset=2400 data=b'lW(\x99\x90<\xb0[\xf6\xc1W\x11\xed\xf7T\xe3\x9a\x9a\xcb\x1f\x94\x14\x91\x12\xdc\x92\xe4\xaa\xfb\xf7\x01F\xa0\xfb\xcf\xd8a\xd2\xbeC'
Receive: 12 1169.983680 1169.983591 49: seq: 1e, identify_response offset=2440 data=b'\xd2{\x93\x85\xa0\xc6Z\x08\xa6\xfa\x1f\xdb\xe2\x0e\xa3Q\xa7\x15YI\x830\xa8A\xe6\x10@\x13\xe0bq\x05H\x98\xc6\x9a\xda@\x0e\xac'
Receive: 13 1169.983958 1169.983868 49: seq: 1f, identify_response offset=2480 data=b'<\xce\xd2wQ\xebu\x81TT\xa5\x03\xaf\x8e\xc1:\x16\xd8Hlp\x93\xcd\x11\xae;)\xd5IK\xb0\xcf\x11h/\xa7\xa6\xd8\x02\x0b'
Receive: 14 1169.984239 1169.984149 49: seq: 10, identify_response offset=2520 data=b'\x15\xed\x08-;Bs\xb2\xa3\x07,\x07V\xd1h\xc6J\xe4\x831\xfc\xde\xbe{\xa3*;\xea\x87\x1d\xc3d\xcf1iH\xd3%\xb0\xed'
Receive: 15 1169.984518 1169.984428 49: seq: 11, identify_response offset=2560 data=b'\xda\xf3;\x8c<\xca\xf6\x16\\\xcc\x98\xd4\x0e\xd0HM\xfb\xabtv\x87\xd4\n\xc4\xa5{A\rm\r#\xc0\xec\x0cp\xbb\xeaQ4/'
Receive: 16 1169.984795 1169.984705 49: seq: 12, identify_response offset=2600 data=b'\x0fS{\x0f\xca\x07\xa9JEom\xde\xbct\x00\xe0\x86\xbc\x9e\x0e\xb2\xe8\xd4\xa1\xda\x92\xac\x94LU\x1c\xc9j\xfe\xae\x02\xe7\xa9!\x8f'
Receive: 17 1169.985072 1169.984983 49: seq: 13, identify_response offset=2640 data=b'y\x80\x05\x88\t\x95\x9eX\x13\xd9\x1e\xb5g/\xd9/\x90\x0fA\x9ds\x87e\xda\x0e\xdb\xf3\xf2oT\r\xaag[\x9b\x1a\xe9\xc7\xdc\x8a'
Receive: 18 1169.985350 1169.985260 49: seq: 14, identify_response offset=2680 data=b'z\xee\x12\x9b\x9c\xe8\xe1\xc9\xf7\x94\x00F\x10\xd6\xd5\x90\x94\xa9w\xb6\x9f\xaf\xae\xdf\xd2\xf3\x88y P\xe51\x1aX]\x0c\x98E`;'
Receive: 19 1169.985650 1169.985559 49: seq: 15, identify_response offset=2720 data=b'\xe0D\r\x88VMN\x1d\x9f[tREN\x10+_H?\x8f\x9e$0\xff\x84\x82.\x0e7i\xaa\x12n=\xc8T\xc6M\x83,'
Receive: 20 1169.985931 1169.985841 49: seq: 16, identify_response offset=2760 data=b'U.\x02\x06Y\xb6\x86\xef\xf8\x13\xacT\xc3\xc5\xb4h\xec\x01\xben\xbf~\xf7\xd3C\x1c\xa8>\x10$1\x92KW\xd2\xe5\xa2\x9d5\xe0'
Receive: 21 1169.986210 1169.986120 49: seq: 17, identify_response offset=2800 data=b'\x95\xc7\xceOu\x9f\xce\xd1\xc9\x9b\xe7\xe8\x19I\xe15>\x99\x82P\x83\xe0\x1c#\x1d\xe5B\xae\x1e\xdf\x86\xe6f\xc1M\xe8\xe6\xbd\xaa\xd8'
Receive: 22 1169.986489 1169.986398 49: seq: 18, identify_response offset=2840 data=b"U\x8f\x1f\xe7\xcc\xb5\xaa6\x08D\x87\xdcv\xb5\x80Z=\xac\xa8~\xea\x97\xd8\xd6\x14\xfa#w\xbb\x9f\xa3\xc34\x0f+\x12|\xa4}'"
Receive: 23 1169.986768 1169.986678 49: seq: 19, identify_response offset=2880 data=b'\xd9"\x80\x1a\xad\x06\xf4%\x89\x08r\xb1\xb4(\xc6\x16\xf3\xa61\xe3\xea\xd05`\x8c\xc7\x8b\xf8O&(\xd9\xc8\xbd\x13\xe4\xe6\x92\xbc\xe6'
Receive: 24 1169.987046 1169.986957 49: seq: 1a, identify_response offset=2920 data=b'\xaa\x1a\x1b\x99n\\/\xde\xc3\xb5My\xea\xcf\\ .>*8q\xb2eq\xa3[fk\xafC??\xb8\x9c\xcaR\xbd\x10 \x8f'
Receive: 25 1169.987327 1169.987237 49: seq: 1b, identify_response offset=2960 data=b'X;\xc0^\xfe#\xd5V\xf5\x03\xd1\x80\xa1\xd4\xab\xefgm"\x89iZ[\xf2E\x8b\xff\x9c\x1a\x8d\x8ef\xd6\x19v]O\xdd\xdc5'
Receive: 26 1169.987604 1169.987515 49: seq: 1c, identify_response offset=3000 data=b'\xcd\x18j\x1e\xfaK\xdeM\xbb\x1d\x87\x80I\x8dt\xa8f\xc0+\xe4&\x95\x90ZcU[\xd1EX\xd3\xf9?-\x87\xcd\xa9N\xe0\xd1'
Receive: 27 1169.987883 1169.987793 49: seq: 1d, identify_response offset=3040 data=b'm\xf8\xbd\xe5\xd9\xb5D\xf3\xd6\xdb\x9f^\xa3\xea\x8d\x81\xf7P\x19\xf7&\xa3\xdaS:\xcd\x95S\xa3\x7f\xe4\xef\xf4\x8e\xedu\xd3\x16\xad6'
Receive: 28 1169.988160 1169.988070 49: seq: 1e, identify_response offset=3080 data=b'zK\x017\x8d\xbd\xa3\x99\x13\xf9\x0b\x9a<\x19MV\xb7\x1c\xbb\x06\xdc\xf1\t\xb0\xf5F\xdcg~S\xcd\xe9{Y\xd8\x0e\xdf\xc9\xe7?'
Receive: 29 1169.988440 1169.988349 49: seq: 1f, identify_response offset=3120 data=b"\xcf\x0f\x9cc)@\x8fu\x8c\x1e\xc3'\xdfK\xac\xc0\x89\xe9\x7f\xee\x01'\xf6\xb0\xba\x08\xa3\x8b\xd5y\x98D\xe7\xfb\xbbU\xb4\xadVI"
Receive: 30 1169.988716 1169.988628 17: seq: 10, identify_response offset=3160 data=b"\x16|\xfa\x0f\x07\xcd\x00'"
Receive: 31 1169.988991 1169.988902 9: seq: 11, identify_response offset=3168 data=b''
Receive: 32 1170.010207 1170.010034 11: seq: 12, uptime high=0 clock=100636082
Receive: 33 1170.061547 1170.061385 10: seq: 13, clock clock=103203324
Receive: 34 1170.113143 1170.113007 10: seq: 14, clock clock=105783150
Receive: 35 1170.163724 1170.163619 10: seq: 15, clock clock=108312632
Receive: 36 1170.214176 1170.214079 10: seq: 16, clock clock=110835255
Receive: 37 1170.264604 1170.264511 10: seq: 17, clock clock=113356690
Receive: 38 1170.315091 1170.314973 10: seq: 18, clock clock=115880625
Receive: 39 1170.366059 1170.365922 10: seq: 19, clock clock=118428853
Receive: 40 1170.416568 1170.416472 10: seq: 1a, clock clock=120954848
Receive: 41 1170.417560 1170.417420 10: seq: 1b, clock clock=121004119
Receive: 42 1170.430784 1170.430649 10: seq: 1c, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 43 1170.431557 1170.431465 15: seq: 1f, config is_config=1 crc=3912464276 is_shutdown=0 move_count=1024
Receive: 44 1171.401687 1171.401561 10: seq: 10, clock clock=170210003
Receive: 45 1172.386298 1172.386162 11: seq: 11, clock clock=219439738
Receive: 46 1172.997555 1172.386162 14: seq: 11, stats count=148 sum=135645 sumsq=619266
Receive: 47 1173.371306 1173.370973 11: seq: 12, clock clock=268685224
Receive: 48 1174.356531 1174.356203 11: seq: 13, clock clock=317945530
Receive: 49 1175.341528 1175.341155 11: seq: 14, clock clock=367192799
Receive: 50 1176.325847 1176.325708 11: seq: 15, clock clock=416414521
Receive: 51 1177.310587 1177.310455 11: seq: 16, clock clock=465651777
Receive: 52 1177.997654 1177.310455 13: seq: 16, stats count=55 sum=39148 sumsq=271529
Receive: 53 1178.295408 1178.295281 11: seq: 17, clock clock=514892515
Receive: 54 1179.280177 1179.280009 11: seq: 18, clock clock=564129558
Receive: 55 1180.264793 1180.264632 11: seq: 19, clock clock=613359968
Receive: 56 1181.249281 1181.248970 11: seq: 1a, clock clock=662581201
Receive: 57 1182.233419 1182.233134 11: seq: 1b, clock clock=711789033
Receive: 58 1182.997834 1182.233134 13: seq: 1b, stats count=55 sum=33985 sumsq=182414
Receive: 59 1183.218382 1183.218054 11: seq: 1c, clock clock=761036176
Receive: 60 1184.202586 1184.202244 11: seq: 1d, clock clock=810245711
Receive: 61 1185.187717 1185.187448 11: seq: 1e, clock clock=859502047
Receive: 62 1186.172521 1186.172294 11: seq: 1f, clock clock=908742622
Receive: 63 1187.157330 1187.157089 11: seq: 10, clock clock=957982427
Receive: 64 1187.997902 1187.157089 13: seq: 10, stats count=55 sum=53975 sumsq=433732
Receive: 65 1188.142010 1188.141776 11: seq: 11, clock clock=1007216002
Receive: 66 1189.127159 1189.126800 11: seq: 12, clock clock=1056470262
Receive: 67 1190.111828 1190.111542 11: seq: 13, clock clock=1105705059
Receive: 68 1191.096363 1191.096089 11: seq: 14, clock clock=1154932174
Receive: 69 1192.081938 1192.081528 11: seq: 15, clock clock=1204205678
Receive: 70 1192.998047 1192.081528 13: seq: 15, stats count=55 sum=54443 sumsq=457954
Receive: 71 1193.065914 1193.065587 11: seq: 16, clock clock=1253404557
Receive: 72 1194.050985 1194.050689 11: seq: 17, clock clock=1302660461
Receive: 73 1195.034869 1195.034729 11: seq: 18, clock clock=1351858178
Receive: 74 1196.018855 1196.018740 11: seq: 19, clock clock=1401056992
Receive: 75 1197.003760 1197.003646 11: seq: 1a, clock clock=1450301875
Receive: 76 1197.987759 1197.987618 11: seq: 1b, clock clock=1499501232
Receive: 77 1198.097845 1197.987618 13: seq: 1b, stats count=57 sum=37554 sumsq=314190
Receive: 78 1198.972027 1198.971920 11: seq: 1c, clock clock=1548714347
Receive: 79 1199.956417 1199.956135 11: seq: 1d, clock clock=1597929424
Receive: 80 1200.941346 1200.941067 11: seq: 1e, clock clock=1647175453
Receive: 81 1201.925455 1201.925176 11: seq: 1f, clock clock=1696380451
Receive: 82 1202.910085 1202.909719 11: seq: 10, clock clock=1745611529
Receive: 83 1203.098223 1202.909719 13: seq: 10, stats count=55 sum=43737 sumsq=336672
Receive: 84 1203.894148 1203.893860 11: seq: 11, clock clock=1794813978
Receive: 85 1204.878958 1204.878671 11: seq: 12, clock clock=1844053981
Receive: 86 1205.863697 1205.863415 11: seq: 13, clock clock=1893290620
Receive: 87 1206.848110 1206.847820 11: seq: 14, clock clock=1942510732
Receive: 88 1207.832968 1207.832673 11: seq: 15, clock clock=1991753406
Receive: 89 1208.198092 1207.832673 13: seq: 15, stats count=56 sum=55702 sumsq=469406
Receive: 90 1208.817226 1208.816936 11: seq: 16, clock clock=2040965528
Receive: 91 1209.801929 1209.801592 11: seq: 17, clock clock=2090199227
Receive: 92 1210.786203 1210.785873 11: seq: 18, clock clock=2139413744
Receive: 93 1211.770478 1211.770357 11: seq: 19, clock clock=2188630871
Receive: 94 1212.755491 1212.755378 11: seq: 1a, clock clock=2237881051
Receive: 95 1213.297983 1212.755378 13: seq: 1a, stats count=56 sum=44066 sumsq=406281
Receive: 96 1213.740287 1213.740174 11: seq: 1b, clock clock=2287120538
Receive: 97 1214.725054 1214.724939 11: seq: 1c, clock clock=2336358363
Receive: 98 1215.709994 1215.709879 11: seq: 1d, clock clock=2385604839
Receive: 99 1216.395756 1216.395301 12: seq: 1e, shutdown clock=2419883750 static_string_id=Command request
Stats 1217.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=7 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000022 bytes_write=1104 bytes_read=5382 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999547 adj=49995724 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.650 memavail=7506416 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1218.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000015 bytes_write=1110 bytes_read=5411 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999552 adj=49995801 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.669 memavail=7506416 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1219.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=9 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000015 bytes_write=1116 bytes_read=5427 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999558 adj=49995908 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.687 memavail=7506416 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1220.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=10 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000015 bytes_write=1122 bytes_read=5443 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999563 adj=49995997 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.705 memavail=7506416 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1221.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=11 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000015 bytes_write=1128 bytes_read=5459 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999567 adj=49996055 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.725 memavail=7506416 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1222.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=12 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000015 bytes_write=1134 bytes_read=5475 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999570 adj=49996098 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.743 memavail=7505236 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1223.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=13 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=1140 bytes_read=5504 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999573 adj=49996123 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.763 memavail=7505236 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1224.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=14 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=1146 bytes_read=5520 bytes_retransmit=0 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999581 adj=49996135 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.781 memavail=7505292 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1225.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=15 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=1152 bytes_read=5536 bytes_retransmit=0 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999584 adj=49996195 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.52 cputime=28.800 memavail=7505292 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1226.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=16 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=1158 bytes_read=5552 bytes_retransmit=0 bytes_invalid=0 send_seq=168 receive_seq=168 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999587 adj=49996195 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.818 memavail=7505288 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1227.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10256 bytes_read=22799 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=17 freq=400028152 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000021 bytes_write=1164 bytes_read=5568 bytes_retransmit=0 bytes_invalid=0 send_seq=169 receive_seq=169 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999585 adj=49996198 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.48 cputime=28.835 memavail=7500752 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Unable to issue reset command on MCU 'mcu'
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4123808744: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:48:25 2024 (1713156505.5 1279.0)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND COLOR=info MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND COLOR=info MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND COLOR=error MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	{% if printer.extruder.temperature < 49.0 and printer.heater_bed.temperature < 50.0 and (printer.state == "Idle" or printer.state == "Ready") %}
	RESPOND COLOR=info MSG="Printer shutting down"
	_SHUTDOWN_HOST
	{% else %}
	RESPOND COLOR=error MSG="Cannot shut down: extruder temperature too high or printer is busy"
	{% endif %}

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND COLOR=info MSG="Powering printer off"
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
webhooks client 4124190824: New connection
webhooks client 4124190824: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)
Failed to verify BLTouch probe is raised; retrying.

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 1292.0: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000011 mcu_task_stddev=0.000085 bytes_write=9654 bytes_read=13529 bytes_retransmit=9 bytes_invalid=0 send_seq=646 receive_seq=646 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027983 rpi: mcu_awake=0.003 mcu_task_avg=0.000019 mcu_task_stddev=0.000012 bytes_write=852 bytes_read=4634 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999645 adj=49989330 Octopus_Max: temp=39.2 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.37 cputime=31.139 memavail=7503696 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-75.6 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4124190824
webhooks: registering remote method 'reboot_machine' for connection id: 4124190824
webhooks: registering remote method 'pause_job_queue' for connection id: 4124190824
webhooks: registering remote method 'start_job_queue' for connection id: 4124190824
webhooks: registering remote method 'set_device_power' for connection id: 4124190824
Stats 1293.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9660 bytes_read=13786 bytes_retransmit=9 bytes_invalid=0 send_seq=647 receive_seq=647 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027759 rpi: mcu_awake=0.003 mcu_task_avg=0.000019 mcu_task_stddev=0.000012 bytes_write=858 bytes_read=4650 bytes_retransmit=0 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999555 adj=50006523 Octopus_Max: temp=39.2 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.37 cputime=31.181 memavail=7502120 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1294.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9666 bytes_read=14021 bytes_retransmit=9 bytes_invalid=0 send_seq=648 receive_seq=648 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027795 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000017 bytes_write=864 bytes_read=4679 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999524 adj=50003758 Octopus_Max: temp=39.3 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.37 cputime=31.198 memavail=7502156 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1295.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9672 bytes_read=14279 bytes_retransmit=9 bytes_invalid=0 send_seq=649 receive_seq=649 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027741 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000017 bytes_write=870 bytes_read=4695 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999501 adj=50001734 Octopus_Max: temp=39.5 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.37 cputime=31.210 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1296.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9678 bytes_read=14523 bytes_retransmit=9 bytes_invalid=0 send_seq=650 receive_seq=650 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027741 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000017 bytes_write=876 bytes_read=4711 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999467 adj=50000261 Octopus_Max: temp=39.6 Pi: temp=37.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.37 cputime=31.221 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1297.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000008 bytes_write=9684 bytes_read=14767 bytes_retransmit=9 bytes_invalid=0 send_seq=651 receive_seq=651 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027738 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000017 bytes_write=882 bytes_read=4727 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999660 adj=49999087 Octopus_Max: temp=39.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.34 cputime=31.237 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1298.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9690 bytes_read=15039 bytes_retransmit=9 bytes_invalid=0 send_seq=652 receive_seq=652 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027926 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000017 bytes_write=888 bytes_read=4743 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999693 adj=49999020 Octopus_Max: temp=39.5 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.34 cputime=31.262 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1299.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9696 bytes_read=15283 bytes_retransmit=9 bytes_invalid=0 send_seq=653 receive_seq=653 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028157 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=894 bytes_read=4772 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999712 adj=49998343 Octopus_Max: temp=39.6 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.34 cputime=31.287 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1300.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9718 bytes_read=15557 bytes_retransmit=9 bytes_invalid=0 send_seq=656 receive_seq=656 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028314 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=900 bytes_read=4788 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999719 adj=49997768 Octopus_Max: temp=39.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.34 cputime=31.318 memavail=7501932 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1301.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9724 bytes_read=15815 bytes_retransmit=9 bytes_invalid=0 send_seq=657 receive_seq=657 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028348 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=906 bytes_read=4804 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999723 adj=49997317 Octopus_Max: temp=39.6 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.34 cputime=31.343 memavail=7501952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1302.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9730 bytes_read=16059 bytes_retransmit=9 bytes_invalid=0 send_seq=658 receive_seq=658 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028319 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=912 bytes_read=4820 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999728 adj=49997028 Octopus_Max: temp=39.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.31 cputime=31.368 memavail=7501952 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1303.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9736 bytes_read=16317 bytes_retransmit=9 bytes_invalid=0 send_seq=659 receive_seq=659 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028311 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=918 bytes_read=4836 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999746 adj=49996860 Octopus_Max: temp=39.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.31 cputime=31.391 memavail=7501956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1304.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9742 bytes_read=16568 bytes_retransmit=9 bytes_invalid=0 send_seq=660 receive_seq=660 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028332 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=924 bytes_read=4865 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999760 adj=49996785 Octopus_Max: temp=39.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.31 cputime=31.417 memavail=7501956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1305.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9748 bytes_read=16809 bytes_retransmit=9 bytes_invalid=0 send_seq=661 receive_seq=661 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028315 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=930 bytes_read=4881 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999751 adj=49996698 Octopus_Max: temp=39.9 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.31 cputime=31.441 memavail=7501956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1306.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9754 bytes_read=17053 bytes_retransmit=9 bytes_invalid=0 send_seq=662 receive_seq=662 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028280 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=936 bytes_read=4897 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999745 adj=49996542 Octopus_Max: temp=39.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.31 cputime=31.467 memavail=7501956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1307.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9760 bytes_read=17311 bytes_retransmit=9 bytes_invalid=0 send_seq=663 receive_seq=663 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028291 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=942 bytes_read=4913 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999732 adj=49996450 Octopus_Max: temp=39.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.28 cputime=31.492 memavail=7501956 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1308.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9766 bytes_read=17569 bytes_retransmit=9 bytes_invalid=0 send_seq=664 receive_seq=664 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028326 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=948 bytes_read=4929 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999727 adj=49996310 Octopus_Max: temp=39.7 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.28 cputime=31.517 memavail=7501960 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1309.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9772 bytes_read=17813 bytes_retransmit=9 bytes_invalid=0 send_seq=665 receive_seq=665 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028287 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=954 bytes_read=4958 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999698 adj=49996223 Octopus_Max: temp=39.8 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.28 cputime=31.538 memavail=7496688 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1310.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9778 bytes_read=18071 bytes_retransmit=9 bytes_invalid=0 send_seq=666 receive_seq=666 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028202 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=960 bytes_read=4974 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999672 adj=49996068 Octopus_Max: temp=39.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.28 cputime=31.549 memavail=7502092 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1311.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9784 bytes_read=18315 bytes_retransmit=9 bytes_invalid=0 send_seq=667 receive_seq=667 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028116 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=966 bytes_read=4990 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999645 adj=49995996 Octopus_Max: temp=40.1 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.28 cputime=31.559 memavail=7502092 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1312.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9790 bytes_read=18559 bytes_retransmit=9 bytes_invalid=0 send_seq=668 receive_seq=668 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028049 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=972 bytes_read=5006 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999613 adj=49995930 Octopus_Max: temp=39.9 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.26 cputime=31.570 memavail=7502092 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1313.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9796 bytes_read=18846 bytes_retransmit=9 bytes_invalid=0 send_seq=669 receive_seq=669 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028140 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=978 bytes_read=5022 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999587 adj=49995828 Octopus_Max: temp=40.1 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.26 cputime=31.581 memavail=7501868 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1314.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9802 bytes_read=19075 bytes_retransmit=9 bytes_invalid=0 send_seq=670 receive_seq=670 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028211 rpi: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=984 bytes_read=5051 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999588 adj=49995642 Octopus_Max: temp=40.1 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.26 cputime=31.597 memavail=7501868 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1315.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9808 bytes_read=19310 bytes_retransmit=9 bytes_invalid=0 send_seq=671 receive_seq=671 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028223 rpi: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=990 bytes_read=5067 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999591 adj=49995696 Octopus_Max: temp=39.9 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.26 cputime=31.623 memavail=7501868 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1316.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9814 bytes_read=19582 bytes_retransmit=9 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028221 rpi: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=996 bytes_read=5083 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999596 adj=49995796 Octopus_Max: temp=40.1 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.26 cputime=31.648 memavail=7501868 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1317.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9820 bytes_read=19811 bytes_retransmit=9 bytes_invalid=0 send_seq=673 receive_seq=673 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028223 rpi: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1002 bytes_read=5099 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999596 adj=49995899 Octopus_Max: temp=40.1 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.24 cputime=31.673 memavail=7501868 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1318.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9826 bytes_read=20069 bytes_retransmit=9 bytes_invalid=0 send_seq=674 receive_seq=674 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028220 rpi: mcu_awake=0.001 mcu_task_avg=0.000009 mcu_task_stddev=0.000010 bytes_write=1008 bytes_read=5115 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999599 adj=49995943 Octopus_Max: temp=40.1 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.24 cputime=31.699 memavail=7501872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1319.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9832 bytes_read=20342 bytes_retransmit=9 bytes_invalid=0 send_seq=675 receive_seq=675 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028206 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1014 bytes_read=5144 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999602 adj=49996000 Octopus_Max: temp=40.2 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.24 cputime=31.724 memavail=7501872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1320.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9838 bytes_read=20571 bytes_retransmit=9 bytes_invalid=0 send_seq=676 receive_seq=676 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028204 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1020 bytes_read=5160 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999601 adj=49996058 Octopus_Max: temp=40.3 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.24 cputime=31.749 memavail=7501872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1321.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9844 bytes_read=20815 bytes_retransmit=9 bytes_invalid=0 send_seq=677 receive_seq=677 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028187 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1026 bytes_read=5176 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999599 adj=49996052 Octopus_Max: temp=40.2 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.24 cputime=31.773 memavail=7501872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1322.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9850 bytes_read=21088 bytes_retransmit=9 bytes_invalid=0 send_seq=678 receive_seq=678 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028180 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1032 bytes_read=5192 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999611 adj=49996059 Octopus_Max: temp=40.2 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.22 cputime=31.799 memavail=7501872 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1323.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9862 bytes_read=21347 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028184 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000018 bytes_write=1038 bytes_read=5208 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999632 adj=49996176 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.22 cputime=31.824 memavail=7502148 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1324.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9868 bytes_read=21591 bytes_retransmit=9 bytes_invalid=0 send_seq=681 receive_seq=681 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028179 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1044 bytes_read=5237 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999644 adj=49996324 Octopus_Max: temp=40.3 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.22 cputime=31.849 memavail=7502148 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1325.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9874 bytes_read=21864 bytes_retransmit=9 bytes_invalid=0 send_seq=682 receive_seq=682 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028126 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1050 bytes_read=5253 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999642 adj=49996378 Octopus_Max: temp=40.4 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.22 cputime=31.872 memavail=7495600 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1326.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9880 bytes_read=22082 bytes_retransmit=9 bytes_invalid=0 send_seq=683 receive_seq=683 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028079 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1056 bytes_read=5269 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999623 adj=49996352 Octopus_Max: temp=40.3 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.22 cputime=31.883 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1327.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9886 bytes_read=22326 bytes_retransmit=9 bytes_invalid=0 send_seq=684 receive_seq=684 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028029 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1062 bytes_read=5285 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999604 adj=49996180 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.20 cputime=31.894 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1328.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9892 bytes_read=22613 bytes_retransmit=9 bytes_invalid=0 send_seq=685 receive_seq=685 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027984 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000020 bytes_write=1068 bytes_read=5301 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999590 adj=49996054 Octopus_Max: temp=40.3 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.20 cputime=31.905 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1329.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9898 bytes_read=22842 bytes_retransmit=9 bytes_invalid=0 send_seq=686 receive_seq=686 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027949 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000020 bytes_write=1074 bytes_read=5330 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999576 adj=49995988 Octopus_Max: temp=40.5 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.20 cputime=31.915 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1330.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9904 bytes_read=23086 bytes_retransmit=9 bytes_invalid=0 send_seq=687 receive_seq=687 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027953 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000020 bytes_write=1080 bytes_read=5346 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999566 adj=49995921 Octopus_Max: temp=40.4 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.20 cputime=31.928 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1331.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9910 bytes_read=23359 bytes_retransmit=9 bytes_invalid=0 send_seq=688 receive_seq=688 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027955 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000020 bytes_write=1086 bytes_read=5362 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999575 adj=49995862 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.20 cputime=31.953 memavail=7502276 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1332.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9916 bytes_read=23588 bytes_retransmit=9 bytes_invalid=0 send_seq=689 receive_seq=689 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027955 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000020 bytes_write=1092 bytes_read=5378 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999583 adj=49996001 Octopus_Max: temp=40.5 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.19 cputime=31.978 memavail=7502296 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1333.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9922 bytes_read=23846 bytes_retransmit=9 bytes_invalid=0 send_seq=690 receive_seq=690 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027957 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000020 bytes_write=1098 bytes_read=5394 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999584 adj=49996094 Octopus_Max: temp=40.4 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.19 cputime=32.005 memavail=7501576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1334.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9928 bytes_read=24119 bytes_retransmit=9 bytes_invalid=0 send_seq=691 receive_seq=691 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027975 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1104 bytes_read=5423 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999585 adj=49996106 Octopus_Max: temp=40.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.19 cputime=32.031 memavail=7501576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1335.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9934 bytes_read=24348 bytes_retransmit=9 bytes_invalid=0 send_seq=692 receive_seq=692 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027976 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1110 bytes_read=5439 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999588 adj=49996091 Octopus_Max: temp=40.7 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.19 cputime=32.056 memavail=7501576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1336.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9940 bytes_read=24588 bytes_retransmit=9 bytes_invalid=0 send_seq=693 receive_seq=693 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027973 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1116 bytes_read=5455 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999597 adj=49996120 Octopus_Max: temp=40.4 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.19 cputime=32.081 memavail=7501576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1337.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9946 bytes_read=24852 bytes_retransmit=9 bytes_invalid=0 send_seq=694 receive_seq=694 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027981 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1122 bytes_read=5471 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999601 adj=49996201 Octopus_Max: temp=40.7 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.17 cputime=32.106 memavail=7501576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1338.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9952 bytes_read=25095 bytes_retransmit=9 bytes_invalid=0 send_seq=695 receive_seq=695 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027980 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1128 bytes_read=5487 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999608 adj=49996215 Octopus_Max: temp=40.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.17 cputime=32.131 memavail=7501588 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1339.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9958 bytes_read=25339 bytes_retransmit=9 bytes_invalid=0 send_seq=696 receive_seq=696 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027991 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1134 bytes_read=5516 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999606 adj=49996256 Octopus_Max: temp=40.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.17 cputime=32.157 memavail=7501588 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1340.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9964 bytes_read=25612 bytes_retransmit=9 bytes_invalid=0 send_seq=697 receive_seq=697 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028002 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1140 bytes_read=5532 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999605 adj=49996188 Octopus_Max: temp=40.7 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.17 cputime=32.182 memavail=7501736 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1341.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9970 bytes_read=25841 bytes_retransmit=9 bytes_invalid=0 send_seq=698 receive_seq=698 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027996 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1146 bytes_read=5548 bytes_retransmit=0 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999601 adj=49996138 Octopus_Max: temp=40.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.17 cputime=32.208 memavail=7501088 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1342.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9976 bytes_read=26085 bytes_retransmit=9 bytes_invalid=0 send_seq=699 receive_seq=699 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027960 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1152 bytes_read=5564 bytes_retransmit=0 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999595 adj=49996097 Octopus_Max: temp=40.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.24 cputime=32.220 memavail=7503452 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1400.1: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=10330 bytes_read=40662 bytes_retransmit=9 bytes_invalid=0 send_seq=758 receive_seq=758 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027849 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000020 bytes_write=1506 bytes_read=6658 bytes_retransmit=0 bytes_invalid=0 send_seq=226 receive_seq=226 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999577 adj=49996056 Octopus_Max: temp=41.3 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.13 cputime=33.354 memavail=7504520 print_time=117.731 buffer_time=0.186 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4124190824: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:50:27 2024 (1713156627.9 1401.4)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND COLOR=info MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND COLOR=info MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND COLOR=error MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND COLOR=info MSG="Powering printer off"
	G4 P3000
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4124526048: New connection
webhooks client 4124526048: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)
Failed to verify BLTouch probe is raised; retrying.

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 1409.3: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9379 bytes_read=13328 bytes_retransmit=9 bytes_invalid=0 send_seq=591 receive_seq=591 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027764 rpi: mcu_awake=0.003 mcu_task_avg=0.000018 mcu_task_stddev=0.000010 bytes_write=841 bytes_read=4589 bytes_retransmit=0 bytes_invalid=0 send_seq=115 receive_seq=115 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999260 adj=49986547 Octopus_Max: temp=41.2 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.19 cputime=34.821 memavail=7503476 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4124526048
webhooks: registering remote method 'reboot_machine' for connection id: 4124526048
webhooks: registering remote method 'pause_job_queue' for connection id: 4124526048
webhooks: registering remote method 'start_job_queue' for connection id: 4124526048
webhooks: registering remote method 'set_device_power' for connection id: 4124526048
Stats 1410.3: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9385 bytes_read=13572 bytes_retransmit=9 bytes_invalid=0 send_seq=592 receive_seq=592 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027669 rpi: mcu_awake=0.003 mcu_task_avg=0.000018 mcu_task_stddev=0.000010 bytes_write=847 bytes_read=4605 bytes_retransmit=0 bytes_invalid=0 send_seq=116 receive_seq=116 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999359 adj=50010289 Octopus_Max: temp=41.4 Pi: temp=38.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.7 sysload=0.19 cputime=34.858 memavail=7503848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1411.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000007 bytes_write=9391 bytes_read=13811 bytes_retransmit=9 bytes_invalid=0 send_seq=593 receive_seq=593 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027595 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=853 bytes_read=4634 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999400 adj=50006968 Octopus_Max: temp=41.4 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.18 cputime=34.871 memavail=7503860 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1412.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000007 bytes_write=9397 bytes_read=14079 bytes_retransmit=9 bytes_invalid=0 send_seq=594 receive_seq=594 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028623 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=865 bytes_read=4666 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999686 adj=50004349 Octopus_Max: temp=41.4 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.7 sysload=0.18 cputime=34.897 memavail=7503860 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1413.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000007 bytes_write=9403 bytes_read=14323 bytes_retransmit=9 bytes_invalid=0 send_seq=595 receive_seq=595 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028704 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=871 bytes_read=4682 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999748 adj=50002741 Octopus_Max: temp=41.4 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.18 cputime=34.921 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1414.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000007 bytes_write=9409 bytes_read=14552 bytes_retransmit=9 bytes_invalid=0 send_seq=596 receive_seq=596 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028706 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=877 bytes_read=4698 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999780 adj=50001258 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.18 cputime=34.946 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1415.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000007 bytes_write=9431 bytes_read=14855 bytes_retransmit=9 bytes_invalid=0 send_seq=599 receive_seq=599 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028733 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000008 bytes_write=883 bytes_read=4714 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999832 adj=50000096 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.7 sysload=0.18 cputime=34.976 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1416.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9437 bytes_read=15113 bytes_retransmit=9 bytes_invalid=0 send_seq=600 receive_seq=600 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028748 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=889 bytes_read=4743 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999878 adj=49999306 Octopus_Max: temp=41.5 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.16 cputime=35.001 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1417.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9443 bytes_read=15342 bytes_retransmit=9 bytes_invalid=0 send_seq=601 receive_seq=601 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028986 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=895 bytes_read=4759 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999892 adj=49998720 Octopus_Max: temp=41.5 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.16 cputime=35.026 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1418.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9449 bytes_read=15615 bytes_retransmit=9 bytes_invalid=0 send_seq=602 receive_seq=602 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028915 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=901 bytes_read=4775 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999902 adj=49998040 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.16 cputime=35.051 memavail=7503864 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1419.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9455 bytes_read=15859 bytes_retransmit=9 bytes_invalid=0 send_seq=603 receive_seq=603 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028855 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=907 bytes_read=4791 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999910 adj=49997682 Octopus_Max: temp=41.4 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.16 cputime=35.077 memavail=7503640 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1420.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9461 bytes_read=16088 bytes_retransmit=9 bytes_invalid=0 send_seq=604 receive_seq=604 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028817 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=913 bytes_read=4807 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999884 adj=49997407 Octopus_Max: temp=41.5 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.16 cputime=35.102 memavail=7503640 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1421.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9467 bytes_read=16375 bytes_retransmit=9 bytes_invalid=0 send_seq=605 receive_seq=605 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028816 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=919 bytes_read=4836 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999851 adj=49997028 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.15 cputime=35.128 memavail=7503664 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1422.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9473 bytes_read=16608 bytes_retransmit=9 bytes_invalid=0 send_seq=606 receive_seq=606 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028734 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=925 bytes_read=4852 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999834 adj=49996675 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.15 cputime=35.152 memavail=7502908 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1423.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9479 bytes_read=16837 bytes_retransmit=9 bytes_invalid=0 send_seq=607 receive_seq=607 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028777 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=931 bytes_read=4868 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999778 adj=49996535 Octopus_Max: temp=41.4 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.15 cputime=35.164 memavail=7503836 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1424.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9485 bytes_read=17110 bytes_retransmit=9 bytes_invalid=0 send_seq=608 receive_seq=608 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028796 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=937 bytes_read=4884 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999736 adj=49996123 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.15 cputime=35.175 memavail=7503836 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1425.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9491 bytes_read=17354 bytes_retransmit=9 bytes_invalid=0 send_seq=609 receive_seq=609 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028592 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=943 bytes_read=4900 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999701 adj=49995887 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.15 cputime=35.185 memavail=7503836 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1426.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9497 bytes_read=17597 bytes_retransmit=9 bytes_invalid=0 send_seq=610 receive_seq=610 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028464 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000017 bytes_write=949 bytes_read=4929 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999669 adj=49995894 Octopus_Max: temp=41.5 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.14 cputime=35.196 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1427.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9503 bytes_read=17870 bytes_retransmit=9 bytes_invalid=0 send_seq=611 receive_seq=611 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028376 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000017 bytes_write=955 bytes_read=4945 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999648 adj=49995860 Octopus_Max: temp=41.2 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.14 cputime=35.207 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1428.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9509 bytes_read=18114 bytes_retransmit=9 bytes_invalid=0 send_seq=612 receive_seq=612 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028496 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000017 bytes_write=961 bytes_read=4961 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999690 adj=49995859 Octopus_Max: temp=41.5 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.14 cputime=35.232 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1429.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9515 bytes_read=18343 bytes_retransmit=9 bytes_invalid=0 send_seq=613 receive_seq=613 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028460 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000017 bytes_write=967 bytes_read=4977 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999712 adj=49996091 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.14 cputime=35.257 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1430.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9521 bytes_read=18616 bytes_retransmit=9 bytes_invalid=0 send_seq=614 receive_seq=614 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028566 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000017 bytes_write=973 bytes_read=4993 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999731 adj=49996276 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.14 cputime=35.282 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1431.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9527 bytes_read=18874 bytes_retransmit=9 bytes_invalid=0 send_seq=615 receive_seq=615 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028481 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=979 bytes_read=5022 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999744 adj=49996287 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.13 cputime=35.307 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1432.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9533 bytes_read=19103 bytes_retransmit=9 bytes_invalid=0 send_seq=616 receive_seq=616 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028424 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=985 bytes_read=5038 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999746 adj=49996422 Octopus_Max: temp=41.5 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.13 cputime=35.332 memavail=7503840 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1433.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9539 bytes_read=19368 bytes_retransmit=9 bytes_invalid=0 send_seq=617 receive_seq=617 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028374 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=991 bytes_read=5054 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999739 adj=49996426 Octopus_Max: temp=41.5 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.13 cputime=35.357 memavail=7503848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1434.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9545 bytes_read=19612 bytes_retransmit=9 bytes_invalid=0 send_seq=618 receive_seq=618 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028331 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=997 bytes_read=5070 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999731 adj=49996363 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.7 sysload=0.13 cputime=35.382 memavail=7503848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1435.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9551 bytes_read=19841 bytes_retransmit=9 bytes_invalid=0 send_seq=619 receive_seq=619 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028303 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1003 bytes_read=5086 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999724 adj=49996300 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.13 cputime=35.406 memavail=7503848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1436.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9557 bytes_read=20128 bytes_retransmit=9 bytes_invalid=0 send_seq=620 receive_seq=620 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028282 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1009 bytes_read=5115 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999716 adj=49996246 Octopus_Max: temp=41.7 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.12 cputime=35.432 memavail=7503848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1437.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9563 bytes_read=20372 bytes_retransmit=9 bytes_invalid=0 send_seq=621 receive_seq=621 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028244 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1015 bytes_read=5131 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999708 adj=49996194 Octopus_Max: temp=41.6 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.12 cputime=35.457 memavail=7504144 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1438.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9569 bytes_read=20601 bytes_retransmit=9 bytes_invalid=0 send_seq=622 receive_seq=622 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028174 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1021 bytes_read=5147 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999691 adj=49996166 Octopus_Max: temp=41.5 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.12 cputime=35.474 memavail=7503584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1439.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9575 bytes_read=20874 bytes_retransmit=9 bytes_invalid=0 send_seq=623 receive_seq=623 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028119 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1027 bytes_read=5163 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999695 adj=49996100 Octopus_Max: temp=41.5 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.12 cputime=35.489 memavail=7501876 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1440.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9581 bytes_read=21118 bytes_retransmit=9 bytes_invalid=0 send_seq=624 receive_seq=624 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028049 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1033 bytes_read=5179 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999672 adj=49996207 Octopus_Max: temp=41.8 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.12 cputime=35.500 memavail=7501876 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1441.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9587 bytes_read=21361 bytes_retransmit=9 bytes_invalid=0 send_seq=625 receive_seq=625 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028002 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1039 bytes_read=5195 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999656 adj=49996080 Octopus_Max: temp=41.7 Pi: temp=37.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.11 cputime=35.510 memavail=7501876 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1442.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9593 bytes_read=21634 bytes_retransmit=9 bytes_invalid=0 send_seq=626 receive_seq=626 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027945 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000014 bytes_write=1045 bytes_read=5224 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999641 adj=49996015 Octopus_Max: temp=41.7 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.7 sysload=0.11 cputime=35.521 memavail=7501876 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1443.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9599 bytes_read=21872 bytes_retransmit=9 bytes_invalid=0 send_seq=627 receive_seq=627 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027911 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000014 bytes_write=1051 bytes_read=5240 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999642 adj=49995983 Octopus_Max: temp=41.8 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.11 cputime=35.540 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1444.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9605 bytes_read=22094 bytes_retransmit=9 bytes_invalid=0 send_seq=628 receive_seq=628 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027921 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000014 bytes_write=1057 bytes_read=5256 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999649 adj=49996078 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.11 cputime=35.564 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1445.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9617 bytes_read=22383 bytes_retransmit=9 bytes_invalid=0 send_seq=630 receive_seq=630 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027956 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000014 bytes_write=1063 bytes_read=5272 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999655 adj=49996142 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.11 cputime=35.591 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1446.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9623 bytes_read=22641 bytes_retransmit=9 bytes_invalid=0 send_seq=631 receive_seq=631 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027957 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000014 bytes_write=1069 bytes_read=5288 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999656 adj=49996165 Octopus_Max: temp=41.6 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.10 cputime=35.615 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1447.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9629 bytes_read=22884 bytes_retransmit=9 bytes_invalid=0 send_seq=632 receive_seq=632 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027976 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1075 bytes_read=5317 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999660 adj=49996173 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.10 cputime=35.641 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1448.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9635 bytes_read=23143 bytes_retransmit=9 bytes_invalid=0 send_seq=633 receive_seq=633 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027967 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1081 bytes_read=5333 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999655 adj=49996179 Octopus_Max: temp=41.7 Pi: temp=35.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.10 cputime=35.665 memavail=7501912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1449.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9641 bytes_read=23387 bytes_retransmit=9 bytes_invalid=0 send_seq=634 receive_seq=634 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027969 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1087 bytes_read=5349 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999652 adj=49996145 Octopus_Max: temp=41.6 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.10 cputime=35.690 memavail=7501920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1450.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9647 bytes_read=23630 bytes_retransmit=9 bytes_invalid=0 send_seq=635 receive_seq=635 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027967 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1093 bytes_read=5365 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999648 adj=49996112 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.10 cputime=35.715 memavail=7501920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1451.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9653 bytes_read=23903 bytes_retransmit=9 bytes_invalid=0 send_seq=636 receive_seq=636 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027963 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000019 bytes_write=1099 bytes_read=5381 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999645 adj=49996092 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.09 cputime=35.740 memavail=7501920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1452.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9659 bytes_read=24147 bytes_retransmit=9 bytes_invalid=0 send_seq=637 receive_seq=637 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027958 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=1105 bytes_read=5410 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999646 adj=49996077 Octopus_Max: temp=41.6 Pi: temp=35.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.09 cputime=35.765 memavail=7501920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1453.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9665 bytes_read=24390 bytes_retransmit=9 bytes_invalid=0 send_seq=638 receive_seq=638 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027952 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=1111 bytes_read=5426 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999648 adj=49996112 Octopus_Max: temp=41.7 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.09 cputime=35.789 memavail=7501684 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1454.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9671 bytes_read=24640 bytes_retransmit=9 bytes_invalid=0 send_seq=639 receive_seq=639 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027944 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=1117 bytes_read=5442 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999640 adj=49996146 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.09 cputime=35.815 memavail=7502196 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1455.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9677 bytes_read=24882 bytes_retransmit=9 bytes_invalid=0 send_seq=640 receive_seq=640 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027908 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=1123 bytes_read=5458 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999642 adj=49996085 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.09 cputime=35.832 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1456.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9683 bytes_read=25139 bytes_retransmit=9 bytes_invalid=0 send_seq=641 receive_seq=641 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027877 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000018 bytes_write=1129 bytes_read=5474 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999631 adj=49996164 Octopus_Max: temp=41.7 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=35.843 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1457.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9689 bytes_read=25398 bytes_retransmit=9 bytes_invalid=0 send_seq=642 receive_seq=642 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027846 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=1135 bytes_read=5503 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999622 adj=49996086 Octopus_Max: temp=41.6 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=35.854 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1458.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9695 bytes_read=25642 bytes_retransmit=9 bytes_invalid=0 send_seq=643 receive_seq=643 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027828 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=1141 bytes_read=5519 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999612 adj=49996047 Octopus_Max: temp=41.7 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=35.864 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1459.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9701 bytes_read=25900 bytes_retransmit=9 bytes_invalid=0 send_seq=644 receive_seq=644 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027806 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=1147 bytes_read=5535 bytes_retransmit=0 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999605 adj=49995985 Octopus_Max: temp=41.6 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.9 sysload=0.08 cputime=35.875 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1460.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9707 bytes_read=26144 bytes_retransmit=9 bytes_invalid=0 send_seq=645 receive_seq=645 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027821 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=1153 bytes_read=5551 bytes_retransmit=0 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999597 adj=49995981 Octopus_Max: temp=41.6 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.08 cputime=35.893 memavail=7502560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1466.4: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9743 bytes_read=27654 bytes_retransmit=9 bytes_invalid=0 send_seq=651 receive_seq=651 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400027829 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=1189 bytes_read=5660 bytes_retransmit=0 bytes_invalid=0 send_seq=173 receive_seq=173 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999609 adj=49996116 Octopus_Max: temp=41.8 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.9 sysload=0.07 cputime=36.044 memavail=7502352 print_time=66.353 buffer_time=0.488 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Attempting MCU 'mcu' reset command
Attempting MCU 'rpi' config_reset command
b'Got EOF when reading from device'
webhooks client 4124526048: Disconnected
Restarting printer
Start printer at Mon Apr 15 05:51:34 2024 (1713156694.5 1468.0)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND COLOR=info MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND COLOR=info MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND COLOR=error MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND COLOR=info MSG="Powering printer off"
	G4 P3000
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
webhooks client 4123601912: New connection
webhooks client 4123601912: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
Loaded MCU 'mcu' 106 commands (v0.12.0-142-gb029d046 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c3_PA8_PC9=PA8,PC9 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'rpi': Starting connect
Loaded MCU 'rpi' 112 commands (v0.12.0-142-gb029d046 / gcc: (Raspbian 10.2.1-6+rpi1) 10.2.1 20210110 binutils: (GNU Binutils for Raspbian) 2.35.2)
MCU 'rpi' config: ADC_MAX=4095 CLOCK_FREQ=50000000 MCU=linux PCA9685_MAX=4096 PWM_MAX=32768 STATS_SUMSQ_BASE=256
mcu_temperature 'mcu' nominal base=-273.952569 slope=1618.577075
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'rpi' printer configuration...
Configured MCU 'rpi' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (40.0, 23.0)    | (10.0, 8.4)
  1   | (57.8, 23.0)    | (27.8, 8.4)
  2   | (75.5, 23.0)    | (45.5, 8.4)
  3   | (93.3, 23.0)    | (63.3, 8.4)
  4   | (111.1, 23.0)   | (81.1, 8.4)
  5   | (128.8, 23.0)   | (98.8, 8.4)
  6   | (146.6, 23.0)   | (116.6, 8.4)
  7   | (164.4, 23.0)   | (134.4, 8.4)
  8   | (182.2, 23.0)   | (152.2, 8.4)
  9   | (199.9, 23.0)   | (169.9, 8.4)
  10  | (199.9, 42.7)   | (169.9, 28.1)
  11  | (182.2, 42.7)   | (152.2, 28.1)
  12  | (164.4, 42.7)   | (134.4, 28.1)
  13  | (146.6, 42.7)   | (116.6, 28.1)
  14  | (128.9, 42.7)   | (98.9, 28.1)
  15  | (111.1, 42.7)   | (81.1, 28.1)
  16  | (93.3, 42.7)    | (63.3, 28.1)
  17  | (75.5, 42.7)    | (45.5, 28.1)
  18  | (57.8, 42.7)    | (27.8, 28.1)
  19  | (40.0, 42.7)    | (10.0, 28.1)
  20  | (40.0, 62.3)    | (10.0, 47.8)
  21  | (57.8, 62.3)    | (27.8, 47.8)
  22  | (75.5, 62.3)    | (45.5, 47.8)
  23  | (93.3, 62.3)    | (63.3, 47.8)
  24  | (111.1, 62.3)   | (81.1, 47.8)
  25  | (128.8, 62.3)   | (98.8, 47.8)
  26  | (146.6, 62.3)   | (116.6, 47.8)
  27  | (164.4, 62.3)   | (134.4, 47.8)
  28  | (182.2, 62.3)   | (152.2, 47.8)
  29  | (199.9, 62.3)   | (169.9, 47.8)
  30  | (199.9, 82.0)   | (169.9, 67.4)
  31  | (182.2, 82.0)   | (152.2, 67.4)
  32  | (164.4, 82.0)   | (134.4, 67.4)
  33  | (146.6, 82.0)   | (116.6, 67.4)
  34  | (128.9, 82.0)   | (98.9, 67.4)
  35  | (111.1, 82.0)   | (81.1, 67.4)
  36  | (93.3, 82.0)    | (63.3, 67.4)
  37  | (75.5, 82.0)    | (45.5, 67.4)
  38  | (57.8, 82.0)    | (27.8, 67.4)
  39  | (40.0, 82.0)    | (10.0, 67.4)
  40  | (40.0, 101.6)   | (10.0, 87.1)
  41  | (57.8, 101.6)   | (27.8, 87.1)
  42  | (75.5, 101.6)   | (45.5, 87.1)
  43  | (93.3, 101.6)   | (63.3, 87.1)
  44  | (111.1, 101.6)  | (81.1, 87.1)
  45  | (128.8, 101.6)  | (98.8, 87.1)
  46  | (146.6, 101.6)  | (116.6, 87.1)
  47  | (164.4, 101.6)  | (134.4, 87.1)
  48  | (182.2, 101.6)  | (152.2, 87.1)
  49  | (199.9, 101.6)  | (169.9, 87.1)
  50  | (199.9, 121.3)  | (169.9, 106.7)
  51  | (182.2, 121.3)  | (152.2, 106.7)
  52  | (164.4, 121.3)  | (134.4, 106.7)
  53  | (146.6, 121.3)  | (116.6, 106.7)
  54  | (128.9, 121.3)  | (98.9, 106.7)
  55  | (111.1, 121.3)  | (81.1, 106.7)
  56  | (93.3, 121.3)   | (63.3, 106.7)
  57  | (75.5, 121.3)   | (45.5, 106.7)
  58  | (57.8, 121.3)   | (27.8, 106.7)
  59  | (40.0, 121.3)   | (10.0, 106.7)
  60  | (40.0, 141.0)   | (10.0, 126.4)
  61  | (57.8, 141.0)   | (27.8, 126.4)
  62  | (75.5, 141.0)   | (45.5, 126.4)
  63  | (93.3, 141.0)   | (63.3, 126.4)
  64  | (111.1, 141.0)  | (81.1, 126.4)
  65  | (128.8, 141.0)  | (98.8, 126.4)
  66  | (146.6, 141.0)  | (116.6, 126.4)
  67  | (164.4, 141.0)  | (134.4, 126.4)
  68  | (182.2, 141.0)  | (152.2, 126.4)
  69  | (199.9, 141.0)  | (169.9, 126.4)
  70  | (199.9, 160.6)  | (169.9, 146.1)
  71  | (182.2, 160.6)  | (152.2, 146.1)
  72  | (164.4, 160.6)  | (134.4, 146.1)
  73  | (146.6, 160.6)  | (116.6, 146.1)
  74  | (128.9, 160.6)  | (98.9, 146.1)
  75  | (111.1, 160.6)  | (81.1, 146.1)
  76  | (93.3, 160.6)   | (63.3, 146.1)
  77  | (75.5, 160.6)   | (45.5, 146.1)
  78  | (57.8, 160.6)   | (27.8, 146.1)
  79  | (40.0, 160.6)   | (10.0, 146.1)
  80  | (40.0, 180.3)   | (10.0, 165.7)
  81  | (57.8, 180.3)   | (27.8, 165.7)
  82  | (75.5, 180.3)   | (45.5, 165.7)
  83  | (93.3, 180.3)   | (63.3, 165.7)
  84  | (111.1, 180.3)  | (81.1, 165.7)
  85  | (128.8, 180.3)  | (98.8, 165.7)
  86  | (146.6, 180.3)  | (116.6, 165.7)
  87  | (164.4, 180.3)  | (134.4, 165.7)
  88  | (182.2, 180.3)  | (152.2, 165.7)
  89  | (199.9, 180.3)  | (169.9, 165.7)
  90  | (199.9, 199.9)  | (169.9, 185.4)
  91  | (182.2, 199.9)  | (152.2, 185.4)
  92  | (164.4, 199.9)  | (134.4, 185.4)
  93  | (146.6, 199.9)  | (116.6, 185.4)
  94  | (128.9, 199.9)  | (98.9, 185.4)
  95  | (111.1, 199.9)  | (81.1, 185.4)
  96  | (93.3, 199.9)   | (63.3, 185.4)
  97  | (75.5, 199.9)   | (45.5, 185.4)
  98  | (57.8, 199.9)   | (27.8, 185.4)
  99  | (40.0, 199.9)   | (10.0, 185.4)
Failed to verify BLTouch probe is raised; retrying.

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.


Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Script running error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/extras/gcode_button.py", line 41, in button_callback
    self.gcode.run_script(template.render())
  File "/home/pi/klipper/klippy/gcode.py", line 229, in run_script
    self._process_commands(script.split('\n'), need_ack=False)
  File "/home/pi/klipper/klippy/gcode.py", line 211, in _process_commands
    handler(gcmd)
  File "/home/pi/klipper/klippy/gcode.py", line 285, in cmd_default
    raise gcmd.error(self.printer.get_state_message()[0])
gcode.CommandError: 
Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

Failed to verify BLTouch probe is raised; retrying.
BLTouch raise probe error: BLTouch failed to raise probe
Starting heater checks for extruder
autotune_tmc set stepper_x pwm_freq=0
autotune_tmc stepper_x ncycles=480 pfdcycles=206
autotune_tmc set stepper_x tpfd=2
autotune_tmc set stepper_x tbl=1
autotune_tmc set stepper_x toff=3
autotune_tmc set stepper_x hstrt=7
autotune_tmc set stepper_x hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x pwm_autoscale=True
autotune_tmc set stepper_x pwm_autograd=True
autotune_tmc set stepper_x pwm_grad=4
autotune_tmc set stepper_x pwm_ofs=10
autotune_tmc set stepper_x pwm_reg=15
autotune_tmc set stepper_x pwm_lim=4
autotune_tmc set stepper_x tpwmthrs=1048575
autotune_tmc set stepper_x en_pwm_mode=False
autotune_tmc set stepper_x tcoolthrs=391(24.0)
autotune_tmc set stepper_x sgt=1
autotune_tmc set stepper_x small_hysteresis=False
autotune_tmc set stepper_x semin=2
autotune_tmc set stepper_x semax=2
autotune_tmc set stepper_x seup=3
autotune_tmc set stepper_x sedn=2
autotune_tmc set stepper_x seimin=0
autotune_tmc set stepper_x sfilt=0
autotune_tmc set stepper_x iholddelay=12
autotune_tmc set stepper_x vhighfs=False
autotune_tmc set stepper_x vhighchm=False
autotune_tmc set stepper_x multistep_filt=True
autotune_tmc set stepper_x1 pwm_freq=0
autotune_tmc stepper_x1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_x1 tpfd=2
autotune_tmc set stepper_x1 tbl=1
autotune_tmc set stepper_x1 toff=3
autotune_tmc set stepper_x1 hstrt=7
autotune_tmc set stepper_x1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_x1 pwm_autoscale=True
autotune_tmc set stepper_x1 pwm_autograd=True
autotune_tmc set stepper_x1 pwm_grad=4
autotune_tmc set stepper_x1 pwm_ofs=10
autotune_tmc set stepper_x1 pwm_reg=15
autotune_tmc set stepper_x1 pwm_lim=4
autotune_tmc set stepper_x1 tpwmthrs=1048575
autotune_tmc set stepper_x1 en_pwm_mode=False
autotune_tmc set stepper_x1 tcoolthrs=391(24.0)
autotune_tmc set stepper_x1 sgt=1
autotune_tmc set stepper_x1 small_hysteresis=False
autotune_tmc set stepper_x1 semin=2
autotune_tmc set stepper_x1 semax=2
autotune_tmc set stepper_x1 seup=3
autotune_tmc set stepper_x1 sedn=2
autotune_tmc set stepper_x1 seimin=0
autotune_tmc set stepper_x1 sfilt=0
autotune_tmc set stepper_x1 iholddelay=12
autotune_tmc set stepper_x1 vhighfs=False
autotune_tmc set stepper_x1 vhighchm=False
autotune_tmc set stepper_x1 multistep_filt=True
autotune_tmc set stepper_y pwm_freq=0
autotune_tmc stepper_y ncycles=480 pfdcycles=206
autotune_tmc set stepper_y tpfd=2
autotune_tmc set stepper_y tbl=1
autotune_tmc set stepper_y toff=3
autotune_tmc set stepper_y hstrt=7
autotune_tmc set stepper_y hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y pwm_autoscale=True
autotune_tmc set stepper_y pwm_autograd=True
autotune_tmc set stepper_y pwm_grad=4
autotune_tmc set stepper_y pwm_ofs=10
autotune_tmc set stepper_y pwm_reg=15
autotune_tmc set stepper_y pwm_lim=4
autotune_tmc set stepper_y tpwmthrs=1048575
autotune_tmc set stepper_y en_pwm_mode=False
autotune_tmc set stepper_y tcoolthrs=391(24.0)
autotune_tmc set stepper_y sgt=1
autotune_tmc set stepper_y small_hysteresis=False
autotune_tmc set stepper_y semin=2
autotune_tmc set stepper_y semax=2
autotune_tmc set stepper_y seup=3
autotune_tmc set stepper_y sedn=2
autotune_tmc set stepper_y seimin=0
autotune_tmc set stepper_y sfilt=0
autotune_tmc set stepper_y iholddelay=12
autotune_tmc set stepper_y vhighfs=False
autotune_tmc set stepper_y vhighchm=False
autotune_tmc set stepper_y multistep_filt=True
autotune_tmc set stepper_y1 pwm_freq=0
autotune_tmc stepper_y1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_y1 tpfd=2
autotune_tmc set stepper_y1 tbl=1
autotune_tmc set stepper_y1 toff=3
autotune_tmc set stepper_y1 hstrt=7
autotune_tmc set stepper_y1 hend=9
autotune_tmc using max PWM speed 445.633841
autotune_tmc set stepper_y1 pwm_autoscale=True
autotune_tmc set stepper_y1 pwm_autograd=True
autotune_tmc set stepper_y1 pwm_grad=4
autotune_tmc set stepper_y1 pwm_ofs=10
autotune_tmc set stepper_y1 pwm_reg=15
autotune_tmc set stepper_y1 pwm_lim=4
autotune_tmc set stepper_y1 tpwmthrs=1048575
autotune_tmc set stepper_y1 en_pwm_mode=False
autotune_tmc set stepper_y1 tcoolthrs=391(24.0)
autotune_tmc set stepper_y1 sgt=1
autotune_tmc set stepper_y1 small_hysteresis=False
autotune_tmc set stepper_y1 semin=2
autotune_tmc set stepper_y1 semax=2
autotune_tmc set stepper_y1 seup=3
autotune_tmc set stepper_y1 sedn=2
autotune_tmc set stepper_y1 seimin=0
autotune_tmc set stepper_y1 sfilt=0
autotune_tmc set stepper_y1 iholddelay=12
autotune_tmc set stepper_y1 vhighfs=False
autotune_tmc set stepper_y1 vhighchm=False
autotune_tmc set stepper_y1 multistep_filt=True
autotune_tmc set stepper_z pwm_freq=0
autotune_tmc stepper_z ncycles=480 pfdcycles=206
autotune_tmc set stepper_z tbl=1
autotune_tmc set stepper_z toff=3
autotune_tmc set stepper_z hstrt=7
autotune_tmc set stepper_z hend=5
autotune_tmc set stepper_z sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z pwm_autoscale=True
autotune_tmc set stepper_z pwm_autograd=True
autotune_tmc set stepper_z pwm_grad=10
autotune_tmc set stepper_z pwm_ofs=30
autotune_tmc set stepper_z pwm_reg=15
autotune_tmc set stepper_z pwm_lim=4
autotune_tmc set stepper_z tpwmthrs=1048575
autotune_tmc set stepper_z en_spreadcycle=True
autotune_tmc set stepper_z tcoolthrs=391(2.4)
autotune_tmc set stepper_z semin=2
autotune_tmc set stepper_z semax=2
autotune_tmc set stepper_z seup=3
autotune_tmc set stepper_z sedn=2
autotune_tmc set stepper_z seimin=0
autotune_tmc set stepper_z iholddelay=12
autotune_tmc set stepper_z multistep_filt=True
autotune_tmc set stepper_z1 pwm_freq=0
autotune_tmc stepper_z1 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z1 tbl=1
autotune_tmc set stepper_z1 toff=3
autotune_tmc set stepper_z1 hstrt=7
autotune_tmc set stepper_z1 hend=5
autotune_tmc set stepper_z1 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z1 pwm_autoscale=True
autotune_tmc set stepper_z1 pwm_autograd=True
autotune_tmc set stepper_z1 pwm_grad=10
autotune_tmc set stepper_z1 pwm_ofs=30
autotune_tmc set stepper_z1 pwm_reg=15
autotune_tmc set stepper_z1 pwm_lim=4
autotune_tmc set stepper_z1 tpwmthrs=1048575
autotune_tmc set stepper_z1 en_spreadcycle=True
autotune_tmc set stepper_z1 tcoolthrs=391(2.4)
autotune_tmc set stepper_z1 semin=2
autotune_tmc set stepper_z1 semax=2
autotune_tmc set stepper_z1 seup=3
autotune_tmc set stepper_z1 sedn=2
autotune_tmc set stepper_z1 seimin=0
autotune_tmc set stepper_z1 iholddelay=12
autotune_tmc set stepper_z1 multistep_filt=True
autotune_tmc set stepper_z2 pwm_freq=0
autotune_tmc stepper_z2 ncycles=480 pfdcycles=206
autotune_tmc set stepper_z2 tbl=1
autotune_tmc set stepper_z2 toff=3
autotune_tmc set stepper_z2 hstrt=7
autotune_tmc set stepper_z2 hend=5
autotune_tmc set stepper_z2 sgthrs=40
autotune_tmc using max PWM speed 26.043536
autotune_tmc set stepper_z2 pwm_autoscale=True
autotune_tmc set stepper_z2 pwm_autograd=True
autotune_tmc set stepper_z2 pwm_grad=10
autotune_tmc set stepper_z2 pwm_ofs=30
autotune_tmc set stepper_z2 pwm_reg=15
autotune_tmc set stepper_z2 pwm_lim=4
autotune_tmc set stepper_z2 tpwmthrs=1048575
autotune_tmc set stepper_z2 en_spreadcycle=True
autotune_tmc set stepper_z2 tcoolthrs=391(2.4)
autotune_tmc set stepper_z2 semin=2
autotune_tmc set stepper_z2 semax=2
autotune_tmc set stepper_z2 seup=3
autotune_tmc set stepper_z2 sedn=2
autotune_tmc set stepper_z2 seimin=0
autotune_tmc set stepper_z2 iholddelay=12
autotune_tmc set stepper_z2 multistep_filt=True
Stats 1476.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9769 bytes_read=13718 bytes_retransmit=9 bytes_invalid=0 send_seq=669 receive_seq=669 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029587 rpi: mcu_awake=0.003 mcu_task_avg=0.000019 mcu_task_stddev=0.000010 bytes_write=852 bytes_read=4611 bytes_retransmit=0 bytes_invalid=0 send_seq=117 receive_seq=117 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999884 adj=49987113 Octopus_Max: temp=41.6 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.625 memavail=7503016 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4123601912
webhooks: registering remote method 'reboot_machine' for connection id: 4123601912
webhooks: registering remote method 'pause_job_queue' for connection id: 4123601912
webhooks: registering remote method 'start_job_queue' for connection id: 4123601912
webhooks: registering remote method 'set_device_power' for connection id: 4123601912
Stats 1477.0: gcodein=0  mcu: mcu_awake=0.010 mcu_task_avg=0.000013 mcu_task_stddev=0.000091 bytes_write=9775 bytes_read=13962 bytes_retransmit=9 bytes_invalid=0 send_seq=670 receive_seq=670 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400029042 rpi: mcu_awake=0.003 mcu_task_avg=0.000019 mcu_task_stddev=0.000010 bytes_write=858 bytes_read=4627 bytes_retransmit=0 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999729 adj=50010383 Octopus_Max: temp=41.8 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.673 memavail=7506916 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1478.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9781 bytes_read=14214 bytes_retransmit=9 bytes_invalid=0 send_seq=671 receive_seq=671 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028834 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=864 bytes_read=4656 bytes_retransmit=0 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999597 adj=50006604 Octopus_Max: temp=41.7 Pi: temp=37.5  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.684 memavail=7506916 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-82.9 pwm=0.000
Stats 1479.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9787 bytes_read=14469 bytes_retransmit=9 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028504 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=870 bytes_read=4672 bytes_retransmit=0 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999514 adj=50003664 Octopus_Max: temp=41.6 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.694 memavail=7506920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1480.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9793 bytes_read=14713 bytes_retransmit=9 bytes_invalid=0 send_seq=673 receive_seq=673 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028295 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=876 bytes_read=4688 bytes_retransmit=0 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999485 adj=50001616 Octopus_Max: temp=41.8 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.705 memavail=7506920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1481.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9799 bytes_read=14956 bytes_retransmit=9 bytes_invalid=0 send_seq=674 receive_seq=674 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028795 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=882 bytes_read=4704 bytes_retransmit=0 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999615 adj=50000193 Octopus_Max: temp=41.8 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.06 cputime=37.722 memavail=7506920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1482.0: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000004 mcu_task_stddev=0.000005 bytes_write=9821 bytes_read=15245 bytes_retransmit=9 bytes_invalid=0 send_seq=677 receive_seq=677 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028924 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000018 bytes_write=888 bytes_read=4720 bytes_retransmit=0 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999686 adj=49999367 Octopus_Max: temp=41.7 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.752 memavail=7506920 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1483.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9827 bytes_read=15503 bytes_retransmit=9 bytes_invalid=0 send_seq=678 receive_seq=678 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028911 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=894 bytes_read=4749 bytes_retransmit=0 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999800 adj=49998739 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.2 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.777 memavail=7506676 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1484.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9833 bytes_read=15746 bytes_retransmit=9 bytes_invalid=0 send_seq=679 receive_seq=679 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028788 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=900 bytes_read=4765 bytes_retransmit=0 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999817 adj=49998544 Octopus_Max: temp=41.7 Pi: temp=37.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.807 memavail=7506676 print_time=19.418 buffer_time=2.561 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
b'Got EOF when reading from device'
Stats 1485.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=906 bytes_read=4781 bytes_retransmit=0 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999817 adj=49996459 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.834 memavail=7505688 print_time=19.418 buffer_time=1.561 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1486.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=1 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=912 bytes_read=4797 bytes_retransmit=0 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999819 adj=49996435 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.853 memavail=7505688 print_time=19.418 buffer_time=0.559 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1487.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=2 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000012 mcu_task_stddev=0.000016 bytes_write=918 bytes_read=4813 bytes_retransmit=0 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999802 adj=49996443 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.871 memavail=7505688 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1488.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=3 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=924 bytes_read=4842 bytes_retransmit=0 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999743 adj=49996380 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.885 memavail=7504532 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1489.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=4 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=930 bytes_read=4858 bytes_retransmit=0 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999695 adj=49996130 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.893 memavail=7504056 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Timeout with MCU 'mcu' (eventtime=1489.983062)
Transition to shutdown state: Lost communication with MCU 'mcu'
Dumping gcode input 0 blocks
Dumping 20 requests for client 4123601912
Received 1475.981062: b'{"id": 3859620528, "method": "info", "params": {}}'
Received 1475.999029: b'{"id": 3859623336, "method": "info", "params": {}}'
Received 1476.000945: b'{"id": 3859623192, "method": "objects/list", "params": {}}'
Received 1476.001631: b'{"id": 3859623816, "method": "gcode/help", "params": {}}'
Received 1476.017707: b'{"id": 3859623648, "method": "objects/subscribe", "params": {"objects": {"gcode": null, "webhooks": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_sensor Octopus_Max": null, "temperature_host Pi": null, "temperature_sensor Pi": null, "idle_timeout": null, "gcode_move": null, "print_stats": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "heater_bed": null, "temperature_sensor bed_core": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null, "extruder": null}, "response_template": {"method": "process_status_update"}}}'
Received 1476.077996: b'{"id": 3859336472, "method": "register_remote_method", "params": {"response_template": {"method": "shutdown_machine"}, "remote_method": "shutdown_machine"}}'
Received 1476.088394: b'{"id": 3859336592, "method": "register_remote_method", "params": {"response_template": {"method": "reboot_machine"}, "remote_method": "reboot_machine"}}'
Received 1476.089682: b'{"id": 3859336592, "method": "register_remote_method", "params": {"response_template": {"method": "pause_job_queue"}, "remote_method": "pause_job_queue"}}'
Received 1476.090712: b'{"id": 3859336592, "method": "register_remote_method", "params": {"response_template": {"method": "start_job_queue"}, "remote_method": "start_job_queue"}}'
Received 1476.091680: b'{"id": 3859336592, "method": "register_remote_method", "params": {"response_template": {"method": "set_device_power"}, "remote_method": "set_device_power"}}'
Received 1476.094060: b'{"id": 3859335368, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 1476.094333: b'{"id": 3859335680, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 1476.223009: b'{"id": 3859333400, "method": "info", "params": {}}'
Received 1476.225123: b'{"id": 3859333808, "method": "objects/list", "params": {}}'
Received 1476.225123: b'{"id": 3859334288, "method": "gcode/help", "params": {}}'
Received 1476.263901: b'{"id": 3859334072, "method": "objects/subscribe", "params": {"objects": {"gcode": null, "webhooks": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_sensor Octopus_Max": null, "temperature_host Pi": null, "temperature_sensor Pi": null, "idle_timeout": null, "gcode_move": null, "print_stats": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "heater_bed": null, "temperature_sensor bed_core": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null, "extruder": null}, "response_template": {"method": "process_status_update"}}}'
Received 1476.333425: b'{"id": 3859334048, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "temperature_sensor Octopus_Max": null, "temperature_sensor Pi": null, "heater_bed": null, "temperature_sensor bed_core": null, "extruder": null, "gcode": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_host Pi": null, "idle_timeout": null, "gcode_move": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
Received 1476.451451: b'{"id": 3859334648, "method": "objects/query", "params": {"objects": {}}}'
Received 1476.583456: b'{"id": 3859291944, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "temperature_sensor Octopus_Max": null, "temperature_sensor Pi": null, "heater_bed": null, "temperature_sensor bed_core": null, "extruder": null, "gcode": null, "configfile": null, "mcu": null, "mcu rpi": null, "heaters": null, "temperature_host Pi": null, "idle_timeout": null, "gcode_move": null, "virtual_sdcard": null, "display_status": null, "pause_resume": null, "exclude_object": null, "fan": null, "heater_fan toolhead": null, "stepper_enable": null, "controller_fan controller_fan": null, "gcode_macro HOME_X_SENSORLESS": null, "gcode_macro HOME_Y_SENSORLESS": null, "gcode_macro MAYBE_HOME": null, "gcode_macro ECHO_RATOS_VARS": null, "gcode_macro RatOS": null, "gcode_macro PAUSE": null, "gcode_macro RESUME": null, "gcode_macro CANCEL_PRINT": null, "gcode_macro PRIME_LINE": null, "gcode_macro PRIME_BLOB": null, "gcode_macro _PARK": null, "gcode_macro M600": null, "gcode_macro UNLOAD_FILAMENT": null, "gcode_macro LOAD_FILAMENT": null, "gcode_macro SET_CENTER_KINEMATIC_POSITION": null, "gcode_macro START_PRINT": null, "gcode_macro _USER_START_PRINT_BEFORE_HOMING": null, "gcode_macro _START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_BED": null, "gcode_macro _START_PRINT_BED_MESH": null, "gcode_macro _USER_START_PRINT_BED_MESH": null, "gcode_macro _START_PRINT_PARK": null, "gcode_macro _USER_START_PRINT_PARK": null, "gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER": null, "gcode_macro _START_PRINT_HEAT_CHAMBER": null, "gcode_macro _USER_START_PRINT_HEAT_CHAMBER": null, "gcode_macro END_PRINT": null, "gcode_macro _END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF": null, "gcode_macro _END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF": null, "gcode_macro _END_PRINT_PARK": null, "gcode_macro _USER_END_PRINT_PARK": null, "gcode_macro SAVE_PROBE_RESULT": null, "gcode_macro PROBE_FOR_PRIMING": null, "gcode_macro RESET_PRIME_PROBE_STATE": null, "gcode_macro PROBE_CURRENT_POSITION": null, "gcode_macro ADD_PRIME_PROBE_TO_OFFSET": null, "gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET": null, "gcode_macro CALIBRATE_ADAPTIVE_MESH": null, "gcode_macro LINE_PURGE": null, "gcode_macro GENERATE_SHAPER_GRAPHS": null, "gcode_macro MEASURE_COREXY_BELT_TENSION": null, "gcode_macro COMPILE_FIRMWARE": null, "gcode_macro CHANGE_HOSTNAME": null, "gcode_macro Z_TILT_ADJUST": null, "tmc2209 stepper_z": null, "tmc2209 stepper_z1": null, "tmc2209 stepper_z2": null, "tmc5160 stepper_x": null, "tmc5160 stepper_x1": null, "tmc5160 stepper_y": null, "tmc5160 stepper_y1": null, "bed_mesh": null, "z_tilt": null, "gcode_macro enable_stepper": null, "gcode_macro disable_steppers": null, "gcode_macro STEPPER_BUZZ_X": null, "gcode_macro STEPPER_BUZZ_Y": null, "gcode_macro STEPPER_BUZZ_X1": null, "gcode_macro STEPPER_BUZZ_Y1": null, "gcode_macro STEPPER_BUZZ_Z": null, "gcode_macro STEPPER_BUZZ_Z1": null, "gcode_macro STEPPER_BUZZ_Z2": null, "probe": null, "tmc2209 extruder": null, "firmware_retraction": null, "output_pin status_led": null, "gcode_button top": null, "gcode_button bottom": null, "gcode_macro _POWER_OFF_PRINTER": null, "gcode_macro RESPOND": null, "motion_report": null, "query_endstops": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
Received 1476.750501: b'{"id": 3859291632, "method": "objects/query", "params": {"objects": {"extruder": ["can_extrude"]}}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (1476.223517194, 0.0, 0.0)
Stats 1490.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=5 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=936 bytes_read=4874 bytes_retransmit=0 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999657 adj=49995875 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.901 memavail=7504056 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
MCU 'rpi' shutdown: Command request
clocksync state: mcu_freq=50000000 last_clock=1137408447 clock_est=(1475.518 425879760 49999657.366) min_half_rtt=0.000048 min_rtt_time=1469.955 time_avg=1475.518(50.191) clock_avg=425879760.656(2509526688.444) pred_variance=944257588.138 clock_adj=(-0.123 49995718.500)
Dumping serial stats: bytes_write=942 bytes_read=4886 bytes_retransmit=0 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0
Dumping send queue 100 messages
Sent 0 1469.608248 1469.608248 9: seq: 10, identify offset=640 count=40
Sent 1 1469.608545 1469.608545 9: seq: 11, identify offset=680 count=40
Sent 2 1469.608837 1469.608837 9: seq: 12, identify offset=720 count=40
Sent 3 1469.609128 1469.609128 9: seq: 13, identify offset=760 count=40
Sent 4 1469.609419 1469.609419 9: seq: 14, identify offset=800 count=40
Sent 5 1469.609711 1469.609711 9: seq: 15, identify offset=840 count=40
Sent 6 1469.610000 1469.610000 9: seq: 16, identify offset=880 count=40
Sent 7 1469.610290 1469.610290 9: seq: 17, identify offset=920 count=40
Sent 8 1469.610580 1469.610580 9: seq: 18, identify offset=960 count=40
Sent 9 1469.610871 1469.610871 9: seq: 19, identify offset=1000 count=40
Sent 10 1469.611162 1469.611162 9: seq: 1a, identify offset=1040 count=40
Sent 11 1469.611454 1469.611454 9: seq: 1b, identify offset=1080 count=40
Sent 12 1469.611743 1469.611743 9: seq: 1c, identify offset=1120 count=40
Sent 13 1469.612034 1469.612034 9: seq: 1d, identify offset=1160 count=40
Sent 14 1469.612347 1469.612347 9: seq: 1e, identify offset=1200 count=40
Sent 15 1469.612631 1469.612631 9: seq: 1f, identify offset=1240 count=40
Sent 16 1469.612912 1469.612912 9: seq: 10, identify offset=1280 count=40
Sent 17 1469.613193 1469.613193 9: seq: 11, identify offset=1320 count=40
Sent 18 1469.613475 1469.613475 9: seq: 12, identify offset=1360 count=40
Sent 19 1469.613755 1469.613755 9: seq: 13, identify offset=1400 count=40
Sent 20 1469.614031 1469.614031 9: seq: 14, identify offset=1440 count=40
Sent 21 1469.614311 1469.614311 9: seq: 15, identify offset=1480 count=40
Sent 22 1469.614590 1469.614590 9: seq: 16, identify offset=1520 count=40
Sent 23 1469.614868 1469.614868 9: seq: 17, identify offset=1560 count=40
Sent 24 1469.615147 1469.615147 9: seq: 18, identify offset=1600 count=40
Sent 25 1469.615428 1469.615428 9: seq: 19, identify offset=1640 count=40
Sent 26 1469.615706 1469.615706 9: seq: 1a, identify offset=1680 count=40
Sent 27 1469.615985 1469.615985 9: seq: 1b, identify offset=1720 count=40
Sent 28 1469.616282 1469.616282 9: seq: 1c, identify offset=1760 count=40
Sent 29 1469.616563 1469.616563 9: seq: 1d, identify offset=1800 count=40
Sent 30 1469.616841 1469.616841 9: seq: 1e, identify offset=1840 count=40
Sent 31 1469.617120 1469.617120 9: seq: 1f, identify offset=1880 count=40
Sent 32 1469.617399 1469.617399 9: seq: 10, identify offset=1920 count=40
Sent 33 1469.617676 1469.617676 9: seq: 11, identify offset=1960 count=40
Sent 34 1469.617956 1469.617956 9: seq: 12, identify offset=2000 count=40
Sent 35 1469.618234 1469.618234 9: seq: 13, identify offset=2040 count=40
Sent 36 1469.618510 1469.618510 9: seq: 14, identify offset=2080 count=40
Sent 37 1469.618789 1469.618789 9: seq: 15, identify offset=2120 count=40
Sent 38 1469.619067 1469.619067 9: seq: 16, identify offset=2160 count=40
Sent 39 1469.619345 1469.619345 9: seq: 17, identify offset=2200 count=40
Sent 40 1469.619622 1469.619622 9: seq: 18, identify offset=2240 count=40
Sent 41 1469.619900 1469.619900 9: seq: 19, identify offset=2280 count=40
Sent 42 1469.620198 1469.620198 9: seq: 1a, identify offset=2320 count=40
Sent 43 1469.620485 1469.620485 9: seq: 1b, identify offset=2360 count=40
Sent 44 1469.620766 1469.620766 9: seq: 1c, identify offset=2400 count=40
Sent 45 1469.621045 1469.621045 9: seq: 1d, identify offset=2440 count=40
Sent 46 1469.621323 1469.621323 9: seq: 1e, identify offset=2480 count=40
Sent 47 1469.621601 1469.621601 9: seq: 1f, identify offset=2520 count=40
Sent 48 1469.621879 1469.621879 9: seq: 10, identify offset=2560 count=40
Sent 49 1469.622155 1469.622155 9: seq: 11, identify offset=2600 count=40
Sent 50 1469.622432 1469.622432 9: seq: 12, identify offset=2640 count=40
Sent 51 1469.622710 1469.622710 9: seq: 13, identify offset=2680 count=40
Sent 52 1469.622985 1469.622985 9: seq: 14, identify offset=2720 count=40
Sent 53 1469.623262 1469.623262 9: seq: 15, identify offset=2760 count=40
Sent 54 1469.623539 1469.623539 9: seq: 16, identify offset=2800 count=40
Sent 55 1469.623815 1469.623815 9: seq: 17, identify offset=2840 count=40
Sent 56 1469.624109 1469.624109 9: seq: 18, identify offset=2880 count=40
Sent 57 1469.624391 1469.624391 9: seq: 19, identify offset=2920 count=40
Sent 58 1469.624668 1469.624668 9: seq: 1a, identify offset=2960 count=40
Sent 59 1469.624948 1469.624948 9: seq: 1b, identify offset=3000 count=40
Sent 60 1469.625225 1469.625225 9: seq: 1c, identify offset=3040 count=40
Sent 61 1469.625502 1469.625502 9: seq: 1d, identify offset=3080 count=40
Sent 62 1469.625777 1469.625777 9: seq: 1e, identify offset=3120 count=40
Sent 63 1469.626053 1469.626053 9: seq: 1f, identify offset=3160 count=40
Sent 64 1469.626328 1469.626328 9: seq: 10, identify offset=3168 count=40
Sent 65 1469.650066 1469.650066 6: seq: 11, get_uptime
Sent 66 1469.701328 1469.701328 6: seq: 12, get_clock
Sent 67 1469.752308 1469.752308 6: seq: 13, get_clock
Sent 68 1469.803024 1469.803024 6: seq: 14, get_clock
Sent 69 1469.853633 1469.853633 6: seq: 15, get_clock
Sent 70 1469.904159 1469.904159 6: seq: 16, get_clock
Sent 71 1469.954629 1469.954629 6: seq: 17, get_clock
Sent 72 1470.005912 1470.005912 6: seq: 18, get_clock
Sent 73 1470.056486 1470.056486 6: seq: 19, get_clock
Sent 74 1470.057527 1470.057527 6: seq: 1a, get_clock
Sent 75 1470.070331 1470.070331 6: seq: 1b, get_config
Sent 76 1470.070951 1470.070951 7: seq: 1c, allocate_oids count=0
Sent 77 1470.071085 1470.071085 11: seq: 1d, finalize_config crc=3912464276
Sent 78 1470.071169 1470.071169 6: seq: 1e, get_config
Sent 79 1471.042282 1471.042282 6: seq: 1f, get_clock
Sent 80 1472.026702 1472.026702 6: seq: 10, get_clock
Sent 81 1473.011025 1473.011025 6: seq: 11, get_clock
Sent 82 1473.995724 1473.995724 6: seq: 12, get_clock
Sent 83 1474.980394 1474.980394 6: seq: 13, get_clock
Sent 84 1475.964659 1475.964659 6: seq: 14, get_clock
Sent 85 1476.948838 1476.948838 6: seq: 15, get_clock
Sent 86 1477.933590 1477.933590 6: seq: 16, get_clock
Sent 87 1478.918119 1478.918119 6: seq: 17, get_clock
Sent 88 1479.902184 1479.902184 6: seq: 18, get_clock
Sent 89 1480.887032 1480.887032 6: seq: 19, get_clock
Sent 90 1481.871500 1481.871500 6: seq: 1a, get_clock
Sent 91 1482.855716 1482.855716 6: seq: 1b, get_clock
Sent 92 1483.840480 1483.840480 6: seq: 1c, get_clock
Sent 93 1484.825188 1484.825188 6: seq: 1d, get_clock
Sent 94 1485.810099 1485.810099 6: seq: 1e, get_clock
Sent 95 1486.794490 1486.794490 6: seq: 1f, get_clock
Sent 96 1487.778718 1487.778718 6: seq: 10, get_clock
Sent 97 1488.763685 1488.763685 6: seq: 11, get_clock
Sent 98 1489.748322 1489.748322 6: seq: 12, get_clock
Sent 99 1489.985616 1489.985616 6: seq: 13, emergency_stop
Dumping receive queue 100 messages
Receive: 0 1469.608937 1469.608837 49: seq: 13, identify_response offset=720 data=b",\xaa\x83\x80\xb65#Xe\xaf\xac\x89\xee'\xb4h\x03/ T\x0c\x15\x1f\x9cm\xa0\x1f\x8b\x0c\xc2\xe3 F~\x84\x81jL\x88\xe1"
Receive: 1 1469.609228 1469.609128 49: seq: 14, identify_response offset=760 data=b'Y\xc0\x1b>\xecy[>\xe7\xe8\xb7\x80\t\x98"\x1f\x96\x1f\xba\x86\x1f\x85\x15Y4\xbdo\x12zl\x83\xca<\xec\x00\xeb\xce\xe1\xd2q'
Receive: 2 1469.609518 1469.609419 49: seq: 15, identify_response offset=800 data=b'\xad\x8c\x07\xb1\xdf\xf3\x01\x0f!\xd1b\xd05\xa6ns\x15\xd4\x80\xa7b\xe4V@Qr\x16\xec\x04\x84\x19p*9\xc9\x90\x95CI\x1a'
Receive: 3 1469.609810 1469.609711 49: seq: 16, identify_response offset=840 data=b's\x16\xec\xc1\x9f(>A\xc8z\xa4p\xc0\x1ch8\xf5x\x0b`\x99g\x81v\xbd\xb9\x84\xfdr\xd0@\x1b\x92\xf0\x9b\xe4\x9cE\x0b4'
Receive: 4 1469.610100 1469.610000 49: seq: 17, identify_response offset=880 data=b'\xbc\x02\x83\xe6\xae#\x03!\xa2cl\xbaJ\xec\x9es\xb8k\xbb\xd6\xc0\x95I1\x1dY\x81\x03\x84j+\xdb\x12\x19\xdd\xe1\x1c\x1f\xe7\xf2'
Receive: 5 1469.610389 1469.610290 49: seq: 18, identify_response offset=920 data=b'\x9ak7\xb2"DE>I\xdf\x17+\xa7\x08\x9e\x14d\x84\xbfx\xbd\\\x92\xae\'\x91\xa3\x92\xddn|,\x06\xee\x93\x83}Z\x9b\xac'
Receive: 6 1469.610679 1469.610580 49: seq: 19, identify_response offset=960 data=b'\n\xf3yj\xa5,\xa5\x95\xb4.-\x8f\x9f\xe0\xf1+\xde\x8epx\xd6\xedv\xb0\xa12j\x1b\x1c\x01n\x02\x84\x12\xa3\xbd\xcd4\xf6 '
Receive: 7 1469.610971 1469.610871 49: seq: 1a, identify_response offset=1000 data=b'S_\xb9\x9b\xa6\xbc\xe70y\xdb\xa4pg\xa4\x12\x8bdd\xa6o\xc0\xedv\x81\xa7Thr\xbe+\xdbX\x84e\xbe\xf2?\xeax\xe3'
Receive: 8 1469.611263 1469.611162 49: seq: 1b, identify_response offset=1040 data=b't\\\x87\x017\x82\x9ck\x0f\x84\x07^\xde{\xf9B\x1c\x1a\x1e\x16I\x8e\xe5\xa0\xef\xc0\x8d,\xf7\xf7\xe2df\x16X$*\x9f\xc9\xfe'
Receive: 9 1469.611554 1469.611454 49: seq: 1c, identify_response offset=1080 data=b'<\x16\x85\xcf\xa1\x80\x98d\x05;\xcf\x08\x16r]o\xe6hK\xb1\xae\xd7\x06\xbe\xc8\x19\x96\xeb\xa4\x0b\xbc\xa3\x85,?G!\xef3\x87'
Receive: 10 1469.611845 1469.611743 49: seq: 1d, identify_response offset=1120 data=b"C\x9b\x86\x08'v$\xdcud\x168\xe5\xe4\xff\\@\xb3+\xa4\x01\x04\x17\xf09\x95w\x83\x19]\xc0\xc4Oe\x9ev\x8f\xce\xcfm"
Receive: 11 1469.612150 1469.612034 49: seq: 1e, identify_response offset=1160 data=b'\xc2\xd4\x90\xe8\xd4\xe6$\x89U\x1d\xb8\x99\xc8\x12\xccs\x93S\xc8\x89]\x1dC\x9fu\x12\xa8\\\xe4\xed\x8dE\x1e\x94u\xc3/\xdc}\x04'
Receive: 12 1469.612441 1469.612347 49: seq: 1f, identify_response offset=1200 data=b';P\x1a\xa6\xe2\xa5Zw\xb9\t`\x81\x03B\x1c\xff\xa4\x8b\xe4\x1aN\x17\x1f!)\xb6U\x02e\xd7\x9ceS@\x94\x11Q\xcb\x9f4'
Receive: 13 1469.612722 1469.612631 49: seq: 10, identify_response offset=1240 data=b"\x0b\x10\xd1\xad\x8b\x11\x039\xfd\x90\x90|\xa9\xfd\xf7\xd9 \x88\xd3\xac\xa3\x85\xf9'\x19\x1e\x88\x144\xd1K\xad\xb0|\xda9Su\xaei"
Receive: 14 1469.613003 1469.612912 49: seq: 11, identify_response offset=1280 data=b'\x1d\x12\x9e\xe7\xdc<h\x9c\x18\xe8\xcc}\xe3\x94v\xdf\x108\xb8\xe7|\x81$s$\xa7|w#dg<v\xd3Iq*\xe7:Z'
Receive: 15 1469.613284 1469.613193 49: seq: 12, identify_response offset=1320 data=b'4\xd3||\xfe\x1c1\xa8\x10\xa5s_\x8a\x8a\xe9v\x8eu:(\xa6\x1b\xc4R\x89[\x8e\x91\x17\x1c\xba\xc0\xc4\xd8\x9ay\xb8u\x08*'
Receive: 16 1469.613565 1469.613475 49: seq: 13, identify_response offset=1360 data=b'\xde\xa3\xadPF\xc0l\x82\xe0\xa5\x0b@\x01K\xea\xb4k&j\x15\x97l\xd8\xa4\xc8\x027\xa2\xa9Q\x86\xe8 N\x98\x0f\xa8\xd6\xc6\xe1'
Receive: 17 1469.613845 1469.613755 49: seq: 14, identify_response offset=1400 data=b"\x8d~:\xc7\xfbn\xd0\xb9\x04\xf9\n5\xb6J\xc2\x9fz\x01W\xe2g.[\xbb\xd2\xe2\x14>\x12\xf8H\x8as\xa7\xbc\x86gK\xc9'"
Receive: 18 1469.614122 1469.614031 49: seq: 15, identify_response offset=1440 data=b'\x93"bO\xe1\xea\xfb\xeb\xfc\xe6\xea\x9f\x98\tl\xe1\x8a\xae\x7f\xfa\xe5\xfam\xfe\xe3\xfb\x1f~\xc5r\x99\xfe\xce\x82\x9b\xeb\x8f\xc1eP'
Receive: 19 1469.614401 1469.614311 49: seq: 16, identify_response offset=1480 data=b'\x8bvz\n\xce\x82w\xd7W\xcaV\x0c\x19(\xd4\xbb\x7f\xdc\xd00\x8e\xd6\x18\x03o?\\}\xb8\xcdo?\xde\xdc\xfe\x9a\xbf\xba\xba\xfd'
Receive: 20 1469.614680 1469.614590 49: seq: 17, identify_response offset=1520 data=b'\x01\xb3\xaf\xec\x13\xe6_\x13d\x84\xaa\x8aQ\x1d\r\x9dg\xe8\xcf\x8bUp\xf9\xaf\xd5Y\x98\xfe\x06\xa8\xa0j\xaa\xe7\xa1\xe2(\x02\xd4N'
Receive: 21 1469.614959 1469.614868 49: seq: 18, identify_response offset=1560 data=b'\x9b\xdf \xd9\xeaEG\x98\xd1\xc6\x8c\xcb\x83\xe8W\xdf}\x0e\x12Z\x08\xcc/`\x91\x85\xa5Pu\xcea\xb1\x85m@\xc3\xe7\xb0\xc4\xc2'
Receive: 22 1469.615237 1469.615147 49: seq: 19, identify_response offset=1600 data=b'\xc2\x10\xb2\xee90u\xc0$Yr\x939\xe0:Z\xb2\xb3v\xac\xae\xc2%?\x1b\x07\x8cW\x86!p9tz\xf8@P\x96\xa6`'
Receive: 23 1469.615518 1469.615428 49: seq: 1a, identify_response offset=1640 data=b'\xe3a\xe6@\xa1\x07\x02V}P\xe4\x81\xe0\xe2|P\xec\x81 \x8e\xfb\xa0\xc4\x812\xd0\x0f\x1f\x94z\xa0p\xceF\xe6\x81\xe29\x1bk'
Receive: 24 1469.615796 1469.615706 49: seq: 1b, identify_response offset=1680 data=b'\x0f\x94(6>\xcd\xdc#\x14IJ\x19\xc28\x8e\x83K\xd0\xc8B\xa6\xabd]\xa9\x04p\xacy\xba\n\xa3;P2M\xa5U\n>'
Receive: 25 1469.616090 1469.615985 49: seq: 1c, identify_response offset=1720 data=b'+\xfe\xb02j\x85\xfb\xd1T\xa8\xa6@%\xfd\xc9HM\xa6a\xe4O\xc6jrmDC\x93\x89\x9a\x0cWQ\xe2\xcf\xa64\x1bmf'
Receive: 26 1469.616374 1469.616282 49: seq: 1d, identify_response offset=1760 data=b'[e4k\xaf\x84f\xd74\x0b\x8e\xce\x9c\x15\xf2\x14\x81\x8eb\x80r,\x17\x956M\xa6LxG\x99\x1euw\xae\xea\x9ai\x0b4'
Receive: 27 1469.616653 1469.616563 49: seq: 1e, identify_response offset=1800 data=b'\xa1I\xb2f\x92#;\x14\x0f\x1c\x8bK\xcc\xe8\xb8\x1fz\xa8\xf3uU\xa3\x0b{f\xa6\xc6\xa9(\xae^\x17-k\xbb\x91\x81/c\x18'
Receive: 28 1469.616930 1469.616841 49: seq: 1f, identify_response offset=1840 data=b'\x0f\x18\xdc\x04\x113E\xcc\x1e\x0f\x02\xbe\xc9\xb5H\xd6\x83s\x04\x16)p\x03\xedW#\x06J\xa8\xc2\xf7\xb0*\xec^\x8cLHV\xe8'
Receive: 29 1469.617210 1469.617120 49: seq: 10, identify_response offset=1880 data=b'\xbd\xa8\xe7@\xb5\x97F\x96\x88\x8an\x89*D\x9aUy\x82\xca\xb5`;\xde2S\x96[z\xc8%\xae\xa9\x13\xca\xfab\x90\x00Rm'
Receive: 30 1469.617488 1469.617399 49: seq: 11, identify_response offset=1920 data=b'2U|\x19\xc0\xc0!G\x91\xa3\xea\x87^wS]\xd1\xb9\x94\xef\xfd\xfe6\xdc\xbc\x82L\x16\xd9\x02\xe2\xf1\x80\x1f\xd4\xc9\xf8K\xa8\xec'
Receive: 31 1469.617766 1469.617676 49: seq: 12, identify_response offset=1960 data=b'kp\x99\x15\xa4<b\xfc\x86\xd2\xc8\xbfH\xd6L#\x7f\xb2t \x06\x837\xbfY\xect\x1a\x08\xc4\x1f\xd9\r\x90\xa2TZ4=m'
Receive: 32 1469.618046 1469.617956 49: seq: 13, identify_response offset=2000 data=b'\xcd\xa8\xbe\xc4"\xe4\x07<<\x83\xd87b\xf5\xdet\xc0F\xd7\n\x1d}4\x1e\xa6\xaa\x84\x07\x91\x91\xdc(\xa3S\xa7v\x05\x1c\xe3\n'
Receive: 33 1469.618323 1469.618234 49: seq: 14, identify_response offset=2040 data=b'\xf3\xad)\xeb\xf8\xb1\x1bJn;8L7\xa2\xa9\xcd\xf7\xfa\xdd\x9b_\x18\x1a.\x03e\x16\x80\x86r\xd8A\x0eXQ\r\xf4\x86rZ'
Receive: 34 1469.618600 1469.618510 49: seq: 15, identify_response offset=2080 data=b'o]lq2Q\x9da\xa6\xa8\xe5\xd6\x81.\xa9\xb6\xb7\xe6\x82\xda~_ UZ\x8e\x94p\x17c\x01\x02\xf9\xea\xbb\xaf\xa880D'
Receive: 35 1469.618879 1469.618789 49: seq: 16, identify_response offset=2120 data=b'\xa6\x03\xec\x1a\xd2\x94\x99RUd\xb0\xecQR\x7f\x0e\xd0P\xb7\xc0v \xad\xa5~\x8e\x016\x1dX\x96V/\x86MG\x0c\xa3\x0el'
Receive: 36 1469.619158 1469.619067 49: seq: 17, identify_response offset=2160 data=b'[\x94\xb6)Ii\xd6\x11\\\xd7\xa1v\xff\xd8c\x00,\x82\x91\x9f\xc3\x0e\x8b\x995\x8dJm\xe9\x0c\xa4\xa5B9%\x90K,\x03\xf2'
Receive: 37 1469.619435 1469.619345 49: seq: 18, identify_response offset=2200 data=b'\xf6\xc6V\xa0\x89\xf6\xd1z6\xaf\xeb\x1fu\x8d\xb4s\xe2\tiV\xdfx8\xd8Z\xb8)\x9ePw7F\xde\xd4\xd6\xbb\x81\xa2\xbe\xd8'
Receive: 38 1469.619712 1469.619622 49: seq: 19, identify_response offset=2240 data=b's\xc6\xdb\x12\xf2Cc\xa0\xc0\xcb\x8d\x90\x92\xc3\x96P\xa9VS\x8d\xfa\x06\xc4\x98\x963\x9d\xa9(c\xe0\x0f\x1c/\n3\xf2\xcf\x13\x1c'
Receive: 39 1469.619992 1469.619900 49: seq: 1a, identify_response offset=2280 data=b'\x8a\xa1R\x1eJccW\xeb\xf3\xd8F.\x1a\x19\xdfAn\xf0*U-\xc3\xe0k\xd8\xd5\xdd#UO\xef\xb9^\x00\x96B\x03\x1a\x94'
Receive: 40 1469.620290 1469.620198 49: seq: 1b, identify_response offset=2320 data=b'\xc5\x817\xed\x0b\xf4)\xd8\xf2\xb8\xb5\x08G|\xb3G\x01~\x99?\x95\x1c\xa0~\xb3\x96\x92QG9c\xe9\x0bTXryT\xe6\xc4'
Receive: 41 1469.620575 1469.620485 49: seq: 1c, identify_response offset=2360 data=b'_\xa0\xc0,\xf1\x96\x8f\xfaN\x14\xdb\x88!\x9a\xa91s\xc6\x16\xf0,\xd6\xae\xb1}\x04\x8b)\xbf\xab\xdc\x99\xffFs\xab\x1d\xf1\xd8u'
Receive: 42 1469.620856 1469.620766 49: seq: 1d, identify_response offset=2400 data=b'lW(\x99\x90<\xb0[\xf6\xc1W\x11\xed\xf7T\xe3\x9a\x9a\xcb\x1f\x94\x14\x91\x12\xdc\x92\xe4\xaa\xfb\xf7\x01F\xa0\xfb\xcf\xd8a\xd2\xbeC'
Receive: 43 1469.621135 1469.621045 49: seq: 1e, identify_response offset=2440 data=b'\xd2{\x93\x85\xa0\xc6Z\x08\xa6\xfa\x1f\xdb\xe2\x0e\xa3Q\xa7\x15YI\x830\xa8A\xe6\x10@\x13\xe0bq\x05H\x98\xc6\x9a\xda@\x0e\xac'
Receive: 44 1469.621413 1469.621323 49: seq: 1f, identify_response offset=2480 data=b'<\xce\xd2wQ\xebu\x81TT\xa5\x03\xaf\x8e\xc1:\x16\xd8Hlp\x93\xcd\x11\xae;)\xd5IK\xb0\xcf\x11h/\xa7\xa6\xd8\x02\x0b'
Receive: 45 1469.621691 1469.621601 49: seq: 10, identify_response offset=2520 data=b'\x15\xed\x08-;Bs\xb2\xa3\x07,\x07V\xd1h\xc6J\xe4\x831\xfc\xde\xbe{\xa3*;\xea\x87\x1d\xc3d\xcf1iH\xd3%\xb0\xed'
Receive: 46 1469.621969 1469.621879 49: seq: 11, identify_response offset=2560 data=b'\xda\xf3;\x8c<\xca\xf6\x16\\\xcc\x98\xd4\x0e\xd0HM\xfb\xabtv\x87\xd4\n\xc4\xa5{A\rm\r#\xc0\xec\x0cp\xbb\xeaQ4/'
Receive: 47 1469.622245 1469.622155 49: seq: 12, identify_response offset=2600 data=b'\x0fS{\x0f\xca\x07\xa9JEom\xde\xbct\x00\xe0\x86\xbc\x9e\x0e\xb2\xe8\xd4\xa1\xda\x92\xac\x94LU\x1c\xc9j\xfe\xae\x02\xe7\xa9!\x8f'
Receive: 48 1469.622521 1469.622432 49: seq: 13, identify_response offset=2640 data=b'y\x80\x05\x88\t\x95\x9eX\x13\xd9\x1e\xb5g/\xd9/\x90\x0fA\x9ds\x87e\xda\x0e\xdb\xf3\xf2oT\r\xaag[\x9b\x1a\xe9\xc7\xdc\x8a'
Receive: 49 1469.622799 1469.622710 49: seq: 14, identify_response offset=2680 data=b'z\xee\x12\x9b\x9c\xe8\xe1\xc9\xf7\x94\x00F\x10\xd6\xd5\x90\x94\xa9w\xb6\x9f\xaf\xae\xdf\xd2\xf3\x88y P\xe51\x1aX]\x0c\x98E`;'
Receive: 50 1469.623075 1469.622985 49: seq: 15, identify_response offset=2720 data=b'\xe0D\r\x88VMN\x1d\x9f[tREN\x10+_H?\x8f\x9e$0\xff\x84\x82.\x0e7i\xaa\x12n=\xc8T\xc6M\x83,'
Receive: 51 1469.623352 1469.623262 49: seq: 16, identify_response offset=2760 data=b'U.\x02\x06Y\xb6\x86\xef\xf8\x13\xacT\xc3\xc5\xb4h\xec\x01\xben\xbf~\xf7\xd3C\x1c\xa8>\x10$1\x92KW\xd2\xe5\xa2\x9d5\xe0'
Receive: 52 1469.623628 1469.623539 49: seq: 17, identify_response offset=2800 data=b'\x95\xc7\xceOu\x9f\xce\xd1\xc9\x9b\xe7\xe8\x19I\xe15>\x99\x82P\x83\xe0\x1c#\x1d\xe5B\xae\x1e\xdf\x86\xe6f\xc1M\xe8\xe6\xbd\xaa\xd8'
Receive: 53 1469.623904 1469.623815 49: seq: 18, identify_response offset=2840 data=b"U\x8f\x1f\xe7\xcc\xb5\xaa6\x08D\x87\xdcv\xb5\x80Z=\xac\xa8~\xea\x97\xd8\xd6\x14\xfa#w\xbb\x9f\xa3\xc34\x0f+\x12|\xa4}'"
Receive: 54 1469.624201 1469.624109 49: seq: 19, identify_response offset=2880 data=b'\xd9"\x80\x1a\xad\x06\xf4%\x89\x08r\xb1\xb4(\xc6\x16\xf3\xa61\xe3\xea\xd05`\x8c\xc7\x8b\xf8O&(\xd9\xc8\xbd\x13\xe4\xe6\x92\xbc\xe6'
Receive: 55 1469.624480 1469.624391 49: seq: 1a, identify_response offset=2920 data=b'\xaa\x1a\x1b\x99n\\/\xde\xc3\xb5My\xea\xcf\\ .>*8q\xb2eq\xa3[fk\xafC??\xb8\x9c\xcaR\xbd\x10 \x8f'
Receive: 56 1469.624757 1469.624668 49: seq: 1b, identify_response offset=2960 data=b'X;\xc0^\xfe#\xd5V\xf5\x03\xd1\x80\xa1\xd4\xab\xefgm"\x89iZ[\xf2E\x8b\xff\x9c\x1a\x8d\x8ef\xd6\x19v]O\xdd\xdc5'
Receive: 57 1469.625038 1469.624948 49: seq: 1c, identify_response offset=3000 data=b'\xcd\x18j\x1e\xfaK\xdeM\xbb\x1d\x87\x80I\x8dt\xa8f\xc0+\xe4&\x95\x90ZcU[\xd1EX\xd3\xf9?-\x87\xcd\xa9N\xe0\xd1'
Receive: 58 1469.625315 1469.625225 49: seq: 1d, identify_response offset=3040 data=b'm\xf8\xbd\xe5\xd9\xb5D\xf3\xd6\xdb\x9f^\xa3\xea\x8d\x81\xf7P\x19\xf7&\xa3\xdaS:\xcd\x95S\xa3\x7f\xe4\xef\xf4\x8e\xedu\xd3\x16\xad6'
Receive: 59 1469.625592 1469.625502 49: seq: 1e, identify_response offset=3080 data=b'zK\x017\x8d\xbd\xa3\x99\x13\xf9\x0b\x9a<\x19MV\xb7\x1c\xbb\x06\xdc\xf1\t\xb0\xf5F\xdcg~S\xcd\xe9{Y\xd8\x0e\xdf\xc9\xe7?'
Receive: 60 1469.625867 1469.625777 49: seq: 1f, identify_response offset=3120 data=b"\xcf\x0f\x9cc)@\x8fu\x8c\x1e\xc3'\xdfK\xac\xc0\x89\xe9\x7f\xee\x01'\xf6\xb0\xba\x08\xa3\x8b\xd5y\x98D\xe7\xfb\xbbU\xb4\xadVI"
Receive: 61 1469.626142 1469.626053 17: seq: 10, identify_response offset=3160 data=b"\x16|\xfa\x0f\x07\xcd\x00'"
Receive: 62 1469.626417 1469.626328 9: seq: 11, identify_response offset=3168 data=b''
Receive: 63 1469.650251 1469.650066 11: seq: 12, uptime high=0 clock=132506315
Receive: 64 1469.701442 1469.701328 10: seq: 13, clock clock=135066687
Receive: 65 1469.752462 1469.752308 10: seq: 14, clock clock=137617064
Receive: 66 1469.803157 1469.803024 10: seq: 15, clock clock=140152144
Receive: 67 1469.853746 1469.853633 10: seq: 16, clock clock=142681787
Receive: 68 1469.904260 1469.904159 10: seq: 17, clock clock=145207568
Receive: 69 1469.954725 1469.954629 10: seq: 18, clock clock=147730835
Receive: 70 1470.006042 1470.005912 10: seq: 19, clock clock=150296353
Receive: 71 1470.056594 1470.056486 10: seq: 1a, clock clock=152824229
Receive: 72 1470.057642 1470.057527 10: seq: 1b, clock clock=152876418
Receive: 73 1470.070466 1470.070331 10: seq: 1c, config is_config=0 crc=0 is_shutdown=0 move_count=0
Receive: 74 1470.071264 1470.071169 15: seq: 1f, config is_config=1 crc=3912464276 is_shutdown=0 move_count=1024
Receive: 75 1471.042452 1471.042282 11: seq: 10, clock clock=202115896
Receive: 76 1472.000216 1471.042282 14: seq: 10, stats count=147 sum=137695 sumsq=651502
Receive: 77 1472.026831 1472.026702 11: seq: 11, clock clock=251335717
Receive: 78 1473.011327 1473.011025 11: seq: 12, clock clock=300556098
Receive: 79 1473.996049 1473.995724 11: seq: 13, clock clock=349791801
Receive: 80 1474.980673 1474.980394 11: seq: 14, clock clock=399022762
Receive: 81 1475.964769 1475.964659 11: seq: 15, clock clock=448230969
Receive: 82 1476.948969 1476.948838 11: seq: 16, clock clock=497440450
Receive: 83 1477.100253 1476.948838 13: seq: 16, stats count=57 sum=42048 sumsq=303795
Receive: 84 1477.933697 1477.933590 11: seq: 17, clock clock=546676505
Receive: 85 1478.918220 1478.918119 11: seq: 18, clock clock=595902299
Receive: 86 1479.902299 1479.902184 11: seq: 19, clock clock=645105762
Receive: 87 1480.887340 1480.887032 11: seq: 1a, clock clock=694353619
Receive: 88 1481.871795 1481.871500 11: seq: 1b, clock clock=743576065
Receive: 89 1482.100459 1481.871500 13: seq: 1b, stats count=55 sum=32867 sumsq=207528
Receive: 90 1482.856083 1482.855716 11: seq: 1c, clock clock=792790108
Receive: 91 1483.840758 1483.840480 11: seq: 1d, clock clock=842024431
Receive: 92 1484.825447 1484.825188 11: seq: 1e, clock clock=891258888
Receive: 93 1485.810375 1485.810099 11: seq: 1f, clock clock=940504405
Receive: 94 1486.794748 1486.794490 11: seq: 10, clock clock=989722247
Receive: 95 1487.200472 1486.794490 13: seq: 10, stats count=56 sum=51669 sumsq=382409
Receive: 96 1487.778837 1487.778718 11: seq: 11, clock clock=1038929378
Receive: 97 1488.763799 1488.763685 11: seq: 12, clock clock=1088177032
Receive: 98 1489.748434 1489.748322 11: seq: 13, clock clock=1137408447
Receive: 99 1489.985808 1489.985616 12: seq: 14, shutdown clock=1149274726 static_string_id=Command request
Stats 1491.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=7 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=948 bytes_read=4902 bytes_retransmit=0 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999628 adj=49995718 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.05 cputime=37.916 memavail=7503804 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1492.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=8 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000018 mcu_task_stddev=0.000019 bytes_write=954 bytes_read=4918 bytes_retransmit=0 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999605 adj=49995637 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=37.924 memavail=7503804 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1493.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=9 freq=400028842 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=960 bytes_read=4947 bytes_retransmit=0 bytes_invalid=0 send_seq=135 receive_seq=135 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999623 adj=49995597 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=37.939 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1494.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=10 freq=400028842 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=966 bytes_read=4963 bytes_retransmit=0 bytes_invalid=0 send_seq=136 receive_seq=136 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999649 adj=49995808 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=37.957 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1495.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=11 freq=400028842 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=972 bytes_read=4979 bytes_retransmit=0 bytes_invalid=0 send_seq=137 receive_seq=137 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999691 adj=49996026 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=37.976 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1496.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=12 freq=400028842 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=978 bytes_read=4995 bytes_retransmit=0 bytes_invalid=0 send_seq=138 receive_seq=138 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999707 adj=49996297 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=37.994 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1497.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=13 freq=400028842 rpi: mcu_awake=0.000 mcu_task_avg=0.000008 mcu_task_stddev=0.000010 bytes_write=984 bytes_read=5011 bytes_retransmit=0 bytes_invalid=0 send_seq=139 receive_seq=139 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999720 adj=49996350 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.013 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1498.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=14 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=990 bytes_read=5040 bytes_retransmit=0 bytes_invalid=0 send_seq=140 receive_seq=140 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999726 adj=49996379 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.032 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1499.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=15 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=996 bytes_read=5056 bytes_retransmit=0 bytes_invalid=0 send_seq=141 receive_seq=141 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999721 adj=49996352 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.051 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1500.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=16 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1002 bytes_read=5072 bytes_retransmit=0 bytes_invalid=0 send_seq=142 receive_seq=142 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999726 adj=49996264 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.069 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1501.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=17 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1008 bytes_read=5088 bytes_retransmit=0 bytes_invalid=0 send_seq=143 receive_seq=143 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999729 adj=49996262 Octopus_Max: temp=41.9 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.088 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1502.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=18 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1014 bytes_read=5104 bytes_retransmit=0 bytes_invalid=0 send_seq=144 receive_seq=144 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999733 adj=49996246 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.106 memavail=7503560 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1503.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=19 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1020 bytes_read=5133 bytes_retransmit=0 bytes_invalid=0 send_seq=145 receive_seq=145 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999724 adj=49996249 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.124 memavail=7503628 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1504.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=20 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1026 bytes_read=5149 bytes_retransmit=0 bytes_invalid=0 send_seq=146 receive_seq=146 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999721 adj=49996149 Octopus_Max: temp=41.9 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.138 memavail=7497844 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1505.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=21 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1032 bytes_read=5165 bytes_retransmit=0 bytes_invalid=0 send_seq=147 receive_seq=147 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999698 adj=49996116 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.147 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1506.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=22 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1038 bytes_read=5181 bytes_retransmit=0 bytes_invalid=0 send_seq=148 receive_seq=148 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999676 adj=49995932 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.04 cputime=38.155 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1507.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=23 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000022 bytes_write=1044 bytes_read=5197 bytes_retransmit=0 bytes_invalid=0 send_seq=149 receive_seq=149 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999660 adj=49995785 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.163 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1508.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=24 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1050 bytes_read=5226 bytes_retransmit=0 bytes_invalid=0 send_seq=150 receive_seq=150 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999645 adj=49995728 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.171 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1509.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=26 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1056 bytes_read=5242 bytes_retransmit=0 bytes_invalid=0 send_seq=151 receive_seq=151 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999634 adj=49995682 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.183 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1510.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=27 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1062 bytes_read=5258 bytes_retransmit=0 bytes_invalid=0 send_seq=152 receive_seq=152 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999643 adj=49995671 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.202 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1511.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=28 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1068 bytes_read=5274 bytes_retransmit=0 bytes_invalid=0 send_seq=153 receive_seq=153 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999646 adj=49995845 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.223 memavail=7503728 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1512.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=29 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1074 bytes_read=5290 bytes_retransmit=0 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999649 adj=49995915 Octopus_Max: temp=41.9 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.241 memavail=7503740 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1513.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=30 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1080 bytes_read=5319 bytes_retransmit=0 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999652 adj=49995981 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.261 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1514.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=31 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1086 bytes_read=5335 bytes_retransmit=0 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999661 adj=49996023 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.280 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1515.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=32 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1092 bytes_read=5351 bytes_retransmit=0 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999664 adj=49996115 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.300 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1516.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=33 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1098 bytes_read=5367 bytes_retransmit=0 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999664 adj=49996124 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.319 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1517.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=34 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000017 mcu_task_stddev=0.000021 bytes_write=1104 bytes_read=5383 bytes_retransmit=0 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999664 adj=49996108 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.338 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1518.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=35 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1110 bytes_read=5412 bytes_retransmit=0 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999660 adj=49996093 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.357 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1519.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=36 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1116 bytes_read=5428 bytes_retransmit=0 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999660 adj=49996053 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.376 memavail=7503752 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1520.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=37 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1122 bytes_read=5444 bytes_retransmit=0 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999663 adj=49996047 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.392 memavail=7499732 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1521.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=38 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1128 bytes_read=5460 bytes_retransmit=0 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999653 adj=49996079 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.401 memavail=7505744 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1522.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=39 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000019 mcu_task_stddev=0.000021 bytes_write=1134 bytes_read=5476 bytes_retransmit=0 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999644 adj=49995975 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.409 memavail=7505656 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1523.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=40 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000016 bytes_write=1140 bytes_read=5505 bytes_retransmit=0 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999636 adj=49995897 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.418 memavail=7505184 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1524.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=41 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000016 bytes_write=1146 bytes_read=5521 bytes_retransmit=0 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999627 adj=49995850 Octopus_Max: temp=41.9 Pi: temp=37.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.426 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1525.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=42 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000016 bytes_write=1152 bytes_read=5537 bytes_retransmit=0 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999617 adj=49995799 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.436 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1526.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=43 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000016 bytes_write=1158 bytes_read=5553 bytes_retransmit=0 bytes_invalid=0 send_seq=168 receive_seq=168 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999619 adj=49995746 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.03 cputime=38.455 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1527.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=44 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000013 mcu_task_stddev=0.000016 bytes_write=1164 bytes_read=5569 bytes_retransmit=0 bytes_invalid=0 send_seq=169 receive_seq=169 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999623 adj=49995833 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.474 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1528.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=45 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=1170 bytes_read=5598 bytes_retransmit=0 bytes_invalid=0 send_seq=170 receive_seq=170 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999629 adj=49995929 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.493 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1529.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=46 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=1176 bytes_read=5614 bytes_retransmit=0 bytes_invalid=0 send_seq=171 receive_seq=171 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999630 adj=49996015 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.513 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1530.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=47 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=1182 bytes_read=5630 bytes_retransmit=0 bytes_invalid=0 send_seq=172 receive_seq=172 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999629 adj=49996026 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.531 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1531.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=48 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=1188 bytes_read=5646 bytes_retransmit=0 bytes_invalid=0 send_seq=173 receive_seq=173 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999628 adj=49996016 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.550 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1532.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=49 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000015 mcu_task_stddev=0.000019 bytes_write=1194 bytes_read=5662 bytes_retransmit=0 bytes_invalid=0 send_seq=174 receive_seq=174 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999631 adj=49996012 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.569 memavail=7505192 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1533.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=50 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1200 bytes_read=5691 bytes_retransmit=0 bytes_invalid=0 send_seq=175 receive_seq=175 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999632 adj=49996039 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.588 memavail=7504452 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1534.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=51 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1206 bytes_read=5707 bytes_retransmit=0 bytes_invalid=0 send_seq=176 receive_seq=176 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999633 adj=49996048 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.607 memavail=7504456 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1535.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=52 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1212 bytes_read=5723 bytes_retransmit=0 bytes_invalid=0 send_seq=177 receive_seq=177 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999633 adj=49996054 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.625 memavail=7504456 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1536.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=53 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1218 bytes_read=5739 bytes_retransmit=0 bytes_invalid=0 send_seq=178 receive_seq=178 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999636 adj=49996054 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.644 memavail=7504456 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1537.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=54 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000020 mcu_task_stddev=0.000022 bytes_write=1230 bytes_read=5771 bytes_retransmit=0 bytes_invalid=0 send_seq=180 receive_seq=180 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999624 adj=49996081 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.654 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1538.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=55 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1236 bytes_read=5800 bytes_retransmit=0 bytes_invalid=0 send_seq=181 receive_seq=181 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999616 adj=49995932 Octopus_Max: temp=41.9 Pi: temp=36.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.663 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1539.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=56 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1242 bytes_read=5816 bytes_retransmit=0 bytes_invalid=0 send_seq=182 receive_seq=182 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999609 adj=49995853 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.671 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1540.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=57 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1248 bytes_read=5832 bytes_retransmit=0 bytes_invalid=0 send_seq=183 receive_seq=183 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999601 adj=49995811 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.678 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1541.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=58 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1254 bytes_read=5848 bytes_retransmit=0 bytes_invalid=0 send_seq=184 receive_seq=184 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999594 adj=49995765 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.685 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1542.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=59 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000016 mcu_task_stddev=0.000020 bytes_write=1260 bytes_read=5864 bytes_retransmit=0 bytes_invalid=0 send_seq=185 receive_seq=185 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999603 adj=49995739 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.700 memavail=7504588 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1543.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=60 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1266 bytes_read=5893 bytes_retransmit=0 bytes_invalid=0 send_seq=186 receive_seq=186 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999609 adj=49995912 Octopus_Max: temp=41.9 Pi: temp=35.5  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.720 memavail=7503900 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1544.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=61 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1272 bytes_read=5909 bytes_retransmit=0 bytes_invalid=0 send_seq=187 receive_seq=187 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999612 adj=49996001 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.737 memavail=7503900 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1545.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=62 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1278 bytes_read=5925 bytes_retransmit=0 bytes_invalid=0 send_seq=188 receive_seq=188 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999614 adj=49996036 Octopus_Max: temp=41.9 Pi: temp=36.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.757 memavail=7503900 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
Stats 1546.0: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000002 mcu_task_stddev=0.000001 bytes_write=9839 bytes_read=15946 bytes_retransmit=9 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=63 freq=400028842 rpi: mcu_awake=0.001 mcu_task_avg=0.000011 mcu_task_stddev=0.000016 bytes_write=1284 bytes_read=5941 bytes_retransmit=0 bytes_invalid=0 send_seq=189 receive_seq=189 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=49999616 adj=49996061 Octopus_Max: temp=41.9 Pi: temp=35.0  heater_bed: target=0 temp=25.1 pwm=0.000 bed_core: temp=24.8 sysload=0.02 cputime=38.775 memavail=7503900 print_time=19.418 buffer_time=0.000 print_stall=0 extruder: target=0 temp=-93.9 pwm=0.000
webhooks client 4123601912: Disconnected
Starting Klippy...
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/printer_data/config/printer.cfg', '-l', '/home/pi/printer_data/logs/klippy.log', '-I', '/home/pi/printer_data/comms/klippy.serial', '-a', '/home/pi/printer_data/comms/klippy.sock']
Git version: 'v0.12.0-142-gb029d046-dirty'
Untracked files: klippy/extras/autotune_tmc.py, klippy/extras/beacon.py, klippy/extras/gcode_shell_command.py, klippy/extras/linear_movement_vibrations.py, klippy/extras/motor_constants.py, klippy/extras/ratos_homing.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper.git
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Mon Apr 15 05:59:10 2024 (1713157150.6 25.2)
===== Config file =====
[board_pins octopus_max_ez_tmc2209]
aliases = 
	
	
	motor_1_step=PC13, motor_1_dir=PC14, motor_1_enable=PE6, motor_1_uart=PG14,
	motor_2_step=PE4, motor_2_dir=PE5, motor_2_enable=PE3, motor_2_uart=PG13,
	motor_3_step=PE1, motor_3_dir=PE0, motor_3_enable=PE2, motor_3_uart=PG12,
	motor_4_step=PB8, motor_4_dir=PB9, motor_4_enable=PB7, motor_4_uart=PG11,
	motor_5_step=PB5, motor_5_dir=PB4, motor_5_enable=PB6, motor_5_uart=PG10,
	motor_6_step=PG15, motor_6_dir=PB3, motor_6_enable=PD5, motor_6_uart=PG9,
	motor_7_step=PD3, motor_7_dir=PD2, motor_7_enable=PD4, motor_7_uart=PD7,
	motor_8_step=PA10, motor_8_dir=PA9, motor_8_enable=PA15, motor_8_uart=PD6,
	motor_9_step=PA8, motor_9_dir=PC7, motor_9_enable=PC9, motor_9_uart=PG8,
	motor_10_step=PG6, motor_10_dir=PC6, motor_10_enable=PC8, motor_10_uart=PG7,
	
	stepper_spi_mosi=PE14, stepper_spi_miso=PE13, stepper_spi_sclk=PE12,
	
	
	heater_e0=PF6, heater_e1=PA3, heater_e2=PF9, heater_e3=PF7, heater_bed=PF5,
	
	
	thermistor_e0=PB0, thermistor_e1=PC5, thermistor_e2=PC4, thermistor_e3=PA7, thermistor_bed=PB1,
	
	
	endstop_motor_1=PF0, endstop_motor_2=PF2, endstop_motor_3=PF4, det_motor_4=PF3, det_motor_5=PF1, det_motor_6=PC15,
	
	
	fan_0=PA6, fan_1=PA5, fan_2=PA4, fan_3=PA3,
	fan_4_pwm=PA1, fan_4_tach=PC3, fan_5_pwm=PF8, fan_5_tach=PC1, fan_6_pwm=PA2, fan_6_tach=PC2,
	
	
	rgb_led_1=PE10, rgb_led_2=PE9,
	
	
	ps_on=PF13, pwr_det=PF12,
	
	
	bltouch_servo=PB14, bltouch_probe=PB15,
	
	
	proximity_probe=PF11,
	
	
	filament_sensor_adc1=PC0, filament_sensor_adc2=PF10,
	
	
	eeprom_scl=PB10, eeprom_sda=PB11,
	
	
	can_rx=PD0, can_tx=PD1,
	
	
	tft_uart_rx=PD9, tft_uart_tx=PD8,
	
	
	usb_dm=PA11, usb_dp=PA12,
	
	
	lcd_d7=PE15, lcd_d6=PD10, lcd_d5=PD11, lcd_d4=PD12, lcd_rs=PD13, lcd_en=PD14, lcd_buzzer=PG2, lcd_enc=PD15,
	lcd_reset=RESET, sd_detect=PG3,
	
	
	tmc_spi_cs=PF14, tmc_spi_mosi=PE14, tmc_spi_miso=PE13, tmc_spi_sclk=PE12,
	
	
	wifi_reset=PB2, wifi_io0=PG0, wifi_io4=PF15, wifi_rx=PE7, wifi_tx=PE8, wifi_cs=PG15, wifi_mosi=PC12, wifi_miso=PC11, wifi_sclk=PC10,

[mcu]
baud = 250000
serial = /dev/btt-octopus-max-ez

[temperature_sensor Octopus_Max]
sensor_type = temperature_mcu
min_temp = 0
max_temp = 100

[mcu rpi]
serial = /tmp/klipper_host_mcu

[temperature_sensor Pi]
sensor_type = temperature_host
min_temp = 0
max_temp = 100

[idle_timeout]
gcode = 
	{% if printer.webhooks.state|lower == 'ready' %}
	{% if printer.pause_resume.is_paused|lower == 'false' %}
	M117 Idle timeout reached
	TURN_OFF_HEATERS
	M84
	{% endif %}
	{% endif %}
timeout = 7200

[skew_correction]

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 68.4
shaper_type_y = 2hump_ei
shaper_freq_y = 73.0

[virtual_sdcard]
path = ~/printer_data/gcodes

[display_status]

[pause_resume]

[force_move]
enable_force_move = True

[respond]

[exclude_object]

[heater_bed]
heater_pin = heater_bed
sensor_pin = thermistor_bed
sensor_type = Generic 3950
min_temp = -273.15
max_temp = 99999
pwm_cycle_time = 0.02
control = pid
pid_kp = 57.843
pid_ki = 2.073
pid_kd = 403.458

[temperature_sensor bed_core]
sensor_pin = thermistor_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
min_temp = 0
max_temp = 280

[fan]
pin = fan_4_pwm
tachometer_pin = ^fan_4_tach
shutdown_speed = 1.0
tachometer_poll_interval = 0.0005
cycle_time = 0.01

[heater_fan toolhead]
pin = fan_0
fan_speed = 1.0
shutdown_speed = 1.0
kick_start_time = 5
heater = extruder
heater_temp = 49

[controller_fan controller_fan]
pin = fan_6_pwm
tachometer_pin = ^fan_6_tach
tachometer_poll_interval = 0.0005
cycle_time = 0.01
idle_timeout = 300
stepper = stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2, extruder

[printer]
kinematics = corexy
max_velocity = 800
max_accel = 12000
minimum_cruise_ratio = 0.5
max_z_velocity = 20
max_z_accel = 150
square_corner_velocity = 5

[ratos_homing]
axes = xyz
z_hop = 15
z_hop_speed = 15
gcode = 
	{% set x_homed = 'x' in printer.toolhead.homed_axes %}
	{% set y_homed = 'y' in printer.toolhead.homed_axes %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set z_probe = printer["gcode_macro RatOS"].z_probe|lower %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set z_hop = printer.configfile.config.ratos_homing.z_hop|float %}
	{% set z_hop_speed = printer.configfile.config.ratos_homing.z_hop_speed|float * 60 %}
	{% set homing_x = printer["gcode_macro RatOS"].homing_x|lower %}
	{% set homing_y = printer["gcode_macro RatOS"].homing_y|lower %}
	{% set homing = printer["gcode_macro RatOS"].homing|lower %}
	{% set prev_stop_on_error = printer["gcode_macro RatOS"].stowable_probe_stop_on_error %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE=True
	
	M400
	G90
	
	{% if params.X is defined or params.Y is not defined and params.Z is not defined %}
	RESPOND MSG="Homing X"
	{% if homing_x == 'endstop' or homing == 'endstops' %}
	G28 X
	{% elif homing_x == 'sensorless' or homing == 'sensorless' %}
	HOME_X_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_x to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_x, homing)) }
	{% endif %}
	{% set x_homed = True %}
	G0 X{safe_home_x} F{speed}
	M400
	{% endif %}
	
	{% if params.Y is defined or params.X is not defined and params.Z is not defined %}
	RESPOND MSG="Homing Y"
	{% if homing_y == 'endstop' or homing == 'endstops' %}
	G28 Y
	{% elif homing_y == 'sensorless' or homing == 'sensorless' %}
	HOME_Y_SENSORLESS
	{% else %}
	{ action_emergency_stop("expected RatOS variable_homing_y to be 'sensorless' 'endstop' or variable_homing to be 'sensorless' or 'endstops' but found {} and {}".format(homing_y, homing)) }
	{% endif %}
	{% set y_homed = True %}
	G0 Y{safe_home_y} F{speed}
	M400
	{% endif %}
	
	{% if params.Z is defined or params.Y is not defined and params.X is not defined %}
	RESPOND MSG="Homing Z"
	{% if x_homed == False or y_homed == False %}
	M118 X and Y must be homed before homing Z
	{ action_emergency_stop("X and Y must be homed before homing Z") }
	{% else %}
	{% if z_probe == "stowable" %}
	DEPLOY_PROBE
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	STOW_PROBE
	{% else %}
	G0 X{safe_home_x} Y{safe_home_y} F{speed}
	G28 Z
	G0 Z{z_hop} F{z_hop_speed}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=stowable_probe_stop_on_error VALUE={prev_stop_on_error}

[gcode_macro HOME_X_SENSORLESS]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% set safe_home_x = printer["gcode_macro RatOS"].safe_home_x %}
	{% if safe_home_x is not defined or safe_home_x|lower == 'middle' %}
	{% set safe_home_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_x_current}
	G4 P300
	G28 X
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro HOME_Y_SENSORLESS]
gcode = 
	{% set safe_home_y = printer["gcode_macro RatOS"].safe_home_y %}
	{% set x_driver = printer["gcode_macro RatOS"].driver_type_x|lower ~ " stepper_x" %}
	{% set y_driver = printer["gcode_macro RatOS"].driver_type_y|lower ~ " stepper_y" %}
	{% if safe_home_y is not defined or safe_home_y|lower == 'middle' %}
	{% set safe_home_y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	M204 S1000
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer["gcode_macro RatOS"].sensorless_y_current}
	G4 P300
	G28 Y
	SET_TMC_CURRENT STEPPER=stepper_x CURRENT={printer.configfile.config[x_driver].run_current}
	SET_TMC_CURRENT STEPPER=stepper_y CURRENT={printer.configfile.config[y_driver].run_current}
	G4 P300
	
	M204 S{printer.configfile.config.printer.max_accel}

[gcode_macro MAYBE_HOME]
description = Only home unhomed axis
variable_is_kinematic_position_overriden = False
gcode = 
	{% if printer["gcode_macro MAYBE_HOME"].is_kinematic_position_overriden|lower == 'true' %}
	RESPOND MSG="SET_CENTER_KINEMATIC_POSITION has been abused. Homing all axes. Please refrain from using SET_CENTER_KINEMATIC_POSITION outside of debugging purposes."
	G28
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=False
	{% else %}
	{% set axes = '' %}
	{% set isHomed = true %}
	{% set axesToHome = '' %}
	{% if params.X is defined %}
	{% set axes = axes ~ 'X ' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% endif %}
	{% if params.Y is defined %}
	{% set axes = axes ~ 'Y ' %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% endif %}
	{% if params.Z is defined %}
	{% set axes = axes ~ 'Z ' %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if params.X is not defined and params.Y is not defined and params.Z is not defined %}
	{% set axes = '' %}
	{% if 'x' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'X ' %}
	{% endif %}
	{% if 'y' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Y ' %}
	{% endif %}
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% set isHomed = false %}
	{% set axesToHome = axesToHome ~ 'Z ' %}
	{% endif %}
	{% endif %}
	{% if isHomed is false %}
	M117 Homing {axesToHome}
	RESPOND MSG="Homing {axesToHome}"
	G28 {axesToHome}
	{% else %}
	RESPOND MSG="All requested axes already homed, skipping.."
	{% endif %}
	{% endif %}

[gcode_macro ECHO_RATOS_VARS]
description = Echo RatOS variables to the console.
gcode = 
	{% for var, value in printer["gcode_macro RatOS"].items() %}
	{action_respond_info(var ~ ": " ~ value)}
	{% endfor %}

[gcode_macro RatOS]
description = RatOS variable storage macro, will echo variables to the console when run.
variable_relative_extrusion = False
variable_force_absolute_position = False
variable_preheat_extruder = True
variable_preheat_extruder_temp = 150
variable_calibrate_bed_mesh = True
variable_nozzle_priming = "linepurge"
variable_verbose_enable = True
variable_purge_height = 0.8
variable_tip_distance = 0.4
variable_purge_margin = 20
variable_purge_amount = 30
variable_flow_rate = 10
variable_nozzle_prime_start_x = "max"
variable_nozzle_prime_start_y = "min"
variable_nozzle_prime_direction = "auto"
variable_nozzle_prime_bridge_fan = 102
variable_filament_unload_length = 130
variable_filament_unload_speed = 5
variable_filament_load_length = 100
variable_filament_load_speed = 10
variable_start_print_park_in = "back"
variable_start_print_park_z_height = 50
variable_start_print_heat_chamber_bed_temp = 115
variable_end_print_park_in = "back"
variable_pause_print_park_in = "back"
variable_macro_travel_speed = 300
variable_macro_z_speed = 15
variable_end_print_park_z_hop = 20
variable_homing = "endstops"
variable_sensorless_x_current = 0.6
variable_sensorless_y_current = 0.9
variable_z_probe = "static"
variable_safe_home_x = "middle"
variable_safe_home_y = "middle"
variable_stowable_probe_stop_on_error = False
variable_driver_type_x = "tmc2209"
variable_driver_type_y = "tmc2209"
variable_adaptive_mesh = True
variable_probe_for_priming_result = None
variable_adaptive_prime_offset_threshold = -1.0
gcode = 
	ECHO_RATOS_VARS
variable_homing_x = "endstop"
variable_homing_y = "endstop"

[gcode_macro PAUSE]
description = Pauses the printer
rename_existing = PAUSE_BASE
variable_extrude = 1.5
gcode = 
	SAVE_GCODE_STATE NAME=PAUSE_state
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 20.0) %}
	{% set z_safe = 20.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	PAUSE_BASE
	G91
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G1 E-{E} F2100
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	
	{% if "xyz" in printer.toolhead.homed_axes %}
	G1 Z{z_safe} F{z_speed}
	_PARK LOCATION={printer["gcode_macro RatOS"].pause_print_park_in} X={printer["gcode_macro RatOS"].pause_print_park_x}
	{% else %}
	{action_respond_info("Printer not homed")}
	{% endif %}

[gcode_macro RESUME]
description = Resumes the print if the printer is paused.
rename_existing = RESUME_BASE
gcode = 
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	{% if printer.extruder.can_extrude|lower == 'true' %}
	G91
	G1 E{E} F2100
	G90
	{% else %}
	{action_respond_info("Extruder not hot enough")}
	{% endif %}
	RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_travel_speed|float}
	RESUME_BASE

[gcode_macro CANCEL_PRINT]
description = Cancels the printer
rename_existing = CANCEL_PRINT_BASE
gcode = 
	END_PRINT
	TURN_OFF_HEATERS
	CLEAR_PAUSE
	
	CANCEL_PRINT_BASE
	RESPOND COLOR=error MSG="Print cancelled"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro PRIME_LINE]
description = Prints a primeline, used internally, if configured, as part of the START_PRINT macro.
gcode = 
	SAVE_GCODE_STATE NAME=prime_line_state
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M82
	M117 Priming nozzle with prime line..
	RESPOND MSG="Priming nozzle with prime line.."
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start} F{speed}
	
	G1 Z0.3 F{z_speed}
	
	G92 E0
	
	G1 Y{y_start + (70 * y_factor)} E16 F1200
	
	G1 Y{y_start + (90 * y_factor)} F{speed}
	RESTORE_GCODE_STATE NAME=prime_line_state

[gcode_macro PRIME_BLOB]
description = Prints a primeblob, used internally, if configured, as part of the START_PRINT macro. Slower than PRIME_LINE but much more effective.
gcode = 
	SAVE_GCODE_STATE NAME=prime_blob_state
	M117 Priming nozzle with prime blob..
	RESPOND MSG="Priming nozzle with prime blob.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% set fan_speed = printer["gcode_macro RatOS"].nozzle_prime_bridge_fan|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% set y_factor = -1 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|float < printer.toolhead.axis_maximum.y / 2 %}
	{% set y_factor = 1 %}
	{% else %}
	{% set y_factor = -1 %}
	{% endif %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'forwards' %}
	{% set y_factor = 1 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_direction|lower == 'backwards' %}
	{% set y_factor = -1 %}
	{% endif %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} F{speed}
	G1 Y{y_start + (15 * y_factor)} F{speed}
	
	G1 Z0.5 F{z_speed}
	
	G1 Y{y_start} F{speed}
	
	G1 F60 E20
	
	M106 S{fan_speed}
	
	G1 Z5 F100 E5
	
	G1 F200 Y{y_start + (25 * y_factor)} E1
	
	
	
	G1 F200 Y{y_start + (30 * y_factor)} Z3.8 E0.5
	G1 F200 Y{y_start + (35 * y_factor)} Z2.6 E0.5
	G1 F200 Y{y_start + (40 * y_factor)} Z1.4 E0.5
	G1 F200 Y{y_start + (45 * y_factor)} Z0.2 E0.5
	
	M106 S0
	
	G1 F200 Y{y_start + (50 * y_factor)} Z0.2 E0.6
	
	G1 F{speed} Y{y_start + (100 * y_factor)}
	RESTORE_GCODE_STATE NAME=prime_blob_state

[gcode_macro _PARK]
gcode = 
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	
	{% if params.X != '' %}
	{% if params.X|float >= printer.toolhead.axis_minimum.x + 5 and params.X|float <= printer.toolhead.axis_maximum.x - 5 %}
	{% set safe_x = params.X|float %}
	{% else %}
	{action_respond_info('The requested X co-ordinate is outside the defined axis bounds - using defaults')}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	{% else %}
	{% set safe_x = printer.toolhead.axis_maximum.x / 2 %}
	{% endif %}
	
	{% if params.LOCATION|default('back')|lower == 'back' %}
	{% set y = printer.toolhead.axis_maximum.y - 5 %}
	{% elif params.LOCATION|lower == 'front' %}
	{% set y = printer.toolhead.axis_minimum.y + 5 %}
	{% elif params.LOCATION|lower == 'center' %}
	{% set y = printer.toolhead.axis_maximum.y / 2 %}
	{% endif %}
	
	G90
	
	G0 X{safe_x} Y{y} F{speed}

[gcode_macro M600]
description = Executes a color change by pausing the printer an unloading the filament.
gcode = 
	PAUSE
	UNLOAD_FILAMENT
	M117 Please load new filament and resume
	RESPOND MSG="Please load new filament and resume"

[gcode_macro UNLOAD_FILAMENT]
description = Unloads the filament. Note: be careful with PETG, make sure you inspect the tip of your filament before reloading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=unload_state
	G91
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set unload_speed = printer["gcode_macro RatOS"].filament_unload_speed|float * 60 %}
	{% set unload_length = printer["gcode_macro RatOS"].filament_unload_length|float %}
	M117 Unloading filament...
	
	G0 E10 F300
	
	G0 E-5 F3600
	
	G4 P3000
	
	G0 E5 F3600
	
	G0 E-15 F3600
	
	G0 E-{unload_length} F{unload_speed}
	M117 Filament unloaded!
	RESPOND MSG="Filament unloaded! Please inspect the tip of the filament before reloading."
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro LOAD_FILAMENT]
description = Loads new filament. Note: be careful with PETG, make sure you inspect the tip of your filament before loading to avoid jams.
gcode = 
	SAVE_GCODE_STATE NAME=load_state
	G91
	
	{% if params.TEMP is defined or printer.extruder.can_extrude|lower == 'false' %}
	M117 Heating...
	M104 S{params.TEMP|default(220, true)}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.TEMP|default(220, true)}
	{% endif %}
	{% set load_speed = printer["gcode_macro RatOS"].filament_load_speed|float * 60 %}
	{% set load_length = printer["gcode_macro RatOS"].filament_load_length|float %}
	M117 Loading filament...
	
	G0 E{load_length} F{load_speed}
	
	G4 P1000
	
	G0 E40 F100
	
	M400
	M117 Filament loaded!
	RESPOND MSG="Filament loaded!"
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro SET_CENTER_KINEMATIC_POSITION]
description = FOR DEBUGGING PURPOSES ONLY. Sets the internal printer kinematic state to the center of all axes regardless of actual physical position.
gcode = 
	RESPOND MSG="WARNING: ONLY USE SET_CENTER_KINEMATIC_POSITION FOR DEBUGGING PURPOSES. YOU'RE OVERRIDING THE INTERNAL POSITIONING STATE OF THE PRINTER. PROCEED WITH CAUTION AND DO A PROPER G28 WHEN DONE."
	SET_GCODE_VARIABLE MACRO=MAYBE_HOME VARIABLE=is_kinematic_position_overriden VALUE=True
	SET_KINEMATIC_POSITION X={printer.toolhead.axis_maximum.x / 2} Y={printer.toolhead.axis_maximum.y / 2} Z={printer.toolhead.axis_maximum.z / 2}

[gcode_macro START_PRINT]
description = Start print procedure, use this in your Slicer.
gcode = 
	CLEAR_PAUSE
	{% if printer["gcode_macro RatOS"].force_absolute_position|lower == 'true' %}
	G90
	{% endif %}
	SAVE_GCODE_STATE NAME=start_print_state
	
	G21
	
	G90
	
	M82
	_USER_START_PRINT_BEFORE_HOMING
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_BEGIN_BATCH
	{% endif %}
	
	MAYBE_HOME
	{% if params.CHAMBER_TEMP is defined %}
	_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	_USER_START_PRINT_HEAT_CHAMBER CHAMBER_TEMP={params.CHAMBER_TEMP} BED_TEMP={printer["gcode_macro RatOS"].start_print_heat_chamber_bed_temp}
	{% endif %}
	M117 Heating bed...
	RESPOND MSG="Heating bed..."
	
	M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_BED
	
	_START_PRINT_AFTER_HEATING_BED
	
	_USER_START_PRINT_BED_MESH
	
	_START_PRINT_BED_MESH X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOWABLE_PROBE_END_BATCH
	{% endif %}
	
	M104 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_PARK
	
	_START_PRINT_PARK
	
	M117 Heating Extruder...
	RESPOND MSG="Heating Extruder..."
	M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }
	
	_USER_START_PRINT_AFTER_HEATING_EXTRUDER
	
	_START_PRINT_AFTER_HEATING_EXTRUDER
	M117 Printing...
	RESPOND MSG="Printing..."
	RESTORE_GCODE_STATE NAME=start_print_state
	
	{% if printer["gcode_macro RatOS"].relative_extrusion|lower == 'true' %}
	M83
	{% else %}
	M82
	{% endif %}
	G92 E0

[gcode_macro _USER_START_PRINT_BEFORE_HOMING]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_BED]
gcode = 
	{% if printer["gcode_macro RatOS"].preheat_extruder|lower == 'true' %}
	{% set min_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float %}
	{% set max_temp = printer["gcode_macro RatOS"].preheat_extruder_temp|float + 5 %}
	M117 Pre-heating extruder...
	RESPOND MSG="Pre-heating extruder..."
	
	
	M104 S{min_temp}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_temp} MAXIMUM={max_temp}
	{% endif %}
	M117 Adjusting Z tilt...
	RESPOND MSG="Adjusting Z tilt..."
	
	Z_TILT_ADJUST
	M117 Rehoming Z after Z tilt adjustment...
	RESPOND MSG="Rehoming Z after Z tilt adjustment..."
	
	G28 Z

[gcode_macro _USER_START_PRINT_AFTER_HEATING_BED]
gcode = 

[gcode_macro _START_PRINT_BED_MESH]
gcode = 
	{% set default_profile = printer["gcode_macro RatOS"].bed_mesh_profile|default('ratos') %}
	{% if printer["gcode_macro RatOS"].calibrate_bed_mesh|lower == 'true' %}
	BED_MESH_CLEAR
	{% if printer["gcode_macro RatOS"].adaptive_mesh|lower == 'true' %}
	CALIBRATE_ADAPTIVE_MESH PROFILE={default_profile} X0={params.X0} X1={params.X1} Y0={params.Y0} Y1={params.Y1}
	{% else %}
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% endif %}
	BED_MESH_PROFILE LOAD={default_profile}
	{% elif printer["gcode_macro RatOS"].bed_mesh_profile is defined %}
	BED_MESH_CLEAR
	BED_MESH_PROFILE LOAD={printer["gcode_macro RatOS"].bed_mesh_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_BED_MESH]
gcode = 

[gcode_macro _START_PRINT_PARK]
gcode = 
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	_PARK LOCATION={printer["gcode_macro RatOS"].start_print_park_in} X={printer["gcode_macro RatOS"].start_print_park_x}
	G0 Z{z} F{zSpeed}

[gcode_macro _USER_START_PRINT_PARK]
gcode = 

[gcode_macro _START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 
	{% set has_offset = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) != 9999.9 %}
	{% if has_offset %}
	ADD_PRIME_PROBE_TO_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeline' %}
	PRIME_LINE
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'primeblob' %}
	PRIME_BLOB
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower == 'linepurge' %}
	LINE_PURGE
	{% endif %}
	{% if has_offset %}
	SUBTRACT_PRIME_PROBE_FROM_OFFSET
	{% endif %}
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SKEW_PROFILE LOAD={printer["gcode_macro RatOS"].skew_profile}
	{% endif %}

[gcode_macro _USER_START_PRINT_AFTER_HEATING_EXTRUDER]
gcode = 

[gcode_macro _START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 
	{% if params.CHAMBER_TEMP is defined and params.BED_TEMP is defined and params.CHAMBER_TEMP|int > 0 %}
	{% set z = printer["gcode_macro RatOS"].start_print_park_z_height|float %}
	{% set zSpeed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	G0 Z{z} F{zSpeed}
	M84
	M117 Heating chamber...
	RESPOND MSG="Heating chamber..."
	M140 S{params.BED_TEMP}
	TEMPERATURE_WAIT SENSOR=extruder MINIMUM={params.CHAMBER_TEMP}
	MAYBE_HOME
	{% endif %}

[gcode_macro _USER_START_PRINT_HEAT_CHAMBER]
description = Uses the extruder sensor to wait for chamber temp. Override the _START_PRINT_HEAT_CHAMBER macro to implement heated chamber handling.
gcode = 

[gcode_macro END_PRINT]
description = End print procedure, use this in your Slicer.
gcode = 
	SAVE_GCODE_STATE NAME=end_print_state
	_USER_END_PRINT_BEFORE_HEATERS_OFF
	_END_PRINT_BEFORE_HEATERS_OFF
	TURN_OFF_HEATERS
	_USER_END_PRINT_AFTER_HEATERS_OFF
	_END_PRINT_AFTER_HEATERS_OFF
	_USER_END_PRINT_PARK
	_END_PRINT_PARK
	
	{% if printer["gcode_macro RatOS"].skew_profile is defined %}
	SET_SKEW CLEAR=1
	{% endif %}
	
	M84
	
	M107
	
	BED_MESH_CLEAR
	BED_MESH_PROFILE REMOVE="ratos"
	M117 Done :)
	RESTORE_GCODE_STATE NAME=end_print_state
	RESPOND COLOR=success MSG="Print done"
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=30

[gcode_macro _END_PRINT_BEFORE_HEATERS_OFF]
gcode = 
	RESPOND MSG="Cleaning up..."

[gcode_macro _USER_END_PRINT_BEFORE_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_AFTER_HEATERS_OFF]
gcode = 
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% set z_hop = printer["gcode_macro RatOS"].end_print_park_z_hop|float %}
	{% if act_z < (max_z - z_hop) %}
	{% set z_safe = z_hop %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	G91
	
	G1 E-2 F3600
	
	G0 Z{z_safe} F3600
	
	G1 E-2 F3600
	
	G90

[gcode_macro _USER_END_PRINT_AFTER_HEATERS_OFF]
gcode = 

[gcode_macro _END_PRINT_PARK]
gcode = 
	_PARK LOCATION={printer["gcode_macro RatOS"].end_print_park_in} X={printer["gcode_macro RatOS"].end_print_park_x}

[gcode_macro _USER_END_PRINT_PARK]
gcode = 

[gcode_macro SAVE_PROBE_RESULT]
gcode = 
	{% set last_z = printer.probe.last_z_result %}
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE={params.VARIABLE|default('last_z')} VALUE={last_z}

[gcode_macro PROBE_FOR_PRIMING]
gcode = 
	{% if printer["gcode_macro RatOS"].nozzle_priming|lower != 'false' %}
	SAVE_GCODE_STATE NAME=probe_for_priming_state
	RESPOND MSG="Probing the prime location.."
	{% set speed = printer["gcode_macro RatOS"].macro_travel_speed|float * 60 %}
	{% set z_speed = printer["gcode_macro RatOS"].macro_z_speed|float * 60 %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'min' %}
	{% set x_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_x|lower == 'max' %}
	{% set x_start = printer.toolhead.axis_maximum.x - 5 %}
	{% else %}
	{% set x_start = printer["gcode_macro RatOS"].nozzle_prime_start_x|float %}
	{% endif %}
	{% if printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'min' %}
	{% set y_start = 5 %}
	{% elif printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == 'max' %}
	{% set y_start = printer.toolhead.axis_maximum.y - 5 %}
	{% else %}
	{% set y_start = printer["gcode_macro RatOS"].nozzle_prime_start_y|float %}
	{% endif %}
	{% set z = printer.configfile.settings.bed_mesh.horizontal_move_z|float %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% if printer.configfile.settings.bltouch is defined %}
	{% set x_offset = printer.configfile.settings.bltouch.x_offset|float %}
	{% set y_offset = printer.configfile.settings.bltouch.y_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set x_offset = printer.configfile.settings.probe.x_offset|float %}
	{% set y_offset = printer.configfile.settings.probe.y_offset|float %}
	{% elif printer.configfile.settings.beacon is defined %}
	{% set x_offset = printer.configfile.settings.beacon.x_offset|float %}
	{% set y_offset = printer.configfile.settings.beacon.y_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float - x_offset %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float - y_offset %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float - x_offset %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float - y_offset %}
	
	
	{% set x_start = [[x_start, max_x]|min, min_x]|max %}
	{% set y_start = [[y_start, max_y]|min, min_y]|max %}
	
	RESPOND MSG="PROBE_FOR_PRIMING: Probing the prime location at X: {x_start} Y: {y_start}"
	
	
	G90
	
	M83
	
	G0 Z{z} F{z_speed}
	
	G1 X{x_start} Y{y_start} F{speed}
	PROBE_CURRENT_POSITION
	SAVE_PROBE_RESULT VARIABLE=probe_for_priming_result
	
	RESTORE_GCODE_STATE NAME=probe_for_priming_state
	{% endif %}

[gcode_macro RESET_PRIME_PROBE_STATE]
gcode = 
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=probe_for_priming_result VALUE=None

[gcode_macro PROBE_CURRENT_POSITION]
gcode = 
	SAVE_GCODE_STATE NAME=probe_current_position_state
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	ASSERT_PROBE_DEPLOYED
	{% endif %}
	PROBE
	RESTORE_GCODE_STATE NAME=probe_current_position_state MOVE=1 MOVE_SPEED={printer["gcode_macro RatOS"].macro_z_speed|float}

[gcode_macro ADD_PRIME_PROBE_TO_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	{% set adjustment = last_z - z_offset %}
	{% set adjustment_threshold = printer["gcode_macro RatOS"].adaptive_prime_offset_threshold|float %}
	{% if adjustment < adjustment_threshold %}
	{ action_raise_error("Abnormal probe offset detected. Needed offset of {adjustment} is below the offset threshold of -1mm. Please verify the probe is over the bed when probing for priming. If it isn't, you should adjust you min/max bed_mesh settings so the probe is always over the print area.") }
	{% endif %}
	RESPOND MSG="ADD_PRIME_PROBE_TO_OFFSET: adjusting z offset by {adjustment}"
	SET_GCODE_OFFSET Z_ADJUST={adjustment} MOVE=1

[gcode_macro SUBTRACT_PRIME_PROBE_FROM_OFFSET]
gcode = 
	{% set last_z = printer["gcode_macro RatOS"].probe_for_priming_result|float(9999.9) %}
	{% if printer.configfile.settings.bltouch is defined %}
	{% set z_offset = printer.configfile.settings.bltouch.z_offset|float %}
	{% elif printer.configfile.settings.probe is defined %}
	{% set z_offset = printer.configfile.settings.probe.z_offset|float %}
	{% else %}
	{ action_raise_error("No probe or bltouch section found. Adaptive priming only works with [probe] or [bltouch].") }
	{% endif %}
	{% if last_z == 9999.9 %}
	{ action_raise_error("No probe result found for prime area. This is likely a bug.") }
	{% endif %}
	RESPOND MSG="SUBTRACT_PRIME_PROBE_FROM_OFFSET: adjusting z offset by {z_offset - last_z}"
	SET_GCODE_OFFSET Z_ADJUST={z_offset - last_z} MOVE=1

[gcode_macro CALIBRATE_ADAPTIVE_MESH]
gcode = 
	
	{% set default_profile = params.PROFILE %}
	
	
	{% set x0 = params.X0|default(-1)|float %}
	{% set y0 = params.Y0|default(-1)|float %}
	{% set x1 = params.X1|default(-1)|float %}
	{% set y1 = params.Y1|default(-1)|float %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Recieved coordinates X0={x0} Y0={y0} X1={x1} Y1={y1}"
	
	{% if x0 >= x1 or y0 >= y1 %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Invalid coordinates received. Please check your slicer settings. Falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	
	{% set mesh_config = printer.configfile.config.bed_mesh %}
	
	
	{% set min_x = mesh_config.mesh_min.split(",")[0]|float %}
	{% set min_y = mesh_config.mesh_min.split(",")[1]|float %}
	{% set max_x = mesh_config.mesh_max.split(",")[0]|float %}
	{% set max_y = mesh_config.mesh_max.split(",")[1]|float %}
	
	
	{% set mesh_x0 = [[x0, max_x]|min, min_x]|max %}
	{% set mesh_y0 = [[y0, max_y]|min, min_y]|max %}
	{% set mesh_x1 = [[x1, max_x]|min, min_x]|max %}
	{% set mesh_y1 = [[y1, max_y]|min, min_y]|max %}
	
	{% if mesh_x0 == min_x and mesh_y0 == min_y and mesh_x1 == max_x and mesh_y1 == max_y %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: Print is using the full bed, falling back to full bed mesh."
	BED_MESH_CALIBRATE PROFILE={default_profile}
	{% else %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	
	{% set probe_count_x = mesh_config.probe_count.split(",")[0]|int %}
	{% if mesh_config.probe_count.split(",")|length == 2 %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[1]|int %}
	{% else %}
	{% set probe_count_y = mesh_config.probe_count.split(",")[0]|int %}
	{% endif %}
	
	
	{% set probe_x_step = (max_x - min_x) / probe_count_x %}
	{% set probe_y_step = (max_y - min_y) / probe_count_y %}
	
	
	{% set mesh_count_x = ([(mesh_x1 - mesh_x0) / probe_x_step, 3]|max)|int %}
	{% set mesh_count_y = ([(mesh_y1 - mesh_y0) / probe_y_step, 3]|max)|int %}
	{% set min_mesh_count = [mesh_count_x, mesh_count_y]|min %}
	{% set max_mesh_count = [mesh_count_x, mesh_count_y]|max %}
	
	
	{% set algorithm = mesh_config.algorithm %}
	{% if algorithm|lower == 'lagrange' and max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: cannot exceed a probe_count of 6 when using lagrange interpolation. Falling back to bicubic interpolation."
	{% set algorithm = 'bicubic' %}
	{% endif %}
	{% if algorithm|lower == 'bicubic' and min_mesh_count < 4 %}
	{% if max_mesh_count > 6 %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: invalid probe_count option when using bicubic interpolation. Combination of 3 points on one axis with more than 6 on another is not permitted. Forcing minimum mesh count to be 4."
	{% set min_mesh_count = 4 %}
	{% else %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: bicubic interpolation with a probe_count of less than 4 points detected. Forcing lagrange interpolation."
	{% set algorithm = 'lagrange' %}
	{% endif %}
	{% endif %}
	
	{% set mesh_count_x = ([min_mesh_count, mesh_count_x]|max)|int %}
	{% set mesh_count_x = ([max_mesh_count, mesh_count_x]|min)|int %}
	{% set mesh_count_y = ([min_mesh_count, mesh_count_y]|max)|int %}
	{% set mesh_count_y = ([max_mesh_count, mesh_count_y]|min)|int %}
	
	{% set should_prime = printer["gcode_macro RatOS"].nozzle_priming == 'primeline' or printer["gcode_macro RatOS"].nozzle_priming == 'primeblob' %}
	{% if printer.configfile.settings.beacon is defined %}
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: adaptive priming is currently not supported for Beacon. Disabling priming.."
	SET_GCODE_VARIABLE MACRO=RatOS VARIABLE=nozzle_priming VALUE=False
	{% set should_prime = False %}
	{% endif %}
	
	{% set prime_first = printer["gcode_macro RatOS"].nozzle_prime_start_y|lower == "min" or printer["gcode_macro RatOS"].nozzle_prime_start_y|float(printer.toolhead.axis_maximum.y) < printer.toolhead.axis_maximum.y / 2 %}
	
	{% if should_prime and prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	
	RESPOND MSG="CALIBRATE_ADAPTIVE_MESH: mesh coordinates X0={mesh_x0} Y0={mesh_y0} X1={mesh_x1} Y1={mesh_y1}"
	BED_MESH_CALIBRATE PROFILE={default_profile} algorithm={algorithm} mesh_min={mesh_x0},{mesh_y0} mesh_max={mesh_x1},{mesh_y1} probe_count={mesh_count_x},{mesh_count_y}
	
	{% if should_prime and not prime_first %}
	PROBE_FOR_PRIMING
	{% endif %}
	{% if printer["gcode_macro RatOS"].z_probe|lower == 'stowable' %}
	STOW_PROBE
	{% endif %}
	
	{% endif %}
	{% endif %}

[gcode_macro LINE_PURGE]
description = A purge macro that adapts to be near your actual printed objects
gcode = 
	
	{% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}
	{% set cross_section = printer.configfile.settings.extruder.max_extrude_cross_section | float %}
	
	
	{% if printer.firmware_retraction is defined %}
	{% set RETRACT = G10 | string %}
	{% set UNRETRACT = G11 | string %}
	{% else %}
	{% set RETRACT = 'G1 E-.5 F2100' | string %}
	{% set UNRETRACT = 'G1 E.5 F2100' | string %}
	{% endif %}
	
	
	{% set verbose_enable = printer["gcode_macro RatOS"].verbose_enable | abs %}
	{% set purge_height = printer["gcode_macro RatOS"].purge_height | float %}
	{% set tip_distance = printer["gcode_macro RatOS"].tip_distance | float %}
	{% set purge_margin = printer["gcode_macro RatOS"].purge_margin | float %}
	{% set purge_amount = printer["gcode_macro RatOS"].purge_amount | float %}
	{% set flow_rate = printer["gcode_macro RatOS"].flow_rate | float %}
	
	
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set purge_x_min = (all_points | map(attribute=0) | min | default(0)) %}
	{% set purge_x_max = (all_points | map(attribute=0) | max | default(0)) %}
	{% set purge_y_min = (all_points | map(attribute=1) | min | default(0)) %}
	{% set purge_y_max = (all_points | map(attribute=1) | max | default(0)) %}
	
	{% set purge_x_center = ([((purge_x_max + purge_x_min) / 2) - (purge_amount / 2), 0] | max) %}
	{% set purge_y_center = ([((purge_y_max + purge_y_min) / 2) - (purge_amount / 2), 0] | max) %}
	
	{% set purge_x_origin = ([purge_x_min - purge_margin, 0] | max) %}
	{% set purge_y_origin = ([purge_y_min - purge_margin, 0] | max) %}
	
	
	{% set purge_move_speed = (flow_rate / 5.0) * 60 | float %}
	{% if cross_section < 5 %}
	{action_respond_info("[Extruder] max_extrude_cross_section is insufficient for purge, please set it to 5 or greater. Purge skipped.")}
	{% else %}
	{% if verbose_enable == True %}
	{action_respond_info("Moving filament tip {}mms".format(
	(tip_distance),
	)) }
	{% endif %}
	{% if printer.firmware_retraction is defined %}
	{action_respond_info("KAMP purge is using firmware retraction.")}
	{% else %}
	{action_respond_info("KAMP purge is not using firmware retraction, it is recommended to configure it.")}
	{% endif %}
	{% if purge_y_origin > 0 %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_center),
	(purge_y_origin),
	(purge_amount),
	(flow_rate),
	)) }
	{% else %}
	{action_respond_info("KAMP purge starting at {}, {} and purging {}mm of filament, requested flow rate is {}mm3/s.".format(
	(purge_x_origin),
	(purge_y_center),
	(purge_amount),
	(flow_rate),
	)) }
	{% endif %}
	
	SAVE_GCODE_STATE NAME=Prepurge_State
	
	{% if purge_y_origin > 0 %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_center} Y{purge_y_origin}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 X{purge_x_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 X{purge_x_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% else %}
	G92 E0
	G0 F{travel_speed}
	G90
	G0 X{purge_x_origin} Y{purge_y_center}
	G0 Z{purge_height}
	M83
	G1 E{tip_distance} F{purge_move_speed}
	G1 Y{purge_y_center + purge_amount} E{purge_amount} F{purge_move_speed}
	{RETRACT}
	G0 Y{purge_y_center + purge_amount + 10} F{travel_speed}
	G92 E0
	M82
	G0 Z{purge_height * 2} F{travel_speed}
	{% endif %}
	RESTORE_GCODE_STATE NAME=Prepurge_State
	{% endif %}

[gcode_shell_command generate_shaper_graph_x]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-x.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_shaper_graph_y]
command = /home/pi/printer_data/config/RatOS/scripts/generate-shaper-graph-y.sh
timeout = 60.
verbose = True

[gcode_shell_command generate_belt_tension_graph]
command = /home/pi/printer_data/config/RatOS/scripts/generate-belt-tension-graph.sh
timeout = 90.
verbose = True

[gcode_shell_command compile_binaries]
command = /home/pi/printer_data/config/RatOS/scripts/compile-binaries.sh
timeout = 600.

[gcode_shell_command change_hostname]
command = /home/pi/printer_data/config/RatOS/scripts/change-hostname.sh
timeout = 10.

[gcode_macro GENERATE_SHAPER_GRAPHS]
description = Genarates input shaper resonances graphs for analysis. Uses the AXIS parameter for if you only want to do one axis at a time, (eg. GENERATE_SHAPER_GRAPHS AXIS=X)
gcode = 
	{% if params.AXIS is defined %}
	{% if params.AXIS|lower == 'x' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RESPOND MSG="Input shaper graph generated for the X axis. You'll find it in the input_shaper folder in the machine tab!"
	{% elif params.AXIS|lower == 'y' %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graph generated for the Y axis. You'll find it in the input_shaper folder in the machine tab!"
	{% else %}
	{action_raise_error("Unknown axis specified. Expected X or Y.")}
	{% endif %}
	{% else %}
	MAYBE_HOME
	TEST_RESONANCES AXIS=X
	TEST_RESONANCES AXIS=Y
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_x
	RUN_SHELL_COMMAND CMD=generate_shaper_graph_y
	RESPOND MSG="Input shaper graphs generated for X and Y. You'll find them in the input_shaper folder in the machine tab!"
	{% endif %}

[gcode_macro MEASURE_COREXY_BELT_TENSION]
description = Generates resonance graph used to ensure belts are equally tensioned.
gcode = 
	TEST_RESONANCES AXIS=1,1  OUTPUT=raw_data NAME=belt-tension-upper
	TEST_RESONANCES AXIS=1,-1 OUTPUT=raw_data NAME=belt-tension-lower
	RUN_SHELL_COMMAND CMD=generate_belt_tension_graph
	RESPOND MSG="Belt tension graphs generated. You'll find them in the input_shaper folder in the machine tab!"

[gcode_macro COMPILE_FIRMWARE]
description = Compiles firmware with currently installed klipper version for all supported RatOS boards. Note: this may take up to 10 minutes.
gcode = 
	RESPOND MSG="Compiling binaries.. This can take up to 10 minutes. Please do not turn off your Raspberry Pi!"
	RUN_SHELL_COMMAND CMD=compile_binaries
	RESPOND MSG="Firmware binaries compiled successfully! You can find them in the firmware_binaries folder in the machine tab!"

[gcode_macro CHANGE_HOSTNAME]
description = Change the hostname of your Raspberry Pi.
gcode = 
	{% if params.HOSTNAME is not defined %}
	RESPOND MSG='You have to specify a new hostname with the HOSTNAME parameter. Ex: CHANGE_HOSTNAME HOSTNAME="MY_NEW_HOSTNAME"'
	RESPOND MSG="Please note: RFCs mandate that a hostname's labels may contain only the ASCII letters 'a' through 'z' (case-insensitive), the digits '0' through '9', and the hyphen. Hostname labels cannot begin or end with a hyphen. No other symbols, punctuation characters, or blank spaces are permitted."
	{% else %}
	RUN_SHELL_COMMAND CMD=change_hostname PARAMS={params.HOSTNAME}
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = Z_TILT_ADJUST_ORIG
gcode = 
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	DEPLOY_PROBE
	{% endif %}
	Z_TILT_ADJUST_ORIG
	{% if printer["gcode_macro RatOS"].z_probe == 'stowable' %}
	STOW_PROBE
	{% endif %}

[stepper_z]
endstop_pin = probe:z_virtual_endstop
step_pin = motor_1_step
dir_pin = motor_1_dir
enable_pin = !motor_1_enable
rotation_distance = 4
microsteps = 64
position_min = -5
homing_speed = 10
position_max = 200

[tmc2209 stepper_z]
uart_pin = motor_1_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z1]
step_pin = motor_2_step
dir_pin = motor_2_dir
enable_pin = !motor_2_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z1]
uart_pin = motor_2_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_z2]
step_pin = motor_3_step
dir_pin = motor_3_dir
enable_pin = !motor_3_enable
rotation_distance = 4
microsteps = 64

[tmc2209 stepper_z2]
uart_pin = motor_3_uart
run_current = 1.6
driver_tbl = 2
driver_toff = 3
driver_hend = 0
driver_hstrt = 6
stealthchop_threshold = 0
interpolate = False

[stepper_x]
step_pin = motor_4_step
dir_pin = !motor_4_dir
enable_pin = !motor_4_enable
rotation_distance = 40
microsteps = 64
homing_speed = 30
homing_retract_dist = 5.0
full_steps_per_rotation = 200
position_max = 200
position_endstop = 0
endstop_pin = ^endstop_motor_1

[tmc5160 stepper_x]
cs_pin = motor_4_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_x1]
step_pin = motor_5_step
dir_pin = motor_5_dir
enable_pin = !motor_5_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_x1]
cs_pin = motor_5_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y]
step_pin = motor_6_step
dir_pin = !motor_6_dir
enable_pin = !motor_6_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200
position_max = 200
position_endstop = 200
homing_speed = 30
homing_retract_dist = 5.0
endstop_pin = ^endstop_motor_2
homing_positive_dir = true

[tmc5160 stepper_y]
cs_pin = motor_6_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[stepper_y1]
step_pin = motor_7_step
dir_pin = motor_7_dir
enable_pin = !motor_7_enable
rotation_distance = 40
microsteps = 64
full_steps_per_rotation = 200

[tmc5160 stepper_y1]
cs_pin = motor_7_uart
spi_software_mosi_pin = stepper_spi_mosi
spi_software_miso_pin = stepper_spi_miso
spi_software_sclk_pin = stepper_spi_sclk
run_current = 1.768
stealthchop_threshold = 0
interpolate = False

[bed_mesh]
speed = 10
horizontal_move_z = 5
mesh_min = 10, 8.45
mesh_max = 170, 185.45
probe_count = 10,10
fade_start = 1.0
fade_end = 10.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = .2

[z_tilt]
speed = 50
z_positions = 
	0,0
	100,200
	200,0
points = 
	60,60
	135,170
	190,60
horizontal_move_z = 20
retries = 20
retry_tolerance = 0.02

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable_steppers]
gcode = 
	m84

[gcode_macro STEPPER_BUZZ_X]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x

[gcode_macro STEPPER_BUZZ_Y]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y

[gcode_macro STEPPER_BUZZ_X1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_x1

[gcode_macro STEPPER_BUZZ_Y1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_y1

[gcode_macro STEPPER_BUZZ_Z]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z

[gcode_macro STEPPER_BUZZ_Z1]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z1

[gcode_macro STEPPER_BUZZ_Z2]
gcode = 
	STEPPER_BUZZ STEPPER=stepper_z2

[bltouch]
sensor_pin = ^bltouch_probe
control_pin = bltouch_servo
speed = 7
pin_move_time = 0.675
sample_retract_dist = 10
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = True
x_offset = -30
y_offset = -14.550
z_offset = 3.825

[extruder]
rotation_distance = 5.57
full_steps_per_rotation = 200
filament_diameter = 1.750
max_extrude_only_velocity = 120
max_extrude_only_accel = 800
pressure_advance_smooth_time = 0.02
step_pin = motor_8_step
dir_pin = !motor_8_dir
enable_pin = !motor_8_enable
microsteps = 64
max_extrude_only_distance = 200
nozzle_diameter = 0.4
heater_pin = heater_e0
sensor_type = ATC Semitec 104NT-4-R025H42G
sensor_pin = thermistor_e1
min_extrude_temp = 170
min_temp = -273.15
max_temp = 99999
pressure_advance = 0.025
max_extrude_cross_section = 5
control = pid
pid_kp = 25.144
pid_ki = 3.421
pid_kd = 46.201

[tmc2209 extruder]
uart_pin = motor_8_uart
run_current = 0.5
stealthchop_threshold = 0
interpolate = False
driver_tbl = 1
driver_toff = 3
driver_hend = 9
driver_hstrt = 7

[firmware_retraction]
retract_speed = 40
retract_length = 0.5
unretract_extra_length = 0
unretract_speed = 40

[autotune_tmc stepper_x]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_x1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_y1]
motor = ldo-42sth48-2804ah
tuning_goal = performance
voltage = 48

[autotune_tmc stepper_z]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z1]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[autotune_tmc stepper_z2]
motor = ldo-42sth48-2504ac
tuning_goal = performance
voltage = 24

[output_pin status_led]
pin = heater_e3
value = 0
shutdown_value = 0

[gcode_button top]
pin = ^det_motor_6
press_gcode = 
release_gcode = 
	{% if printer.print_stats.state == "printing" %}
	PAUSE
	RESPOND COLOR=info MSG="Print paused"
	SET_PIN PIN=status_led VALUE=1
	{% elif printer.print_stats.state == "paused" %}
	RESUME
	RESPOND COLOR=info MSG="Print resumed"
	SET_PIN PIN=status_led VALUE=0
	{% else %}
	RESPOND COLOR=error MSG="Cannot pause or resume: no print in progress"
	{% endif %}

[gcode_button bottom]
pin = ^det_motor_5
press_gcode = 
release_gcode = 
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2

[gcode_macro _POWER_OFF_PRINTER]
gcode = 
	{action_call_remote_method(
	"set_device_power", device="printer", state="off"
	)}

[delayed_gcode POWER_OFF_PRINTER_CHECK]
gcode = 
	{% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
	{% if printer.extruder.temperature < 50.0 and printer.heater_bed.temperature < 50.0 %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	RESPOND COLOR=info MSG="Powering printer off"
	G4 P3000
	_POWER_OFF_PRINTER
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% endif %}
	{% else %}
	{% if printer.idle_timeout.state == "Printing" %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% else %}
	{% if printer.extruder.target == 0.0 and printer.heater_bed.target == 0.0 %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=2
	{% else %}
	UPDATE_DELAYED_GCODE ID=POWER_OFF_PRINTER_CHECK DURATION=0
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}

[gcode_macro RESPOND]
rename_existing = BASE_RESPOND
gcode = 
	{% set colors = ('primary', 'secondary', 'accent', 'info', 'success', 'error', 'warning') %}
	
	{% if params.MSG is defined %}
	{% set msg = 'MSG="'+ params.MSG + '"'|string %}
	{% endif %}
	
	{% if params.COLOR is defined %}
	{% set color = params.COLOR|lower %}
	
	{% if color in colors %}
	{% set msg = 'MSG="<span class=' + color + '--text>' + params.MSG + '</span>"'|string %}
	
	{% else %}
	BASE_RESPOND TYPE=error MSG="RESPOND COLOR '{color}' is invalid. Must be one of 'primary', 'secondary', 'accent', 'info', 'success', 'warning' or 'error'"
	{% endif %}
	
	{% endif %}
	BASE_RESPOND {msg}
=======================
Extruder max_extrude_ratio=2.078758
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
webhooks client 4124995344: New connection
webhooks client 4124995344: Client info {'program': 'Moonraker', 'version': 'v0.8.0-325-g99b97af'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/btt-octopus-max-ez: [Errno 2] No such file or directory: '/dev/btt-octopus-max-ez'
